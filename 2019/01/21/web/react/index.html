<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="webpack loader  是处理非 js 代码的文件，webpack 本身只能处理 js 文件，loader 可以将其他类型的文件转换为 webpack 能够处理的有效模块，然后由 webpack 处理。  plugins  插件的范围包括，打包、优化、压缩、重新定义环境变量，插件接口功能很强大，可以处理各种任务。 手动搭建 创建目录  mkdir projectmkdir project/">
<meta property="og:type" content="article">
<meta property="og:title" content="React学习笔记">
<meta property="og:url" content="https://yangjinheng.github.io/2019/01/21/web/react/index.html">
<meta property="og:site_name" content="默默">
<meta property="og:description" content="webpack loader  是处理非 js 代码的文件，webpack 本身只能处理 js 文件，loader 可以将其他类型的文件转换为 webpack 能够处理的有效模块，然后由 webpack 处理。  plugins  插件的范围包括，打包、优化、压缩、重新定义环境变量，插件接口功能很强大，可以处理各种任务。 手动搭建 创建目录  mkdir projectmkdir project/">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2019-07-20T10:19:59.081Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="React学习笔记">
<meta name="twitter:description" content="webpack loader  是处理非 js 代码的文件，webpack 本身只能处理 js 文件，loader 可以将其他类型的文件转换为 webpack 能够处理的有效模块，然后由 webpack 处理。  plugins  插件的范围包括，打包、优化、压缩、重新定义环境变量，插件接口功能很强大，可以处理各种任务。 手动搭建 创建目录  mkdir projectmkdir project/">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://yangjinheng.github.io/2019/01/21/web/react/">





  <title>React学习笔记 | 默默</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?be46574a10a6c2b7f67e9c32a008cbd5";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">默默</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-前端知识">
          <a href="/categories/web/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-asterisk"></i> <br>
            
            前端知识
          </a>
        </li>
      
        
        <li class="menu-item menu-item-kubernetes">
          <a href="/categories/Kubernetes/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-cog"></i> <br>
            
            Kubernetes
          </a>
        </li>
      
        
        <li class="menu-item menu-item-运维笔记">
          <a href="/categories/运维笔记/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br>
            
            运维笔记
          </a>
        </li>
      
        
        <li class="menu-item menu-item-python">
          <a href="/categories/Python/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-laptop"></i> <br>
            
            Python
          </a>
        </li>
      
        
        <li class="menu-item menu-item-golang">
          <a href="/categories/golang/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br>
            
            Golang
          </a>
        </li>
      
        
        <li class="menu-item menu-item-个人日志">
          <a href="/categories/个人日志/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-github-alt"></i> <br>
            
            个人日志
          </a>
        </li>
      
        
        <li class="menu-item menu-item-guestbook">
          <a href="/guestbook" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br>
            
            给我留言
          </a>
        </li>
      

      
    </ul>
  

  
</nav>


 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://yangjinheng.github.io/2019/01/21/web/react/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jin Heng">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="默默">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">React学习笔记</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-21T00:00:00+08:00">
                2019-01-21
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index">
                    <span itemprop="name">web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="webpack"><a href="#webpack" class="headerlink" title="webpack"></a>webpack</h1><ul>
<li>loader</li>
</ul>
<p>是处理非 js 代码的文件，webpack 本身只能处理 js 文件，loader 可以将其他类型的文件转换为 webpack 能够处理的有效模块，然后由 webpack 处理。</p>
<ul>
<li>plugins</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">插件的范围包括，打包、优化、压缩、重新定义环境变量，插件接口功能很强大，可以处理各种任务。</span><br></pre></td></tr></table></figure>
<h2 id="手动搭建"><a href="#手动搭建" class="headerlink" title="手动搭建"></a>手动搭建</h2><ul>
<li>创建目录</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mkdir project</span><br><span class="line">mkdir project/src</span><br><span class="line">mkdir project/dist</span><br><span class="line">touch project/src/index.js</span><br><span class="line">touch project/dist/index.html</span><br></pre></td></tr></table></figure>
<ul>
<li>创建 root 挂载点  project/src/index.js</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">"viewport"</span> content=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">"X-UA-Compatible"</span> content=<span class="string">"ie=edge"</span>&gt;</span><br><span class="line">    &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div id=<span class="string">"root"</span>&gt;&lt;/div&gt;</span><br><span class="line">    &lt;script src=<span class="string">"./js/bundle.js"</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>初始化项目</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd project</span><br><span class="line">npm init -y</span><br></pre></td></tr></table></figure>
<ul>
<li>安装 webpack</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">npm install --save-dev webpack webpack-cli</span><br></pre></td></tr></table></figure>
<ul>
<li>安装 babal</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install --save-dev babel-loader @babel/core @babel/preset-react @babel/preset-env babel-plugin-import</span><br></pre></td></tr></table></figure>
<ul>
<li>安装 react redux</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install --save react react-dom react-router react-router-dom</span><br><span class="line">npm install --save redux react-redux redux-thunk redux-logger</span><br></pre></td></tr></table></figure>
<ul>
<li>在项目根目录创建 webpack.config.js</li>
</ul>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">const webpack = require('webpack');</span><br><span class="line">const path = require('path');</span><br><span class="line"></span><br><span class="line">const config = &#123;</span><br><span class="line">  entry: './src/index.js',</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: path.resolve(__dirname, 'dist'),</span><br><span class="line">    filename: './js/bundle.js'</span><br><span class="line">  &#125;,</span><br><span class="line">  module: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: /\.(js|jsx)$/,</span><br><span class="line">        use: 'babel-loader',</span><br><span class="line">        exclude: /node_modules/</span><br><span class="line">      &#125;,</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  resolve: &#123;</span><br><span class="line">    extensions: [</span><br><span class="line">      '.js',</span><br><span class="line">      '.jsx'</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    contentBase: './dist',</span><br><span class="line">    port: 8080,</span><br><span class="line">    open: true,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module.exports = config;</span><br></pre></td></tr></table></figure>
<ul>
<li>在项目根目录创建 .babelrc</li>
</ul>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"presets"</span>: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">"@babel/preset-env"</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"modules"</span>: <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"@babel/preset-react"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"plugins"</span>: []</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>在 package.json 中覆盖 scripts 对象</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">  <span class="string">"test"</span>: <span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span>,</span><br><span class="line">  <span class="string">"clean"</span>: <span class="string">"rm dist/static/js/bundle.js"</span>,</span><br><span class="line">  <span class="string">"build"</span>: <span class="string">"webpack -p --mode production"</span>,</span><br><span class="line">  <span class="string">"start"</span>: <span class="string">"webpack-dev-server --hot --mode development"</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h2 id="webpack-dev-server"><a href="#webpack-dev-server" class="headerlink" title="webpack-dev-server"></a>webpack-dev-server</h2><p>webpack-dev-server 是一个小型的 Nodejs Express 服务器。</p>
<ul>
<li>启动一个服务器</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ npm install -g webpack-dev-server</span><br><span class="line">$ webpack-dev-server --content-base ./</span><br></pre></td></tr></table></figure>
<ul>
<li>配置 webpack.config.js 实现自动打开网页，指定端口等。</li>
</ul>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">devServer: &#123;</span><br><span class="line">    contentBase: './dist',</span><br><span class="line">    host: "127.0.0.1",</span><br><span class="line">    port: 80,</span><br><span class="line">    open: true</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="css-loader"><a href="#css-loader" class="headerlink" title="css-loader"></a>css-loader</h2><p>css-loader 是允许在 js 中 import 一个css文件，会将 css 文件当成一个模块引入到 js 文件中。</p>
<h2 id="style-loader"><a href="#style-loader" class="headerlink" title="style-loader"></a>style-loader</h2><p>style-loader 能够在需要载入的 html 中创建一个 <code>&lt;style&gt;&lt;/style&gt;</code> 标签，标签里的内容就是 CSS 内容。</p>
<h2 id="react-hot-loader"><a href="#react-hot-loader" class="headerlink" title="react-hot-loader"></a>react-hot-loader</h2><ul>
<li>安装</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">npm install --save react-hot-loader</span><br></pre></td></tr></table></figure>
<ul>
<li>使用</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; hot &#125; <span class="keyword">from</span> <span class="string">'react-hot-loader'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Hello &#123;this.props.name&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> AppWithHot = hot(<span class="built_in">module</span>)(App);</span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">AppWithHot</span> <span class="attr">name</span>=<span class="string">"Jane"</span> /&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">"root"</span>));</span><br></pre></td></tr></table></figure>
<h1 id="预备知识"><a href="#预备知识" class="headerlink" title="预备知识"></a>预备知识</h1><h2 id="名词简介"><a href="#名词简介" class="headerlink" title="名词简介"></a>名词简介</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">- ES2015</span><br><span class="line">即：ECMAScript 6.0，它是 JavaScript 语言的下一代标准，已经在 2015 年 6 月正式发布了。它的目标，是使得 JavaScript 语言可以用来编写复杂的大型应用程序，成为企业级开发语言。</span><br><span class="line"></span><br><span class="line">- nodejs</span><br><span class="line">Node.js 是一个基于 Chrome V8 引擎的 JavaScript 运行环境，Node.js 使用了一个事件驱动、非阻塞式 I/O 的模型，使其轻量又高效，下面的所有工程化工具如：webpack、babel、loader、grunt、gulp、fis，等都是 nodejs 的程序。</span><br><span class="line"></span><br><span class="line">- webpack</span><br><span class="line">是近期最火的一款模块加载器兼打包工具，它能把各种资源，例如JS（含JSX）、coffee、样式（含less/sass）、图片等都作为模块来使用和处理。</span><br><span class="line"></span><br><span class="line">- babel</span><br><span class="line">Babel 是一个广泛使用的 ES6 转码器，可以将 ES6 代码转为 ES5 代码，从而在现有环境执行。这意味着，你可以用 ES6 的方式编写程序，又不用担心现有环境是否支持，不过 Babel 的用途并不止于此，它支持语法扩展，能支持像 React 所用的 JSX 语法，同时还支持用于静态类型检查的流式语法（Flow Syntax）。</span><br><span class="line"></span><br><span class="line">- react</span><br><span class="line">现在最热门的前端框架，毫无疑问是 React ，React 中使用了 JSX 语法，是一种可以将 HTML 和 JS 混着写的语法糖。</span><br></pre></td></tr></table></figure>
<h2 id="npm命令"><a href="#npm命令" class="headerlink" title="npm命令"></a>npm命令</h2><ul>
<li>更改 NPM 源为淘宝</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">npm config <span class="keyword">set</span> registry https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>
<ul>
<li>查看已经安装的 npm 包</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm list -g --depth 1</span><br></pre></td></tr></table></figure>
<h2 id="JS模块化"><a href="#JS模块化" class="headerlink" title="JS模块化"></a>JS模块化</h2><p>模块化主要由两个命令构成</p>
<ol>
<li>export 用于规定模块的对外暴露的接口</li>
<li>import 用于导入其他模块提供的功能</li>
</ol>
<h3 id="export"><a href="#export" class="headerlink" title="export"></a>export</h3><p>一个 js 文件就是一个 js 模块，模块内部的变量外部无法获取，如果希望外部能读取模块内部的某个变量，就必须使用 export 关键字输出该变量。</p>
<blockquote>
<p>  示例：新建一个 app 目录，在 app 目录下新建一个 test.js</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> sum = <span class="function">(<span class="params">a,b</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> pingfang = <span class="function">(<span class="params">a</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> a * a;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> sancifang = <span class="function">(<span class="params">a</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> a * a * a;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//  export &#123;                     // 此处暴漏这个模块下变量</span></span><br><span class="line"><span class="comment">//      sum: sum,                // 语法默认为 k,v 格式</span></span><br><span class="line"><span class="comment">//      pingfang: pingfang,</span></span><br><span class="line"><span class="comment">//      sancifang: sancifang</span></span><br><span class="line"><span class="comment">//  &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;                     <span class="comment">// 当 k,v 一致的时候</span></span><br><span class="line">	sum,                     <span class="comment">// 就可以简写为 k</span></span><br><span class="line">	pingfang,</span><br><span class="line">	sancifang</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="export-default"><a href="#export-default" class="headerlink" title="export default"></a>export default</h3><p>如果指向向外暴露一个东西，比如构造函数</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">People</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(name)&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    haha()&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`我是$(this.name)我哈哈哈`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> People;</span><br></pre></td></tr></table></figure>
<h3 id="import"><a href="#import" class="headerlink" title="import"></a>import</h3><p>如果在引用模块里的一个构造函数，则不需要 from 等结构的语法</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> People <span class="keyword">from</span> <span class="string">"./People.js"</span></span><br></pre></td></tr></table></figure>
<ul>
<li>ES6中的 export 完全和之前的 <code>exports.** = **;</code> 不同，老的 exports require 语法如下：</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 暴露语法</span></span><br><span class="line">exports.showIndex = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    pass</span><br><span class="line">&#125;</span><br><span class="line">exports.doPose = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    pass</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 引入语法</span></span><br><span class="line"><span class="keyword">var</span> mainCtrl = <span class="built_in">require</span>(<span class="string">"./controller/mainctrl.js"</span>);</span><br><span class="line">mainCtrl.showIndex();</span><br></pre></td></tr></table></figure>
<h3 id="import-from"><a href="#import-from" class="headerlink" title="import from"></a>import from</h3><p>使用 <code>export</code> 命令定义了模块的对外接口以后，其他 JS 文件就可以通过 <code>import</code> 命令加载这个模块。</p>
<blockquote>
<p>  示例：在 app 目录下新建一另个 main.js ，并在代码中引用 test.js 中的变量</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;sum, pingfang, sancifang&#125; <span class="keyword">from</span> <span class="string">"./test.js"</span>;           <span class="comment">// 引包并且自动解构</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(sum(<span class="number">2</span>,<span class="number">4</span>));</span><br><span class="line"><span class="built_in">console</span>.log(pingfang(<span class="number">4</span>));</span><br><span class="line"><span class="built_in">console</span>.log(sancifang(<span class="number">4</span>));</span><br></pre></td></tr></table></figure>
<h1 id="React-基础语法"><a href="#React-基础语法" class="headerlink" title="React 基础语法"></a>React 基础语法</h1><h2 id="JSX语法"><a href="#JSX语法" class="headerlink" title="JSX语法"></a>JSX语法</h2><ul>
<li>必须被一个大的元素包裹，比如 <code>div</code> 或者 <code>section</code> 。</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> (</span><br><span class="line">	&lt;div&gt;</span><br><span class="line">    	&lt;h1&gt;我是 react，很高兴遇见你！HAHAHA&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">    	&lt;h1&gt;我是 react，很高兴遇见你！HAHAHA&lt;/</span>h1&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">);</span></span><br></pre></td></tr></table></figure>
<ul>
<li>自封闭标签必须封闭</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> (</span><br><span class="line">	&lt;div&gt;</span><br><span class="line">    	&lt;img src=<span class="string">""</span> /&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">)</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>class</code> 要写成 <code>className</code>，<code>lebel</code> 的 <code>for</code> 要写成 <code>htmlFor</code> 。</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span>(</span><br><span class="line">	&lt;div&gt;</span><br><span class="line">    	&lt;div className=<span class="string">"box"</span>&gt;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ul>
<li>原生标签标签添加自定义属性时候，必须以 <code>data-</code> 开头</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span>(</span><br><span class="line">	&lt;div&gt;</span><br><span class="line">    	&lt;div data-role=<span class="string">"super"</span>&gt;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    	/</span><span class="regexp">/ 这是一段注释</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ul>
<li>HTML 注释语法不能使用，只能使用 JS 注释语法</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span>(</span><br><span class="line">	&lt;div&gt;</span><br><span class="line">    	&lt;div className=<span class="string">"box"</span>&gt;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    	/</span><span class="regexp">/ 这是一段注释</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ul>
<li>可以使用 <code>{}</code> 表示临时插入一个 JS 简单表达式，不能是 <code>if</code>、<code>for</code>，等复杂语句。</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> (</span><br><span class="line">    &lt;h1&gt;Hello World！&#123;obj.hello()&#125;&#123;<span class="number">3</span> &gt; <span class="number">8</span> ? <span class="string">"a"</span> : <span class="string">"b"</span>&#125;&#123;<span class="number">100</span> + <span class="number">100</span>&#125;&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">);</span></span><br></pre></td></tr></table></figure>
<ul>
<li>内联样式需要写 JSON ，并且样式名称有轻微变动，错误都会在 Chrome Console 提醒</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> sty = &#123;</span><br><span class="line">    <span class="string">"width"</span>: <span class="string">"100%"</span>,</span><br><span class="line">    <span class="string">"lineHeight"</span>: <span class="string">"100px"</span>,</span><br><span class="line">    <span class="string">"textAlign"</span>: <span class="string">"center"</span>,</span><br><span class="line">    <span class="string">"color"</span>: <span class="string">"red"</span>,</span><br><span class="line">    <span class="string">"backgroundColor"</span>: <span class="string">"skyblue"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> (</span><br><span class="line">    &lt;h1 style=&#123;sty&#125;&gt;Hello React&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">    &lt;h1 style=&#123;&#123;"width": "100%","textAlign": "center"&#125;&#125;&gt;Hello React&lt;/</span>h1&gt;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ul>
<li>数组自动展开，但处于数组中JSX 创建的 DOM 元素，必须加 key 属性且不能重复，可以使用填写为数组索引</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">render() &#123;</span><br><span class="line"><span class="keyword">let</span> arr = [<span class="string">"今天"</span>,<span class="string">"明天"</span>,<span class="string">"后天"</span>,<span class="string">"大后天"</span>,<span class="string">"今年"</span>,<span class="string">"明年"</span>,<span class="string">"后年"</span>];</span><br><span class="line"><span class="keyword">let</span> li_arr = arr.map(<span class="function">(<span class="params">value,index</span>)=&gt;</span><span class="xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span>&gt;</span>&#123;value&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span>);</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;h1 style=&#123;sty&#125;&gt;我是 React 很高兴遇见你!&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">            &lt;ul&gt;</span></span><br><span class="line"><span class="regexp">                &#123;li_arr&#125;</span></span><br><span class="line"><span class="regexp">            &lt;/u</span>l&gt;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="React-组件"><a href="#React-组件" class="headerlink" title="React 组件"></a>React 组件</h2><ul>
<li>函数组件</li>
</ul>
<p>当我们现在的组件仅仅是为了呈递一些 DOM 元素，此时可以不用 <code>class</code> 定义组件，而是就写一个简单的函数。</p>
<ul>
<li>定义函数组件 Welcome.js</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> Welcome = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;h1&gt;Hello, &#123;props.name&#125;&lt;<span class="regexp">/h1&gt;;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Welcome;</span><br></pre></td></tr></table></figure>
<ul>
<li>使用 <code>react-dom</code> 里的 <code>render</code> 方法，它接收两个参数，第一个参数是组件，第二个是渲染的目标</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; render &#125; <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"><span class="keyword">import</span> Welcome <span class="keyword">from</span> <span class="string">"./Welcome.js"</span>;</span><br><span class="line"></span><br><span class="line">render(</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;Welcome name=<span class="string">"React"</span>&gt;&lt;<span class="regexp">/Welcome&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;,</span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">"app"</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h2 id="类组件"><a href="#类组件" class="headerlink" title="类组件"></a>类组件</h2><p>一个类要想成为 <code>React</code> 组件必须继承自 <code>React.Component</code> ，并且重写 <code>render</code> 方法，<code>render</code> 方法中用 <code>return</code> 返回组件内容，组件内容是 JSX 语法组成的。</p>
<ul>
<li>定义类组件</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Welcome</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello, &#123;this.props.name&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>使用 <code>react-dom</code> 里的 <code>render</code> 方法，它接收两个参数，第一个参数是组件，第二个是渲染的目标</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; render &#125; <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"><span class="keyword">import</span> Welcome <span class="keyword">from</span> <span class="string">"./Welcome.js"</span>;</span><br><span class="line"></span><br><span class="line">render(</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;Welcome name=<span class="string">"React"</span>&gt;&lt;<span class="regexp">/Welcome&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;,</span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">"app"</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h2 id="组件语法"><a href="#组件语法" class="headerlink" title="组件语法"></a>组件语法</h2><ul>
<li>组件名称必须以大写字母开头</li>
</ul>
<p>例如，<code>&lt;div /&gt;</code> 表示一个DOM标签，但 <code>&lt;Welcome /&gt;</code> 表示一个组件，并且在使用该组件时你必须定义或引入它。</p>
<ul>
<li>组件可以多次渲染，但可以传递不同的值</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;Welcome name=<span class="string">"Sara"</span> /&gt;</span><br><span class="line">        &lt;Welcome name=<span class="string">"Cahal"</span> /&gt;</span><br><span class="line">        &lt;Welcome name=<span class="string">"Edite"</span> /&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">);</span></span><br></pre></td></tr></table></figure>
<h2 id="组件属性"><a href="#组件属性" class="headerlink" title="组件属性"></a>组件属性</h2><p>我们可以在组件的类定义中写 constructor 构造器，里面定义类属性，表示给组件实例绑定一个属性，需要注意的是需要调用 super()，在 JSX 中使用的时候直接 this. 来调用。</p>
<ul>
<li>简单示例</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.a = <span class="number">100</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    add() &#123;</span><br><span class="line">        <span class="keyword">this</span>.a++;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.a);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &#123;<span class="keyword">this</span>.a&#125;</span><br><span class="line">                &lt;p&gt;</span><br><span class="line">                    &lt;input type=<span class="string">"button"</span> value=<span class="string">"按我"</span> onClick=&#123;(<span class="keyword">this</span>.add).bind(<span class="keyword">this</span>)&#125; /&gt;</span><br><span class="line">                &lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>div&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过上面可以了解到：</p>
<ol>
<li>绑定监听使用 onClick、onMousedown、onMouseenter、onBlur，把 on 后面的字母大写，React 会自动识别为 React 事件。</li>
<li>绑定事件函数的时候 <code>this</code> 上下文是有问题的，所以需要使用 <code>bind</code> 设置上下文。</li>
<li>注意绑定监听函数的时候，应该用 <code>{}</code> 才能被 React 正确识别，而是不 HTML 里面的 <code>&quot;&quot;</code> 这种写法。</li>
</ol>
<p>上面案例可以看到 DOM 树上的元素值没有发生改变，所以 React 中组件自己的属性变化（包括闭包属性），不会引起 DOM 视图的变化。</p>
<h2 id="组件方法"><a href="#组件方法" class="headerlink" title="组件方法"></a>组件方法</h2><ul>
<li>组件类中自己定义的方法，也需要绑定 this 这很麻烦，下面的方法不用绑定 this。</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">My</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    change = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.refs.box.style.backgroundColor = <span class="string">"red"</span>;    <span class="comment">// 在此处使用 ref 操作 DOM 。</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">let</span> style = &#123;</span><br><span class="line">            <span class="string">"width"</span>: <span class="string">"200px"</span>,</span><br><span class="line">            <span class="string">"height"</span>: <span class="string">"200px"</span>,</span><br><span class="line">            <span class="string">"backgroundColor"</span>: <span class="string">"skyblue"</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;div className=<span class="string">"box"</span> style=&#123;style&#125; ref=<span class="string">"box"</span>&gt;&lt;<span class="regexp">/div&gt;  /</span><span class="regexp">/ 在元素上设置 ref</span></span><br><span class="line"><span class="regexp">                &lt;p&gt;</span></span><br><span class="line"><span class="regexp">                    &lt;input type="button" value="按我变色" onClick=&#123;this.change&#125; /</span>&gt;</span><br><span class="line">                &lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>div&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> My;</span><br></pre></td></tr></table></figure>
<h2 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World"></a>Hello World</h2><ul>
<li><code>index.html</code> 文件</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">"viewport"</span> content=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">"X-UA-Compatible"</span> content=<span class="string">"ie=edge"</span>&gt;</span><br><span class="line">    &lt;title&gt;Document&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div id=<span class="string">"app"</span>&gt;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    &lt;script src="bundle.js"&gt;&lt;/</span>script&gt;</span><br><span class="line">&lt;<span class="regexp">/body&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>html&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>使用 JSX 语法编写一个组件</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;p&gt;Hello World&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>div&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>index.js</code> 文件，引入 <code>App.js</code> 组件后，在 render 中使用 <code>&lt;App&gt;&lt;/App&gt;</code> 调用组件</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; render &#125; <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 引入我们编写的组件</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">"./App.js"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用、挂载组件，两个参数</span></span><br><span class="line"><span class="comment">// 第一个参数是 JSX 语法</span></span><br><span class="line"><span class="comment">// 第二个参数表示组件挂在那里</span></span><br><span class="line">render(</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;App&gt;&lt;<span class="regexp">/App&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;,</span><br><span class="line">  <span class="built_in">document</span>.getElementById(<span class="string">"app"</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h1 id="React-数据传递"><a href="#React-数据传递" class="headerlink" title="React 数据传递"></a>React 数据传递</h1><p>React 中跟数据有关系的三个东西：<code>state</code>、<code>props</code>、<code>context</code>，我们可以叫 React 数据传递三兄弟。</p>
<h2 id="state"><a href="#state" class="headerlink" title="state"></a>state</h2><p>React 把组件看成一个状态机（State Machines）。通过与用户的交互，实现不同状态，然后渲染 UI ，让用户界面和数据保持一致。</p>
<p>在 React 里 <code>this.setState({&quot;k&quot;:v})</code> 方法会引起 React DOM 计算，从而引起视图的变化，不要直接操作 DOM。</p>
<p><code>state</code> 是内部的，只有组件自己能改变自己的 <code>state</code>，别的组件不可以改变，所以也叫 <code>Local State</code> 。</p>
<h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h3><ul>
<li>定义 <code>state</code>，只需要在组件自己的构造器中使用 <code>this.state = {k:v}</code> 属性即可。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">super</span>();</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">        a: <span class="number">100</span>,</span><br><span class="line">        b: <span class="number">200</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>使用 <code>state</code>，在 JSX 语法中 <code>{this.state.&lt;attr&gt;}</code>，就可以直接调用。</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;p&gt;&#123;<span class="keyword">this</span>.state.a&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">        &lt;p&gt;&#123;this.state.b&#125;&lt;/</span>p&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">);</span></span><br></pre></td></tr></table></figure>
<ul>
<li>改变 <code>state</code>，使用 <code>this.setState({&quot;k&quot;:v})</code> 方法，需要注意 state 属性为只读，所以不能使用<code>++</code>自增运算。</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">this</span>.setState(&#123; <span class="string">"a"</span>: <span class="keyword">this</span>.state.a + <span class="number">1</span> &#125;);</span><br></pre></td></tr></table></figure>
<h3 id="使用示例"><a href="#使用示例" class="headerlink" title="使用示例"></a>使用示例</h3><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.state = &#123;</span><br><span class="line">            a: <span class="number">100</span>,</span><br><span class="line">            b: <span class="number">200</span>,</span><br><span class="line">            c: <span class="number">300</span>,</span><br><span class="line">            d: <span class="number">400</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    add() &#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123; <span class="attr">a</span>: <span class="keyword">this</span>.state.a + <span class="number">1</span> &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;p&gt;&#123;<span class="keyword">this</span>.state.a&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">                &lt;p&gt;&#123;this.state.b&#125;&lt;/</span>p&gt;</span><br><span class="line">                &lt;p&gt;&#123;<span class="keyword">this</span>.state.c&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">                &lt;p&gt;&#123;this.state.d&#125;&lt;/</span>p&gt;</span><br><span class="line">                &lt;input type=<span class="string">"button"</span> value=<span class="string">"按我"</span> onClick=&#123;(<span class="keyword">this</span>.add).bind(<span class="keyword">this</span>)&#125; /&gt;</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        );</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="props"><a href="#props" class="headerlink" title="props"></a>props</h2><p>定义在自定义组件元素上面的属性，就是 <code>props</code> ，当 <code>props</code> 改变的时候，会引起 Virtual DOM 的改变，进而引发视图的重绘。</p>
<p>无论是使用函数或是类来声明一个组件，它决不能修改它自己的 <code>props</code>。</p>
<h3 id="使用方法-1"><a href="#使用方法-1" class="headerlink" title="使用方法"></a>使用方法</h3><ul>
<li>在父组件中为子组件定义 <code>props</code>，只需要在子组件元素上设置属性即可。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;MyCompo a=&#123;<span class="number">66</span>&#125; b=&#123;<span class="number">77</span>&#125; c=&#123;<span class="number">88</span>&#125;&gt;&lt;<span class="regexp">/MyCompo&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<ul>
<li>在子组件中使用 <code>props</code>，只需在 JSX 语法中 <code>{this.props.&lt;attr&gt;}</code>，就可以直接调用父组件传递过来的 <code>props</code> 属性。</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        This is MyCompo, &#123;<span class="keyword">this</span>.props.a&#125; &#123;<span class="keyword">this</span>.props.b&#125; &#123;<span class="keyword">this</span>.props.c&#125;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">);</span></span><br></pre></td></tr></table></figure>
<h3 id="使用示例-1"><a href="#使用示例-1" class="headerlink" title="使用示例"></a>使用示例</h3><ul>
<li>新建 <code>MyCompo1.js</code></li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyCompo</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                This is MyCompo, &#123;<span class="keyword">this</span>.props.a&#125; &#123;<span class="keyword">this</span>.props.b&#125; &#123;<span class="keyword">this</span>.props.c&#125;</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        );</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default MyCompo;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>在 <code>App.js</code> 组件中引入 <code>MyCompo1.js</code>，并在 JSX 语法中 <code>&lt;MyCompo&gt;</code> 调用子组件，给这个子组件传递值。</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> MyCompo <span class="keyword">from</span> <span class="string">"./MyCompo1"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;MyCompo a=&#123;<span class="number">66</span>&#125; b=&#123;<span class="number">77</span>&#125; c=&#123;<span class="number">88</span>&#125;&gt;&lt;<span class="regexp">/MyCompo&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>div&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure>
<ul>
<li>处理来自父组件传过来的值，传递的值可以是 JS 的所有可用类型。</li>
</ul>
<p>如果需要在子组件中的 <code>constructor</code> 中使用父组件中传递过来的值，那么可以在  <code>constructor</code> 构造函数的第一个参数接收。</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyCompo</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props) &#123;            <span class="comment">// 在 constructor 函数的第一个参数来接收父组件传递过来的值</span></span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.state = &#123;</span><br><span class="line">            c: props.c,              <span class="comment">// 定义 state 属性，值来自 props</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    add() &#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;<span class="attr">c</span> : <span class="keyword">this</span>.state.c + <span class="number">1</span>&#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                This is MyCompo, &#123;<span class="keyword">this</span>.props.a&#125; &#123;<span class="keyword">this</span>.props.b&#125; &#123;<span class="keyword">this</span>.state.c&#125;</span><br><span class="line">                &lt;p&gt;</span><br><span class="line">                    &lt;input type=<span class="string">"button"</span> value=<span class="string">"点我"</span> onClick=&#123;(<span class="keyword">this</span>.add).bind(<span class="keyword">this</span>)&#125; /&gt;</span><br><span class="line">                &lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>div&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> MyCompo;</span><br></pre></td></tr></table></figure>
<h3 id="属性验证"><a href="#属性验证" class="headerlink" title="属性验证"></a>属性验证</h3><ul>
<li>验证父组件传递过来的 <code>props</code> 属性，首先安装 <code>props-types</code> 。</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">npm install --save-dev prop-types</span><br></pre></td></tr></table></figure>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; PropTypes &#125; <span class="keyword">from</span> <span class="string">"prop-types"</span>;           <span class="comment">// 引入 prop-types 模块</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyCompo</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.state = &#123;</span><br><span class="line">            c: props.c,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    add() &#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123; <span class="attr">c</span>: <span class="keyword">this</span>.state.c + <span class="number">1</span> &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                This is MyCompo, &#123;<span class="keyword">this</span>.props.a&#125; &#123;<span class="keyword">this</span>.props.b&#125; &#123;<span class="keyword">this</span>.state.c&#125;</span><br><span class="line">                &lt;p&gt;</span><br><span class="line">                    &lt;input type=<span class="string">"button"</span> value=<span class="string">"点我"</span> onClick=&#123;(<span class="keyword">this</span>.add).bind(<span class="keyword">this</span>)&#125; /&gt;</span><br><span class="line">                &lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>div&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义组件需要传入的参数</span></span><br><span class="line">MyCompo.propTypes = &#123;                           <span class="comment">// 定义如何验证父组件传递过来的 props 属性</span></span><br><span class="line">    a : PropTypes.string.isRequired,            <span class="comment">// 定义父组件传递过来的 a 属性必须为字符串</span></span><br><span class="line">    b : PropTypes.number.isRequired,            <span class="comment">// 定义父组件传递过来的 b 属性必须为数字</span></span><br><span class="line">    c : PropTypes.number.isRequired             <span class="comment">// 定义父组件传递过来的 c 属性必须为数字</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> MyCompo;</span><br></pre></td></tr></table></figure>
<p>此时可以看到由于父组件传递的 <code>a</code> 属性为数字，所以出现报。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">Warning: Failed prop type: Invalid prop <span class="string">`b`</span> <span class="keyword">of</span> type <span class="string">`number`</span> supplied to <span class="string">`MyCompo`</span>, expected <span class="string">`string`</span>.</span><br></pre></td></tr></table></figure>
<h3 id="子操作父组件"><a href="#子操作父组件" class="headerlink" title="子操作父组件"></a>子操作父组件</h3><p>如果非要从子组件传数据给父组件，此时只能用奇淫技巧，就是父组件传一个函数给子组件，子组件通过传参将数据返回给父组件的函数，父组件函数接收数据后改变父组件的 <code>state</code> 等等。</p>
<ul>
<li>父组件向子组件通过 <code>props</code> 传递一个 <code>stste</code> 值和一个修改这个 <code>state</code> 值的函数</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> MyCompo <span class="keyword">from</span> <span class="string">"./MyCompo1"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.state = &#123;                    <span class="comment">// 设置一个 state 属性</span></span><br><span class="line">            d: <span class="number">16</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    setD(number) &#123;                        <span class="comment">// 增加一个修改 state 属性的方法</span></span><br><span class="line">        <span class="keyword">this</span>.setState(&#123; <span class="string">"d"</span>: number &#125;)    <span class="comment">// 接收一个值修改自己的 state.d 属性</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;p&gt;APP组件 d 状态 ： &#123;<span class="keyword">this</span>.state.d&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">                &lt;MyCompo d=&#123;this.state.d&#125; setD=&#123;(this.setD).bind(this)&#125; &gt;&lt;/</span>MyCompo&gt;  <span class="comment">// 属性和方法传递给子组件</span></span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        );</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default App;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>子组件接收并设置为自己的 <code>state</code> 属性，调用父组件传递过来的函数，达到修改父组件的属性目的</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; PropTypes &#125; <span class="keyword">from</span> <span class="string">"prop-types"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyCompo</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.state = &#123;</span><br><span class="line">            d: props.d                                  <span class="comment">// 新建一个 state 值为父组件传递过来的值</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.add = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.setState(&#123; <span class="string">"d"</span>: <span class="keyword">this</span>.state.d + <span class="number">1</span> &#125;);   <span class="comment">// 首先修改自己的属性</span></span><br><span class="line">            props.setD(<span class="keyword">this</span>.state.d + <span class="number">1</span>);               <span class="comment">// 调用父组件函数，并向他传递修改过的属性值，以更新父组件</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;p&gt;This is MyCompo&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">                &lt;p&gt;MyCompo 组件 d 状态 ：  : &#123;this.state.d&#125;&lt;/</span>p&gt;</span><br><span class="line">                &lt;p&gt;</span><br><span class="line">                    &lt;input type=<span class="string">"button"</span> value=<span class="string">"点我让d加1"</span> onClick=&#123;<span class="keyword">this</span>.add&#125; /&gt;</span><br><span class="line">                &lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>div&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义组件需要传入的参数</span></span><br><span class="line">MyCompo.propTypes = &#123;</span><br><span class="line">    a: PropTypes.string.isRequired,</span><br><span class="line">    b: PropTypes.string.isRequired,</span><br><span class="line">    c: PropTypes.number.isRequired</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> MyCompo;</span><br></pre></td></tr></table></figure>
<h3 id="从-props-中枚举"><a href="#从-props-中枚举" class="headerlink" title="从 props 中枚举"></a>从 props 中枚举</h3><p>从 props 中取得三个对象。</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; value, onIncrement, onDecrement &#125; = <span class="keyword">this</span>.props</span><br></pre></td></tr></table></figure>
<h2 id="context"><a href="#context" class="headerlink" title="context"></a>context</h2><p><code>context</code> 上下文的精髓是可以跨级传递数据，祖先组件可以传递数据到孙子组件。</p>
<h3 id="使用方法-2"><a href="#使用方法-2" class="headerlink" title="使用方法"></a>使用方法</h3><ul>
<li>在祖先组件类中定义方法，设置子组件们的 <code>context</code> 数据</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">getChildContext() &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        &lt;attr&gt;: <span class="xml"><span class="tag">&lt;<span class="name">value</span>&gt;</span></span></span><br><span class="line"><span class="xml">    &#125;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>在祖先类上设置上下文中数据的类型</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">CLASS.childContextTypes = &#123;</span><br><span class="line">    &lt;attr&gt;: PropTypes.number.isRequired</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>在子孙组件类的构造器的第二个参数中接收 <code>context</code> 对象</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">constructor</span>(props, context) &#123;</span><br><span class="line">    <span class="keyword">super</span>();</span><br><span class="line">    <span class="built_in">console</span>.log(context);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>在子孙组件类上设置上下文数据的类型</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">CLASS.contextTypes = &#123;</span><br><span class="line">    &lt;attr&gt;: PropTypes.number.isRequired</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>在子孙组件的 JSX 语法中调用 <code>context</code> 对象的数据</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;h1&gt;孙子 &#123;<span class="keyword">this</span>.context.&lt;attr&gt; &#125;&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h3 id="使用示例-2"><a href="#使用示例-2" class="headerlink" title="使用示例"></a>使用示例</h3><p>示例中的包含关系是这样的：App.js -&gt; Yeye.js -&gt; Baba.js -&gt; Sunzi.js，现在 Yeye.js 组件，想向 Sunzi.js 中传递数据。</p>
<ul>
<li>Yeye.js 设置子组件们的 <code>context</code> 数据</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> Baba <span class="keyword">from</span> <span class="string">"./Baba.js"</span>;</span><br><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">"prop-types"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Yeye</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.state = &#123;</span><br><span class="line">            a: <span class="number">100</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 作为祖先组件可以直接修改自己的 stste ，从而达到修改上下文中的数据</span></span><br><span class="line">    add()&#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;<span class="string">"a"</span> : <span class="keyword">this</span>.state.a + <span class="number">1</span>&#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置 context 对象</span></span><br><span class="line">    getChildContext() &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            a: <span class="keyword">this</span>.state.a</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 显示自己的 stste 数据，给按钮绑定事件修改 stete 数据</span></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">              &lt;h1&gt;爷爷 &#123;<span class="keyword">this</span>.state.a&#125; &lt;input type=<span class="string">"button"</span> value=<span class="string">"按我"</span> onClick=&#123;(<span class="keyword">this</span>.add).bind(<span class="keyword">this</span>)&#125; /&gt;&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">              &lt;Baba&gt;&lt;/</span>Baba&gt;</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        );</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ 设置上下文类型</span></span><br><span class="line"><span class="regexp">Yeye.childContextTypes = &#123;</span></span><br><span class="line"><span class="regexp">    a: PropTypes.number.isRequired</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default Yeye;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Baba.js 组件中调用了 Sunzi.js 组件，它可以访问 <code>context</code> 但是它不访问 <code>context</code></li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> Sunzi <span class="keyword">from</span> <span class="string">"./Sunzi.js"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Baba</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;h1&gt;爸爸&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">                &lt;Sunzi&gt;&lt;/</span>Sunzi&gt;</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        );</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default Baba;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Sunzi.js 组件中，在构造器的第二个参数中接收 <code>context</code> 对象，就可以使用 <code>this.context.&lt;attr&gt;</code> 来访问了。</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">"prop-types"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sunzi</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">constructor</span>(props, context) &#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="built_in">console</span>.log(context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;h1&gt;孙子 &#123;<span class="keyword">this</span>.context.a&#125;&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>div&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置得到属性的类型检查</span></span><br><span class="line">Sunzi.contextTypes = &#123;</span><br><span class="line">    a: PropTypes.number.isRequired</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Sunzi;</span><br></pre></td></tr></table></figure>
<ul>
<li>结论</li>
</ul>
<p>当祖先元素更改了上下文的数据，此时所有的子孙元素中的数据都会更改，视图也会更新，反之不成立，可以认为上下文的数据在子孙元素中是只读的。</p>
<h3 id="子操作祖先组件"><a href="#子操作祖先组件" class="headerlink" title="子操作祖先组件"></a>子操作祖先组件</h3><p>祖先组件设置的 <code>context</code> 对象是只读的，不能修改，但有没有什么方法能够让子组件修改祖先组件的属性呢？此时又要使用奇淫技巧，就是在 <code>context</code> 中共享一个操作祖先元素的函数，子孙元素通过上下文获得这个函数，从而操作祖先元素的值。</p>
<ul>
<li>Yeye.js 设置子组件们的 <code>context</code> 数据，在其中共享一个操作 <code>context</code>，的函数</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> Baba <span class="keyword">from</span> <span class="string">"./Baba.js"</span>;</span><br><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">"prop-types"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Yeye</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.state = &#123;</span><br><span class="line">            a: <span class="number">100</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 作为祖先组件可以直接修改自己的 stste ，从而达到修改上下文中的数据</span></span><br><span class="line">    add()&#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;<span class="string">"a"</span> : <span class="keyword">this</span>.state.a + <span class="number">1</span>&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置 context 对象</span></span><br><span class="line">    getChildContext() &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            a: <span class="keyword">this</span>.state.a</span><br><span class="line">            add: (<span class="keyword">this</span>.add).bind(<span class="keyword">this</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 显示自己的 stste 数据，给按钮绑定事件修改 stete 数据</span></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">              &lt;h1&gt;爷爷 &#123;<span class="keyword">this</span>.state.a&#125; &lt;input type=<span class="string">"button"</span> value=<span class="string">"按我"</span> onClick=&#123;(<span class="keyword">this</span>.add).bind(<span class="keyword">this</span>)&#125; /&gt;&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">              &lt;Baba&gt;&lt;/</span>Baba&gt;</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        );</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ 设置上下文类型</span></span><br><span class="line"><span class="regexp">Yeye.childContextTypes = &#123;</span></span><br><span class="line"><span class="regexp">    a: PropTypes.number.isRequired,</span></span><br><span class="line"><span class="regexp">    add: PropTypes.func.isRequired</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default Yeye;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>在 Sunzi.js 中调用祖先共享的 <code>add</code> 方法，从而实现子组件影响祖先组件的效果。</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">"prop-types"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sunzi</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">constructor</span>(props, context) &#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="built_in">console</span>.log(context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;h1&gt;孙子 &#123;<span class="keyword">this</span>.context.a&#125; &lt;input type=<span class="string">"button"</span> value=<span class="string">"按我"</span> onClick=&#123;<span class="keyword">this</span>.context.add&#125; /&gt;&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>div&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置得到属性的类型检查</span></span><br><span class="line">Sunzi.contextTypes = &#123;</span><br><span class="line">    a: PropTypes.number.isRequired,</span><br><span class="line">    add: PropTypes.func.isRequired</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Sunzi;</span><br></pre></td></tr></table></figure>
<ul>
<li>总结</li>
</ul>
<p>祖先共享了自己的方法，从而子组件调用祖先共享的方法，影响了祖先的数据，这样就实现了子组件也能影响 <code>context</code> 的效果。</p>
<h2 id="三兄弟总结"><a href="#三兄弟总结" class="headerlink" title="三兄弟总结"></a>三兄弟总结</h2><p><code>state</code> 是组件自治的，只能在自己的组件范围内访问。</p>
<p><code>props</code> 是单向的，父传递给子组件，且是只读的不可修改，如果要反向传递数据给父组件，就要祖先组件传入 <code>context</code> 一个函数。</p>
<p><code>context</code> 也是单向的，祖先传递给后代，也是只读的，如果要反向传递数据给祖先组件，就要祖先组件传入 <code>context</code> 一个函数。</p>
<h2 id="模拟双向绑定"><a href="#模拟双向绑定" class="headerlink" title="模拟双向绑定"></a>模拟双向绑定</h2><p>当 <code>input</code> 有输入东西的时候，立刻更新在屏幕上</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyCompo</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.state = &#123;</span><br><span class="line">            text: <span class="string">"0"</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.change = <span class="keyword">this</span>.change.bind(<span class="keyword">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    change(event) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(event.target.value);</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123; <span class="string">"text"</span>: event.target.value &#125;)   <span class="comment">// 更新在 state 上立刻更新视图</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;input type=<span class="string">"text"</span> placeholder=<span class="string">"Hello,React"</span> onChange=&#123;<span class="keyword">this</span>.change&#125; /&gt;  <span class="comment">// 当有任何输入时候</span></span><br><span class="line">                &lt;h1&gt;&#123;<span class="keyword">this</span>.state.text&#125;&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>div&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> MyCompo;</span><br></pre></td></tr></table></figure>
<h2 id="Refs-DOM-钩子"><a href="#Refs-DOM-钩子" class="headerlink" title="Refs DOM 钩子"></a>Refs DOM 钩子</h2><p><code>Refs</code> 提供了一种方式，用于访问在 <code>render</code> 方法中创建的 DOM 节点或 React 元素。</p>
<p><code>ref</code> 是个 DOM 钩子，在元素上设置 <code>ref</code> 属性，就可以在 <code>this.refs.</code> 这个属性从而得到这个 DOM 元素了。</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">My</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.change = <span class="keyword">this</span>.change.bind(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    change() &#123;</span><br><span class="line">        <span class="keyword">this</span>.refs.box.style.backgroundColor = <span class="string">"red"</span>;    <span class="comment">// 在此处使用 ref 操作 DOM 。</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">let</span> style = &#123;</span><br><span class="line">            <span class="string">"width"</span>: <span class="string">"200px"</span>,</span><br><span class="line">            <span class="string">"height"</span>: <span class="string">"200px"</span>,</span><br><span class="line">            <span class="string">"backgroundColor"</span>: <span class="string">"skyblue"</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;div className=<span class="string">"box"</span> style=&#123;style&#125; ref=<span class="string">"box"</span>&gt;&lt;<span class="regexp">/div&gt;  /</span><span class="regexp">/ 在元素上设置 ref</span></span><br><span class="line"><span class="regexp">                &lt;p&gt;</span></span><br><span class="line"><span class="regexp">                    &lt;input type="button" value="按我变色" onClick=&#123;this.change&#125; /</span>&gt;</span><br><span class="line">                &lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>div&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> My;</span><br></pre></td></tr></table></figure>
<h1 id="生命周期TODO"><a href="#生命周期TODO" class="headerlink" title="生命周期TODO"></a>生命周期TODO</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">componentWillMount()        渲染前调用</span><br><span class="line">componentDidMount()         渲染后调用</span><br><span class="line">componentWillUpdate()       更新之前</span><br><span class="line">componentDidUpdate()        更新之后</span><br><span class="line">componentWillUnmount()      卸载之前</span><br><span class="line">componentWillReceiveProps() 组件参数更新</span><br></pre></td></tr></table></figure>
<h2 id="组件生命周期"><a href="#组件生命周期" class="headerlink" title="组件生命周期"></a>组件生命周期</h2><p>组件从没有诞生，到就绪上树，到被移除的完整生命周期，都提供了函数接口。</p>
<ul>
<li>挂载：组件被插入到 DOM 中</li>
<li>更新：组件被重新渲染，查明 DOM 是否应该被刷新</li>
<li>移除：组件从 DOM 移除</li>
</ul>
<p>函数接口有 <code>will</code> 方法，会在某些行为发生前调用，<code>did</code> 方法，会在某些行为发生之后调用。</p>
<p>组件上树前后</p>
<p>更新之前、更新之后被调用，它不能组织 DOM 的更新</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> My <span class="keyword">from</span> <span class="string">"./My"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    componentWillMount() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"挂载之前"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    componentDidMount()&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"挂在之后"</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;My&gt;&lt;<span class="regexp">/My&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>div&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure>
<h2 id="组件下树之前"><a href="#组件下树之前" class="headerlink" title="组件下树之前"></a>组件下树之前</h2><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">componentWillUnmount() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"组件被移除之前"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="props更新前后的函数"><a href="#props更新前后的函数" class="headerlink" title="props更新前后的函数"></a>props更新前后的函数</h2><p><code>shouldComponentUpdate</code> 钩子在更新之前调用，它的返回值如果是 <code>true</code> 那么才能更新 DOM 树，可以当作“门神”在改变状态的时候可以选择通过还是不通过。</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyCompo</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.state = &#123;</span><br><span class="line">            a: <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.update = (<span class="keyword">this</span>.update).bind(<span class="keyword">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    update()&#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;<span class="string">"a"</span>: <span class="built_in">parseInt</span>(<span class="built_in">Math</span>.random() * <span class="number">100</span>)&#125;);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.state.a);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    shouldComponentUpdate(nextProps,nextState)&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"更新之前"</span>,nextProps,nextState.a);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;p&gt;</span><br><span class="line">                    This is MyCompo attr &#123;<span class="keyword">this</span>.state.a&#125;</span><br><span class="line">                    &lt;input type=<span class="string">"button"</span> value=<span class="string">"点击"</span> onClick=&#123;<span class="keyword">this</span>.update&#125; /&gt;</span><br><span class="line">                &lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>div&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> MyCompo;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">更新之前 &#123;<span class="attr">a</span>: <span class="string">"100"</span>&#125; <span class="number">50</span>      <span class="comment">// shouldComponentUpdate 还可以得到更新之前的 props 和 state 对象</span></span><br></pre></td></tr></table></figure>
<h1 id="React-router"><a href="#React-router" class="headerlink" title="React-router"></a>React-router</h1><p>React-router 可以让根组件动态的去挂载不同的其他组件，根据用户访问的地址，动态的加载不同的组件。</p>
<ul>
<li>安装</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install --save react-router</span><br></pre></td></tr></table></figure>
<ul>
<li>可引入的包</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; BrowserRouter <span class="keyword">as</span> Router, Link, Redirect, withRouter &#125; <span class="keyword">from</span> <span class="string">"react-router-dom"</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>BrowserRouter 和 HashRouter</li>
</ul>
<p>BrowserRouter 和 HashRouter 都可以实现前端路由的功能，区别是前者基于 url 的 pathname 段，后者基于 hash 段。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">前者：http://127.0.0.1:3000/article/num1</span><br><span class="line"></span><br><span class="line">后者：http://127.0.0.1:3000/#/article/num1（不一定是这样，但#是少不了的）</span><br></pre></td></tr></table></figure>
<h2 id="组件路由"><a href="#组件路由" class="headerlink" title="组件路由"></a>组件路由</h2><ul>
<li>使用 Router 组件，下面是 index 组件包含了两个组件：Home、News，index 能够根据访问地址来显示不同的组件</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; BrowserRouter <span class="keyword">as</span> Router, Route, Link &#125; <span class="keyword">from</span> <span class="string">"react-router-dom"</span>;</span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">"./components/Home.js"</span>;</span><br><span class="line"><span class="keyword">import</span> News <span class="keyword">from</span> <span class="string">"./components/News.js"</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;Router&gt;</span><br><span class="line">                &lt;div&gt;</span><br><span class="line">                    &lt;ul&gt;</span><br><span class="line">                        &lt;li&gt;<span class="xml"><span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">"/"</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span>&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">                        &lt;li&gt;&lt;Link to="/</span>news<span class="string">"&gt;News&lt;/Link&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">                    &lt;/ul&gt;</span></span><br><span class="line"><span class="string">                    &lt;div&gt;</span></span><br><span class="line"><span class="string">                        &lt;Route exact path="</span>/<span class="string">" component=&#123;Home&#125; /&gt;</span></span><br><span class="line"><span class="string">                        &lt;Route path="</span>/news<span class="string">" component=&#123;News&#125; /&gt;</span></span><br><span class="line"><span class="string">                    &lt;/div&gt;</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;/Router&gt;</span></span><br><span class="line"><span class="string">        )</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">ReactDOM.render(</span></span><br><span class="line"><span class="string">    &lt;div&gt;</span></span><br><span class="line"><span class="string">        &lt;App&gt;&lt;/App&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;,</span></span><br><span class="line">    document.querySelector("#app")</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h2 id="动态路由传参"><a href="#动态路由传参" class="headerlink" title="动态路由传参"></a>动态路由传参</h2><ul>
<li>index 组件中的 Router 根据访问地址来显示不同的组件，path 中的 <code>:key</code> 用来接收连接地址中的某个值，Router 将这个值传递给被路由的组件的 props.match.params 中。</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; BrowserRouter <span class="keyword">as</span> Router, Route, Link &#125; <span class="keyword">from</span> <span class="string">"react-router-dom"</span>;</span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">"./components/Home.js"</span>;</span><br><span class="line"><span class="keyword">import</span> News <span class="keyword">from</span> <span class="string">"./components/News.js"</span>;</span><br><span class="line"><span class="keyword">import</span> Content <span class="keyword">from</span> <span class="string">"./components/Content.js"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;Router&gt;</span><br><span class="line">                &lt;div&gt;</span><br><span class="line">                    &lt;ul&gt;</span><br><span class="line">                        &lt;li&gt;<span class="xml"><span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">"/"</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span>&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">                        &lt;li&gt;&lt;Link to="/</span>news<span class="string">"&gt;News&lt;/Link&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">                    &lt;/ul&gt;</span></span><br><span class="line"><span class="string">                    &lt;div&gt;</span></span><br><span class="line"><span class="string">                        &lt;Route exact path="</span>/<span class="string">" component=&#123;Home&#125; /&gt;</span></span><br><span class="line"><span class="string">                        &lt;Route path="</span>/news<span class="string">" component=&#123;News&#125; /&gt;</span></span><br><span class="line"><span class="string">                        &lt;Route path="</span>/news/content/:value<span class="string">" component=&#123;Content&#125; /&gt;</span></span><br><span class="line"><span class="string">                    &lt;/div&gt;</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;/Router&gt;</span></span><br><span class="line"><span class="string">        )</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ReactDOM.render(</span></span><br><span class="line"><span class="string">    &lt;div&gt;</span></span><br><span class="line"><span class="string">        &lt;App&gt;&lt;/App&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;,</span></span><br><span class="line">    document.querySelector("#app")</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ul>
<li>News 标题组件，生成有路由跳转的功能的标签</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Link &#125; <span class="keyword">from</span> <span class="string">"react-router-dom"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">News</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;h1&gt;新闻组件&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">                &lt;ul&gt;</span></span><br><span class="line"><span class="regexp">                    &lt;li&gt;&lt;Link to="/</span>news/content/<span class="number">1</span><span class="string">"&gt;第一条新闻&lt;/Link&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">                    &lt;li&gt;&lt;Link to="</span>/news/content/<span class="number">2</span><span class="string">"&gt;第二条新闻&lt;/Link&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">                    &lt;li&gt;&lt;Link to="</span>/news/content/<span class="number">3</span><span class="string">"&gt;第三条新闻&lt;/Link&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">                    &lt;li&gt;&lt;Link to="</span>/news/content/<span class="number">4</span><span class="string">"&gt;第四条新闻&lt;/Link&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">                &lt;/ul&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">        )</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">export default News;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Content 新闻正文组件，根据不同的参数展示不同的新闻，接收到来自 Router 组件的 path 传递过来的值，根据这个值来展示不同的内容</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Content</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.state = &#123;</span><br><span class="line">            list: [<span class="string">"第一条新闻正文"</span>, <span class="string">"第二条新闻正文"</span>, <span class="string">"第三条新闻正文"</span>, <span class="string">"第四条新闻正文"</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    componentDidMount() &#123;</span><br><span class="line">        <span class="keyword">let</span> value = <span class="keyword">this</span>.props.match.params.value;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">typeof</span> value, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">let</span> id = <span class="built_in">parseInt</span>(<span class="keyword">this</span>.props.match.params.value) - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;p&gt;&#123;<span class="keyword">this</span>.state.list[id]&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Content;</span><br></pre></td></tr></table></figure>
<h2 id="路由查询字符串"><a href="#路由查询字符串" class="headerlink" title="路由查询字符串"></a>路由查询字符串</h2><ul>
<li>index 组件中的 Router 根据访问地址来显示不同的组件，Router 在调用组件时候，会向组件的 props.location.search 中传递本次的查询字符串</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; BrowserRouter <span class="keyword">as</span> Router, Route, Link &#125; <span class="keyword">from</span> <span class="string">"react-router-dom"</span>;</span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">"./components/Home.js"</span>;</span><br><span class="line"><span class="keyword">import</span> Product <span class="keyword">from</span> <span class="string">"./components/Product.js"</span>;</span><br><span class="line"><span class="keyword">import</span> Commodity <span class="keyword">from</span> <span class="string">"./components/Commodity.js"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;Router&gt;</span><br><span class="line">                &lt;div&gt;</span><br><span class="line">                    &lt;ul&gt;</span><br><span class="line">                        &lt;li&gt;<span class="xml"><span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">"/"</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span>&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">                        &lt;li&gt;&lt;Link to="/</span>product<span class="string">"&gt;Product&lt;/Link&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">                    &lt;/ul&gt;</span></span><br><span class="line"><span class="string">                    &lt;div&gt;</span></span><br><span class="line"><span class="string">                        &lt;Route exact path="</span>/<span class="string">" component=&#123;Home&#125; /&gt;</span></span><br><span class="line"><span class="string">                        &lt;Route path="</span>/product<span class="string">" component=&#123;Product&#125; /&gt;</span></span><br><span class="line"><span class="string">                        &lt;Route path="</span>/product/commodity<span class="string">" component=&#123;Commodity&#125; /&gt;</span></span><br><span class="line"><span class="string">                    &lt;/div&gt;</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;/Router&gt;</span></span><br><span class="line"><span class="string">        )</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ReactDOM.render(</span></span><br><span class="line"><span class="string">    &lt;div&gt;</span></span><br><span class="line"><span class="string">        &lt;App&gt;&lt;/App&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;,</span></span><br><span class="line">    document.querySelector("#app")</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ul>
<li>Product 标题组件，生成有路由跳转的功能的标签</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Link &#125; <span class="keyword">from</span> <span class="string">"react-router-dom"</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Product</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;h1&gt;商品组件&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">                &lt;ul&gt;</span></span><br><span class="line"><span class="regexp">                    &lt;li&gt;&lt;Link to="/</span>product/commodity?id=<span class="number">1</span><span class="string">"&gt;第一个商品&lt;/Link&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">                    &lt;li&gt;&lt;Link to="</span>/product/commodity?id=<span class="number">2</span><span class="string">"&gt;第二个商品&lt;/Link&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">                    &lt;li&gt;&lt;Link to="</span>/product/commodity?id=<span class="number">3</span><span class="string">"&gt;第三个商品&lt;/Link&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">                    &lt;li&gt;&lt;Link to="</span>/product/commodity?id=<span class="number">4</span><span class="string">"&gt;第四个商品&lt;/Link&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">                &lt;/ul&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">        )</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">export default Product;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Commodity 商品详情组件，接收到来自 Router 组件的 path 传递过来的 props.location.search 中的值，自己写函数处理值（或者用 url库），根据这个值来展示不同的内容</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> url <span class="keyword">from</span> <span class="string">"url"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Content</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.state = &#123;</span><br><span class="line">            list: [<span class="string">"第一个商品"</span>, <span class="string">"第二个商品"</span>, <span class="string">"第三个商品"</span>, <span class="string">"第四个商品"</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    componentDidMount() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.props.location.search);</span><br><span class="line">        <span class="built_in">console</span>.log(url.parse(<span class="keyword">this</span>.props.location.search,<span class="literal">true</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">let</span> query = url.parse(<span class="keyword">this</span>.props.location.search,<span class="literal">true</span>).query.id;</span><br><span class="line">        <span class="keyword">let</span> id = <span class="built_in">parseInt</span>(query) - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;p&gt;&#123;<span class="keyword">this</span>.state.list[id]&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Content;</span><br></pre></td></tr></table></figure>
<h2 id="JS调用路由跳转"><a href="#JS调用路由跳转" class="headerlink" title="JS调用路由跳转"></a>JS调用路由跳转</h2><ul>
<li>原理解析</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">- 首先在登录页面定义一个能够引发试图重绘的 flag 例如：<span class="keyword">this</span>.state</span><br><span class="line">- 在登录页面 render <span class="keyword">return</span> 之前定义一个条件如果 flag 改变则调用 Redirect 函数跳转路由，否则继续渲染登录页</span><br><span class="line">- 当表单提交事件函数执行，如果登录验证成功，则修改 flag 它会引发试图重绘</span><br><span class="line">- 当 render 重绘视图的时候会执行 flag 验证条件，调用 Redirect 函数跳转到登录后页面</span><br></pre></td></tr></table></figure>
<ul>
<li>index.js 组件中的 Router 根据访问地址来显示不同的组件</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; BrowserRouter <span class="keyword">as</span> Router, Route, Link &#125; <span class="keyword">from</span> <span class="string">"react-router-dom"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">"./components/Home.js"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Login <span class="keyword">from</span> <span class="string">"./components/Login.js"</span>;</span><br><span class="line"><span class="keyword">import</span> LoginUser <span class="keyword">from</span> <span class="string">"./components/LoginUser.js"</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;Router&gt;</span><br><span class="line">                &lt;div&gt;</span><br><span class="line">                    &lt;ul&gt;</span><br><span class="line">                        &lt;li&gt;<span class="xml"><span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">"/"</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span>&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">                        &lt;li&gt;&lt;Link to="/</span>login<span class="string">"&gt;Login&lt;/Link&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">                    &lt;/ul&gt;</span></span><br><span class="line"><span class="string">                    &lt;div&gt;</span></span><br><span class="line"><span class="string">                        &lt;Route exact path="</span>/<span class="string">" component=&#123;Home&#125; /&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                        &lt;Route path="</span>/login<span class="string">" component=&#123;Login&#125; /&gt;</span></span><br><span class="line"><span class="string">                        &lt;Route path="</span>/user<span class="string">" component=&#123;LoginUser&#125; /&gt;</span></span><br><span class="line"><span class="string">                    &lt;/div&gt;</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;/Router&gt;</span></span><br><span class="line"><span class="string">        )</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ReactDOM.render(</span></span><br><span class="line"><span class="string">    &lt;div&gt;</span></span><br><span class="line"><span class="string">        &lt;App&gt;&lt;/App&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;,</span></span><br><span class="line">    document.querySelector("#app")</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ul>
<li>Login.js 登录框，判断用户名密码决定是否跳转路由</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Redirect &#125; <span class="keyword">from</span> <span class="string">"react-router-dom"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Login</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.state = &#123;</span><br><span class="line">            login_flag: <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.login = <span class="keyword">this</span>.login.bind(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    login(event) &#123;</span><br><span class="line">        <span class="comment">// 阻止浏览器默认提交跳转行为</span></span><br><span class="line">        event.preventDefault();</span><br><span class="line">        <span class="keyword">let</span> username = <span class="keyword">this</span>.refs.username.value;</span><br><span class="line">        <span class="keyword">let</span> password = <span class="keyword">this</span>.refs.password.value;</span><br><span class="line">        <span class="keyword">if</span> (username == <span class="string">"admin"</span> &amp;&amp; password == <span class="string">"admin"</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.setState(&#123; <span class="string">"login_flag"</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            alert(<span class="string">"登录失败"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.state.login_flag) &#123;</span><br><span class="line">            <span class="comment">// return &lt;Redirect to="/user" /&gt;</span></span><br><span class="line">            <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Redirect</span> <span class="attr">to</span>=<span class="string">&#123;&#123;</span> <span class="attr">pathname:</span> "/<span class="attr">user</span>" &#125;&#125; /&gt;</span></span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;h1&gt;登录&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">                &lt;form onSubmit=&#123;this.login&#125;&gt;</span></span><br><span class="line"><span class="regexp">                    &lt;p&gt;&lt;input type="text" ref="username" /</span>&gt;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">                    &lt;p&gt;&lt;input type="text" ref="password" /</span>&gt;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">                    &lt;p&gt;&lt;input type="submit" value="登录" /</span>&gt;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">                &lt;/</span>form&gt;</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        )</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default Login;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>登录后页面</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginUser</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;h1&gt;用户已经登录&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> LoginUser;</span><br></pre></td></tr></table></figure>
<h2 id="嵌套路由"><a href="#嵌套路由" class="headerlink" title="嵌套路由"></a>嵌套路由</h2><ul>
<li>index.js 组件中的 Router 根据访问地址来显示不同的组件</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; BrowserRouter <span class="keyword">as</span> Router, Route, Link &#125; <span class="keyword">from</span> <span class="string">"react-router-dom"</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">"./css/main.css"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">"./components/Home.js"</span>;</span><br><span class="line"><span class="keyword">import</span> User <span class="keyword">from</span> <span class="string">"./components/User.js"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;Router&gt;</span><br><span class="line">                &lt;div&gt;</span><br><span class="line">                    &lt;ul className=<span class="string">"nav"</span>&gt;</span><br><span class="line">                        &lt;Link to=<span class="string">"/"</span>&gt;Home&lt;<span class="regexp">/Link&gt; &lt;Link to="/u</span>ser<span class="string">"&gt;User&lt;/Link&gt;</span></span><br><span class="line"><span class="string">                    &lt;/ul&gt;</span></span><br><span class="line"><span class="string">                    &lt;div&gt;</span></span><br><span class="line"><span class="string">                        &lt;Route exact path="</span>/<span class="string">" component=&#123;Home&#125; /&gt;</span></span><br><span class="line"><span class="string">                        &lt;Route path="</span>/user<span class="string">" component=&#123;User&#125; /&gt;</span></span><br><span class="line"><span class="string">                    &lt;/div&gt;</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;/Router&gt;</span></span><br><span class="line"><span class="string">        )</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ReactDOM.render(</span></span><br><span class="line"><span class="string">    &lt;div&gt;</span></span><br><span class="line"><span class="string">        &lt;App&gt;&lt;/App&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;,</span></span><br><span class="line">    document.querySelector("#app")</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ul>
<li>User.js 内部嵌套了 Route。</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Route, Link &#125; <span class="keyword">from</span> <span class="string">"react-router-dom"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Center <span class="keyword">from</span> <span class="string">"./user/Center.js"</span>;</span><br><span class="line"><span class="keyword">import</span> Info <span class="keyword">from</span> <span class="string">"./user/Info.js"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div className=<span class="string">"user"</span>&gt;</span><br><span class="line">                &lt;div className=<span class="string">"content"</span>&gt;</span><br><span class="line">                    &lt;div className=<span class="string">"left"</span>&gt;</span><br><span class="line">                        &lt;ul&gt;</span><br><span class="line">                            &lt;li&gt;<span class="xml"><span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">"/user/"</span>&gt;</span>个人中心<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span>&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">                            &lt;li&gt;&lt;Link to="/u</span>ser/info<span class="string">"&gt;用户信息&lt;/Link&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">                        &lt;/ul&gt;</span></span><br><span class="line"><span class="string">                    &lt;/div&gt;</span></span><br><span class="line"><span class="string">                    &lt;div className="</span>right<span class="string">"&gt;</span></span><br><span class="line"><span class="string">                        &lt;div&gt;</span></span><br><span class="line"><span class="string">                            &#123;/* /user页面下默认路由，也就是默认展示的模块 */&#125;</span></span><br><span class="line"><span class="string">                            &lt;Route exact path="</span>/user/<span class="string">" component=&#123;Center&#125; /&gt;</span></span><br><span class="line"><span class="string">                            &lt;Route path="</span>/user/info<span class="string">" component=&#123;Info&#125; /&gt;</span></span><br><span class="line"><span class="string">                        &lt;/div&gt;</span></span><br><span class="line"><span class="string">                    &lt;/div&gt;</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">        )</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">export default User;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Center.js、Info.js 内容就是一个文字</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Info</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;h1&gt;用户信息&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Info;</span><br></pre></td></tr></table></figure>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Center</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;h1&gt;个人中心&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Center;</span><br></pre></td></tr></table></figure>
<ul>
<li>css 样式</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">.nav &#123;</span><br><span class="line">    width: <span class="number">100</span>%;</span><br><span class="line">    background-color: #000;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.nav a &#123;</span><br><span class="line">    color: #fff;</span><br><span class="line">    line-height: <span class="number">35</span>px;</span><br><span class="line">    text-decoration: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.content &#123;</span><br><span class="line">    width: <span class="number">100</span>%;</span><br><span class="line">    height: <span class="number">500</span>px;</span><br><span class="line">    display: flex;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.content .left &#123;</span><br><span class="line">    width: <span class="number">200</span>px;</span><br><span class="line">    height: <span class="number">500</span>px;</span><br><span class="line">    background-color: #666;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.content .left a &#123;</span><br><span class="line">    color: #fff;</span><br><span class="line">    text-decoration: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.content .right &#123;</span><br><span class="line">    flex: <span class="number">1</span>;</span><br><span class="line">    height: <span class="number">500</span>px;</span><br><span class="line">    border: 1px solid #333;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="路由模块化"><a href="#路由模块化" class="headerlink" title="路由模块化"></a>路由模块化</h2><ul>
<li>非嵌套路由模块化，首先定义一个路由的数组，将每条路由用对象的方式列出来，然后在组件内使用 map 展开这个数组</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; BrowserRouter <span class="keyword">as</span> Router, Route, Link &#125; <span class="keyword">from</span> <span class="string">"react-router-dom"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">"./components/Home.js"</span>;</span><br><span class="line"><span class="keyword">import</span> User <span class="keyword">from</span> <span class="string">"./components/User.js"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> routers = [</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">"/"</span>, <span class="attr">component</span>: Home, <span class="attr">exact</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">"/user"</span>, <span class="attr">component</span>: User &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">&#123;routers.map(<span class="function">(<span class="params">route, index</span>) =&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">Route</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span> &#123;<span class="attr">...route</span>&#125; /&gt;</span></span>)&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>嵌套路由模块化，首先定义一个嵌套路由的数组，然后定义带有嵌套路由的组件，最后在主模块中展开主路由，在子模块的 props 中展开子路由</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; BrowserRouter <span class="keyword">as</span> Router, Route, Link &#125; <span class="keyword">from</span> <span class="string">"react-router-dom"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">"./components/Home.js"</span>;</span><br><span class="line"><span class="keyword">import</span> User <span class="keyword">from</span> <span class="string">"./components/User.js"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Center <span class="keyword">from</span> <span class="string">"./components/user/Center.js"</span>;</span><br><span class="line"><span class="keyword">import</span> Info <span class="keyword">from</span> <span class="string">"./components/user/Info.js"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义嵌套路由的数组</span></span><br><span class="line"><span class="keyword">let</span> routers = [</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">"/"</span>, <span class="attr">component</span>: Home, <span class="attr">exact</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">"/user"</span>, <span class="attr">component</span>: User, <span class="attr">routes</span>: [&#123; <span class="attr">path</span>: <span class="string">"/user/"</span>, <span class="attr">component</span>: Center, <span class="attr">exact</span>: <span class="literal">true</span> &#125;, &#123; <span class="attr">path</span>: <span class="string">"/user/info"</span>, <span class="attr">component</span>: Info &#125;] &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">&lt;ul className=<span class="string">"nav"</span>&gt;</span><br><span class="line">    &lt;Link to=<span class="string">"/"</span>&gt;Home&lt;<span class="regexp">/Link&gt;</span></span><br><span class="line"><span class="regexp">    &lt;Link to="/u</span>ser<span class="string">"&gt;User&lt;/Link&gt;</span></span><br><span class="line"><span class="string">&lt;/ul&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// 在主路由中展开路由，并向在路由中给子组件的 props 中注入子路由信息</span></span><br><span class="line"><span class="string">&lt;div&gt;</span></span><br><span class="line"><span class="string">    &#123;routers.map((route, index) =&gt; (</span></span><br><span class="line"><span class="string">        &lt;Route key=&#123;index&#125; path=&#123;route.path&#125; exact=&#123;route.exact&#125; render=&#123;(props) =&gt; (&lt;route.component &#123;...props&#125; routes=&#123;route.routes&#125; /&gt;)&#125; /&gt;)</span></span><br><span class="line"><span class="string">    )&#125;</span></span><br><span class="line"><span class="string">&lt;/div&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Route, Link &#125; <span class="keyword">from</span> <span class="string">"react-router-dom"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子模块不需要再引用它的子模块了</span></span><br><span class="line"><span class="comment">// import Center from "./components/user/Center.js";</span></span><br><span class="line"><span class="comment">// import Info from "./components/user/Info.js";</span></span><br><span class="line"></span><br><span class="line">&lt;ul&gt;</span><br><span class="line">    &lt;li&gt;<span class="xml"><span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">"/user/"</span>&gt;</span>个人中心<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span>&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">    &lt;li&gt;&lt;Link to="/u</span>ser/info<span class="string">"&gt;用户信息&lt;/Link&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">&lt;/ul&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// 在子模块中展开路由</span></span><br><span class="line"><span class="string">&lt;div&gt;</span></span><br><span class="line"><span class="string">    &#123;this.props.routes.map((route, index) =&gt; &lt;Route key=&#123;index&#125; &#123;...route&#125; /&gt;)&#125;</span></span><br><span class="line"><span class="string">&lt;/div&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>路由文件外置的模块化</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">将路由的数组定义在外置的 js 文件中，在主模块中引入该路由外置文件，就彻底实现路由的模块化了。</span><br></pre></td></tr></table></figure>
<h1 id="Redux"><a href="#Redux" class="headerlink" title="Redux"></a>Redux</h1><ul>
<li>安装</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">npm install --save redux react-redux</span><br></pre></td></tr></table></figure>
<h2 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h2><h3 id="Action"><a href="#Action" class="headerlink" title="Action"></a>Action</h3><p>Action 本质上是一个函数返回了一个普通对象。我们约定，action 内必须使用一个字符串类型的 <code>type</code> 字段来表示将要执行的动作。多数情况下，<code>type</code> 会被定义成字符串常量，除了 <code>type</code> 字段外，action 对象的结构完全由你自己决定。</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Add = <span class="function">(<span class="params">id, value</span>) =&gt;</span> (&#123; <span class="string">"type"</span>: <span class="string">"Add"</span>, <span class="string">"id"</span>: id , <span class="string">"value"</span>: value&#125;);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Delete = <span class="function">(<span class="params">id</span>) =&gt;</span> (&#123; <span class="string">"type"</span>: <span class="string">"Delete"</span>, <span class="string">"id"</span>: id &#125;);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Update = <span class="function">(<span class="params">value</span>) =&gt;</span> (&#123; <span class="string">"type"</span>: <span class="string">"Update"</span>, <span class="string">"value"</span>: value &#125;);</span><br></pre></td></tr></table></figure>
<h3 id="Reducer"><a href="#Reducer" class="headerlink" title="Reducer"></a>Reducer</h3><p>reducer 是一个纯函数它接收两个参数：previousState（旧的state） 和 action（来自页面的事件） 的操作，并且返回一个新的 state。</p>
<ul>
<li>注意事项</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">- 不要在这个函数中直接修改传入的参数；</span><br><span class="line">- 执行有副作用的操作，如：API 请求和跳转；</span><br><span class="line">- 调用非纯函数，如：Date.now() 或 Math.random()，因为它们的执行结果每次都不同。</span><br></pre></td></tr></table></figure>
<ul>
<li>reducer 示例，state 在这个地方赋予初始值，不修改原 state 并返回新的 state</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (state, action) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (state == <span class="literal">undefined</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123; <span class="string">"R"</span>: <span class="number">0</span>, <span class="string">"G"</span>: <span class="number">0</span>, <span class="string">"B"</span>: <span class="number">0</span> &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"change"</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123; ...state, [action.color]: action.value &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> state;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>注意事项</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">- 一定不要直接修改 state ，二是返回新的 state 可以使用 &#123; ...previousState, &quot;key&quot; : value &#125; 来生成对象；</span><br><span class="line">- 只在 action 匹配时候，返回新的 state，没有匹配则必须返回原来的 state。</span><br></pre></td></tr></table></figure>
<h3 id="Store"><a href="#Store" class="headerlink" title="Store"></a>Store</h3><p>action 来描述发生了什么，reducers 是根据 action 来更新 state 的纯函数，而 store 就是把它们联系到一起的对象。Store 有以下职责：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">- 维持应用的 state；</span><br><span class="line">- 提供 getState() 方法获取 state；</span><br><span class="line">- 提供 dispatch(action) 方法更新 state；</span><br><span class="line">- 通过 subscribe(listener) 注册监听器;</span><br><span class="line">- 通过 subscribe(listener) 返回的函数注销监听器。</span><br></pre></td></tr></table></figure>
<p>强调一下 Redux 应用只有一个单一的 store，当需要拆分数据处理逻辑时，你应该使用 reducer 组合 而不是创建多个 store。</p>
<ul>
<li>创建 store</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">'redux'</span></span><br><span class="line"><span class="keyword">import</span> todoApp <span class="keyword">from</span> <span class="string">'./reducers'</span></span><br><span class="line"><span class="keyword">let</span> store = createStore(todoApp)</span><br></pre></td></tr></table></figure>
<p>createStore() 的第二个参数是可选的, 用于设置 state 初始状态。这对开发同构应用时非常有用，服务器端 redux 应用的 state 结构可以与客户端保持一致, 那么客户端可以将从网络接收到的服务端 state 直接用于本地数据初始化。</p>
<h3 id="combineReducers"><a href="#combineReducers" class="headerlink" title="combineReducers"></a>combineReducers</h3><p>随着应用变得复杂，需要对 reducer 函数 进行拆分，拆分后的每一块独立负责管理 state 的一部分。<br>combineReducers 辅助函数的作用是，把一个由多个不同 reducer 函数作为 value 的 object，合并成一个最终的 reducer 函数，然后就可以对这个 reducer 调用 createStore。<br>合并后的 reducer 可以调用各个子 reducer，并把它们的结果合并成一个 state 对象。state 对象的结构由传入的多个 reducer 的 key 决定。</p>
<h2 id="配合-react"><a href="#配合-react" class="headerlink" title="配合 react"></a>配合 react</h2><h3 id="Provider"><a href="#Provider" class="headerlink" title="Provider"></a>Provider</h3><p>这是 redux 提供的一个组件，这个组件身上的 props 属性，可以被它所有的子组件所调用。</p>
<p>这个组件使得它内部自定义的组件可以使用 connect 函数，通常你不能在没有 provider 父组件的情况下使用 connect 函数。</p>
<p>Provider 要传入一个 props，名字叫 store ，而 store 的值是 Redux.createStore(reducer) 创建而来的。</p>
<ul>
<li>示例</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span></span><br><span class="line"><span class="keyword">import</span> &#123; render &#125; <span class="keyword">from</span> <span class="string">"react-dom"</span></span><br><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">"redux"</span></span><br><span class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">"recat-redux"</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">"./App.js"</span></span><br><span class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">"./reducers.js"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = createStore(reducer);</span><br><span class="line"></span><br><span class="line">render(</span><br><span class="line">	&lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">        &lt;App /&gt;</span><br><span class="line">    &lt;<span class="regexp">/Provider&gt;,</span></span><br><span class="line"><span class="regexp">    document.getElementById("root")</span></span><br><span class="line"><span class="regexp">)</span></span><br></pre></td></tr></table></figure>
<h3 id="connect"><a href="#connect" class="headerlink" title="connect"></a>connect</h3><p>将 React Component(React组件) 和 Redux store 进行连接，将一个值是 action creators 的对象转换为具有同样键名的对象，但是这个新对象的值是已经被 dispatch 包裹了的 action，这样一来它们可以直接被调用。</p>
<ul>
<li>store</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> reducer = <span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (state == <span class="literal">undefined</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123; <span class="string">"v"</span>: <span class="number">0</span>, <span class="string">"a"</span>: <span class="number">1</span>, <span class="string">"b"</span>: <span class="number">2</span> &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"ZENGJIA"</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123; ...state, <span class="string">"v"</span>: state.v + <span class="number">1</span> &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"JIANSHAO"</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123; ...state, <span class="string">"v"</span>: state.v - <span class="number">1</span> &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"ZENGJIABUMBER"</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123; ...state, <span class="string">"v"</span>: state.v + action.number &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> state;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> store = createStore(reducer);</span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">    &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">        &lt;App&gt;&lt;<span class="regexp">/App&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>Provider&gt;,</span><br><span class="line">    <span class="built_in">document</span>.querySelector(<span class="string">"#app"</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ul>
<li>connect 函数接收两个参数，这两个参数为函数</li>
</ul>
<p>第一个函数，接收 store 返回一个对象这个对象会成为组件的 props。</p>
<p>第二个函数，接收 dispatch 返回一个 actions 对象会自动成为组件的 props，</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">"react-redux"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; bindActionCreators &#125; <span class="keyword">from</span> <span class="string">"redux"</span>;</span><br><span class="line"></span><br><span class="line">actions = &#123;</span><br><span class="line">    zengjia: <span class="function"><span class="params">()</span> =&gt;</span> (&#123; <span class="string">"type"</span>: <span class="string">"ZENGJIA"</span> &#125;),</span><br><span class="line">    jianshao = <span class="function"><span class="params">()</span> =&gt;</span> (&#123; <span class="string">"type"</span>: <span class="string">"JIANSHAO"</span> &#125;),</span><br><span class="line">    zengjianumber = <span class="function">(<span class="params">number</span>) =&gt;</span> (&#123; <span class="string">"type"</span>: <span class="string">"ZENGJIABUMBER"</span>, <span class="attr">number</span>: number &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    zengjianumber() &#123;</span><br><span class="line">        <span class="keyword">var</span> number = <span class="built_in">Number</span>(<span class="keyword">this</span>.refs.numberTxt.value);</span><br><span class="line">        <span class="keyword">this</span>.props.actions.zengjianumber(number);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;h1&gt;&#123;<span class="keyword">this</span>.props.v&#125;&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">                &lt;button onClick=&#123;this.props.actions.zengjia&#125;&gt;+&lt;/</span>button&gt;</span><br><span class="line">                &amp;nbsp;</span><br><span class="line">                &lt;button onClick=&#123;<span class="keyword">this</span>.props.actions.jianshao&#125;&gt;-&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">                &lt;p&gt;</span></span><br><span class="line"><span class="regexp">                    &lt;input type="text" ref="numberTxt" /</span>&gt;</span><br><span class="line">                    &lt;input type=<span class="string">"button"</span> value=<span class="string">"按我增加这么多"</span> onClick=&#123;(<span class="keyword">this</span>.zengjianumber).bind(<span class="keyword">this</span>)&#125; /&gt;</span><br><span class="line">                &lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(</span><br><span class="line">    (state) =&gt; (</span><br><span class="line">        &#123;</span><br><span class="line">            v: state.v</span><br><span class="line">        &#125;</span><br><span class="line">    ),</span><br><span class="line">    (dispatch) =&gt; (</span><br><span class="line">         actions</span><br><span class="line">        <span class="comment">// 当 actions 是从外部文件导入的，如果把 dispatch 写在外部文件，会发现 dispatch 在外部文件内没有作用域，</span></span><br><span class="line">        <span class="comment">// 那么就需要 bindActionCreators 对 actions 和 dispatch 绑定。</span></span><br><span class="line">        <span class="comment">// bindActionCreators 本质上是函数与数据的绑定</span></span><br><span class="line">        <span class="comment">/*&#123;</span></span><br><span class="line"><span class="comment">            actions: bindActionCreators(actions, dispatch)</span></span><br><span class="line"><span class="comment">        &#125;*/</span></span><br><span class="line">    )</span><br><span class="line">)(App);</span><br></pre></td></tr></table></figure>
<ul>
<li>bindActionCreators 原理解析</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 数据，把它比作 actions</span></span><br><span class="line"><span class="keyword">let</span> data = &#123;</span><br><span class="line">    <span class="string">"a"</span>: <span class="number">123</span>,</span><br><span class="line">    <span class="string">"b"</span>: <span class="number">456</span>,</span><br><span class="line">    <span class="string">"c"</span>: <span class="number">789</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数，把它比作 dispatch</span></span><br><span class="line"><span class="keyword">let</span> show = <span class="function">(<span class="params">number</span>) =&gt;</span> (</span><br><span class="line">    &#123; <span class="string">"type"</span>: <span class="string">"TEST"</span>, <span class="string">"number"</span>: number &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 数据和函数没有关系，所以需要通过函数调用数据</span></span><br><span class="line"><span class="comment">// console.log(show(data.c));</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 想实现 bind.a() 就能得到 data.a 的值，那么</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果将数据和函数合并为一个对象，那么就方便调用了</span></span><br><span class="line"><span class="keyword">let</span> bind = <span class="function">(<span class="params">data, show</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> obj = &#123;&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> k <span class="keyword">in</span> data) &#123;</span><br><span class="line">        obj[k] = <span class="function"><span class="params">()</span> =&gt;</span> show(data[k]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> new_show = bind(data,show)</span><br><span class="line"><span class="built_in">console</span>.log(new_show.a());</span><br></pre></td></tr></table></figure>
<h2 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h2><h3 id="调色板"><a href="#调色板" class="headerlink" title="调色板"></a>调色板</h3><p>说一个小知识，我们可以通过 npm 安装 jquery 了，而不是浏览器下载，此时 jquery 可以和 CMD 规范比如 webpack 构建工具完美结合，向外 export default 了自己的 jquery 函数（$）。</p>
<p>组件的数据三兄弟：state、props、context 不管是谁发生改变，都会引起 render() 执行，视图会被 DIFF 算法计算后重绘，但构造函数不会重新执行，但是生命周期函数（componentWillUpdate）会被执行。</p>
<p>所以无论基于什么理由，都不需要将全局的 state 用自己组件的 state 接收，因为全局 state 数据变动后不会再走构造函数了，所以直接在组件内使用 this.props 即可。</p>
<ul>
<li>index.js</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">"redux"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">"react-redux"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">"./reducer.js"</span>;</span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">"./App.js"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> store = createStore(reducer);</span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">    &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">        &lt;App&gt;&lt;<span class="regexp">/App&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>Provider&gt;,</span><br><span class="line">    <span class="built_in">document</span>.querySelector(<span class="string">"#app"</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ul>
<li>./css/main.css</li>
</ul>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">500px</span>;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid burlywood;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.article</span> &#123;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>App.js</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">"react-redux"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; bindActionCreators &#125; <span class="keyword">from</span> <span class="string">"redux"</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">"./css/main.css"</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> actions <span class="keyword">from</span> <span class="string">"./actions.js"</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.change = <span class="keyword">this</span>.change.bind(<span class="keyword">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    change(event) &#123;</span><br><span class="line">        <span class="keyword">this</span>.props.actions.change(event.target.getAttribute(<span class="string">"data-color"</span>), <span class="built_in">parseInt</span>(event.target.value));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;div className=<span class="string">"box"</span> style=&#123;&#123; <span class="string">"backgroundColor"</span>: <span class="string">`rgb(<span class="subst">$&#123;<span class="keyword">this</span>.props.R&#125;</span>,<span class="subst">$&#123;<span class="keyword">this</span>.props.G&#125;</span>,<span class="subst">$&#123;<span class="keyword">this</span>.props.B&#125;</span>)`</span> &#125;&#125;&gt;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">                &lt;div className="article"&gt;</span></span><br><span class="line"><span class="regexp">                    &lt;p&gt;R：&lt;input type="range" min="0" max="255" data-color="R" value=&#123;this.props.R&#125; onChange=&#123;this.change&#125;&gt;&lt;/i</span>nput&gt;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">                    &lt;p&gt;G：&lt;input type="range" min="0" max="255" data-color="G" value=&#123;this.props.G&#125; onChange=&#123;this.change&#125;&gt;&lt;/i</span>nput&gt;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">                    &lt;p&gt;B：&lt;input type="range" min="0" max="255" data-color="B" value=&#123;this.props.B&#125; onChange=&#123;this.change&#125;&gt;&lt;/i</span>nput&gt;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">                    &lt;p&gt;&#123;`rgb($&#123;this.props.R&#125;,$&#123;this.props.G&#125;,$&#123;this.props.B&#125;)`&#125;&lt;/</span>p&gt;</span><br><span class="line">                &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(</span><br><span class="line">    (state) =&gt; (</span><br><span class="line">        &#123;</span><br><span class="line">            R: state.R,</span><br><span class="line">            G: state.G,</span><br><span class="line">            B: state.B</span><br><span class="line">        &#125;</span><br><span class="line">    ),</span><br><span class="line">    (dispatch) =&gt; (</span><br><span class="line">        &#123;</span><br><span class="line">            actions: bindActionCreators(actions, dispatch)</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">)(App);</span><br></pre></td></tr></table></figure>
<ul>
<li>reducer.js</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (state, action) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (state == <span class="literal">undefined</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123; <span class="string">"R"</span>: <span class="number">16</span>, <span class="string">"G"</span>: <span class="number">121</span>, <span class="string">"B"</span>: <span class="number">100</span> &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"change"</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123; ...state, [action.color]: action.value &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> state;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>actions.js</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> change = <span class="function">(<span class="params">color, value</span>) =&gt;</span> (&#123; <span class="string">"type"</span>: <span class="string">"change"</span>, <span class="string">"color"</span>: color, <span class="string">"value"</span>: value &#125;);</span><br></pre></td></tr></table></figure>
<h3 id="购物车"><a href="#购物车" class="headerlink" title="购物车"></a>购物车</h3><p>有时候子组件并不需要得到全局的数据，父组件可以通过枚举全局数据，然后为子组件分配一小部分的数据即可。</p>
<ul>
<li>reducer.js</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (state, action) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (state == <span class="literal">undefined</span>) &#123;</span><br><span class="line">        state = &#123;</span><br><span class="line">            <span class="string">"cart"</span>: [</span><br><span class="line">                &#123; <span class="string">"name"</span>: <span class="string">"电脑"</span>, <span class="string">"price"</span>: <span class="number">5000</span>, <span class="string">"amount"</span>: <span class="number">0</span> &#125;,</span><br><span class="line">                &#123; <span class="string">"name"</span>: <span class="string">"冰箱"</span>, <span class="string">"price"</span>: <span class="number">3000</span>, <span class="string">"amount"</span>: <span class="number">0</span> &#125;,</span><br><span class="line">                &#123; <span class="string">"name"</span>: <span class="string">"彩电"</span>, <span class="string">"price"</span>: <span class="number">2000</span>, <span class="string">"amount"</span>: <span class="number">0</span> &#125;</span><br><span class="line">            ],</span><br><span class="line">            <span class="string">"total"</span>: <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> state;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"change"</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123; ...state, [action.color]: action.value &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> state;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>app.js 父组件中 {this.arr} 自动展开了每个子组件，并向子组件传递它需要展示的数据，而不是全部</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">"react-redux"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; bindActionCreators &#125; <span class="keyword">from</span> <span class="string">"redux"</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">"./css/main.css"</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> actions <span class="keyword">from</span> <span class="string">"./actions.js"</span>;</span><br><span class="line"><span class="keyword">import</span> CartBar <span class="keyword">from</span> <span class="string">"./CartBar.js"</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;h1&gt;购物车&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">                &lt;p&gt;&#123;JSON.stringify(this.props.cart)&#125;&lt;/</span>p&gt;</span><br><span class="line">                &#123;<span class="keyword">this</span>.props.cart.map(</span><br><span class="line">                    (item, index) =&gt; (</span><br><span class="line">                        &lt;CartBar key=&#123;index&#125; item=&#123;item&#125; index=&#123;index&#125; /&gt;</span><br><span class="line">                    )</span><br><span class="line">                )&#125;</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        )</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default connect(</span></span><br><span class="line"><span class="regexp">    (state) =&gt; (</span></span><br><span class="line"><span class="regexp">        &#123;</span></span><br><span class="line"><span class="regexp">            "cart" : state.cart</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">    ),</span></span><br><span class="line"><span class="regexp">    (dispatch) =&gt; (</span></span><br><span class="line"><span class="regexp">        &#123;</span></span><br><span class="line"><span class="regexp">            actions: bindActionCreators(actions, dispatch)</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">)(App);</span></span><br></pre></td></tr></table></figure>
<ul>
<li>CartBar.js 子组件只需要知道它自己的那部分数据和操作数据的方法</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">"react-redux"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; bindActionCreators &#125; <span class="keyword">from</span> <span class="string">"redux"</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">"./css/main.css"</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> actions <span class="keyword">from</span> <span class="string">"./actions.js"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &#123;<span class="built_in">JSON</span>.stringify(<span class="keyword">this</span>.props.index)&#125; &#123;<span class="built_in">JSON</span>.stringify(<span class="keyword">this</span>.props.item)&#125;</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        )</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default connect(</span></span><br><span class="line"><span class="regexp"> 	null,</span></span><br><span class="line"><span class="regexp">    (dispatch) =&gt; (</span></span><br><span class="line"><span class="regexp">        &#123;</span></span><br><span class="line"><span class="regexp">            actions: bindActionCreators(actions, dispatch)</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">)(App);</span></span><br></pre></td></tr></table></figure>
<h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><h3 id="引用类型"><a href="#引用类型" class="headerlink" title="引用类型"></a>引用类型</h3><ul>
<li>注意下面示例中的全局 state 对象。</li>
</ul>
<p>全局 state 对象内部包含了一个数组，它是引用类型数据，当使用<code>新变量 = 全局 state，新变量[key] + 1，返回新变量</code> 的修改方式，相当于直接对原来的全局 state 修改，是无法修改数据的，所以需要用下面的方式。</p>
<p>当然返回新 state 方法还有很多，例如：map、filter、还有外部库：Ramda也可以返回一个新的 state 对象。</p>
<p>全局 state 太过于复杂的时候，我们还可能将它拆成几分。</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (state, action) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (state == <span class="literal">undefined</span>) &#123;</span><br><span class="line">        state = &#123;</span><br><span class="line">            <span class="string">"cart"</span>: [</span><br><span class="line">                &#123; <span class="string">"name"</span>: <span class="string">"电脑"</span>, <span class="string">"price"</span>: <span class="number">5000</span>, <span class="string">"amount"</span>: <span class="number">0</span> &#125;,</span><br><span class="line">                &#123; <span class="string">"name"</span>: <span class="string">"冰箱"</span>, <span class="string">"price"</span>: <span class="number">3000</span>, <span class="string">"amount"</span>: <span class="number">0</span> &#125;,</span><br><span class="line">                &#123; <span class="string">"name"</span>: <span class="string">"彩电"</span>, <span class="string">"price"</span>: <span class="number">2000</span>, <span class="string">"amount"</span>: <span class="number">0</span> &#125;</span><br><span class="line">            ],</span><br><span class="line">            <span class="string">"total"</span>: <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> state;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"ADD"</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                ...state,</span><br><span class="line">                <span class="string">"cart"</span>: state.cart.map(<span class="function">(<span class="params">value, index, arr</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (index == action.index) &#123;</span><br><span class="line">                        <span class="keyword">return</span> &#123; ...value, <span class="string">"amount"</span>: value[<span class="string">"amount"</span>] + <span class="number">1</span> &#125;;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span> value</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"MINUS"</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                ...state,</span><br><span class="line">                <span class="string">"cart"</span>: state.cart.map(<span class="function">(<span class="params">value, index, arr</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (index == action.index) &#123;</span><br><span class="line">                        <span class="keyword">return</span> &#123; ...value, <span class="string">"amount"</span>: value[<span class="string">"amount"</span>] - <span class="number">1</span> &#125;;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span> value</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> state;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Ramda库"><a href="#Ramda库" class="headerlink" title="Ramda库"></a>Ramda库</h3><p>reducer 在处理引用类型数据的时候会很麻烦，而 Ramda 里面提供了一项功能可以在操作 state 时候直接返回新的 state。</p>
<p><a href="http://www.ruanyifeng.com/blog/2017/03/ramda.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2017/03/ramda.html</a></p>
<h3 id="connect-1"><a href="#connect-1" class="headerlink" title="connect"></a>connect</h3><p>注意一个事情，就是一个类被 connect() 处理过，此时 props 此时其他 props 的改变，不会引发 render 的更新了，这是正确的，因为 connect() 表示我现在要读取全局的 state ，所以引发视图的改变，仅能通过 store 的改变。</p>
<h2 id="中间件"><a href="#中间件" class="headerlink" title="中间件"></a>中间件</h2><p>applyMiddleware 中间件被建议用于拓展用户自定义的 redux 功能，中间件让你的 store 的 dispath 被装饰起来，从而让程序开发变得直观高效。</p>
<p>中间件的特质是他们是可以组合的，多个中间件可以被组合在一起使用，这些中间件不需要知道在流程的前面和后面的事情。</p>
<p>中间件最通用的一个功能是提供对异步 actions 的支持，这些都不需要写非常复杂的代码，也不需要第三方库，让你的异步 actions 和同步 actions 变得一致了。</p>
<p>比如有一个中间件叫做 redux-thunk 这个东西让你的 action creaters 变得被 dispath 函数控制了。</p>
<p>redux-thunk 中，action creaters 都必须注入一个 dispcth 对象，这个对象现在可以被异步调用。</p>
<h3 id="Logger"><a href="#Logger" class="headerlink" title="Logger"></a>Logger</h3><p>任何对 store 的改变都会顺序执行 applyMiddleware() 参数中列出的中间件</p>
<ul>
<li>安装</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install --save-dev redux-logger</span><br></pre></td></tr></table></figure>
<ul>
<li>用法</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore, applyMiddleware &#125; <span class="keyword">from</span> <span class="string">"redux"</span>;</span><br><span class="line"><span class="keyword">import</span> logger <span class="keyword">from</span> <span class="string">'redux-logger'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> store = createStore(reducer, applyMiddleware(logger));</span><br></pre></td></tr></table></figure>
<ul>
<li>用法2，可以自定义选项创建自己的记录器</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; applyMiddleware, createStore &#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createLogger &#125; <span class="keyword">from</span> <span class="string">'redux-logger'</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> logger = createLogger(&#123;</span><br><span class="line">  <span class="comment">// ...options</span></span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> store = createStore(reducer, applyMiddleware(logger));</span><br></pre></td></tr></table></figure>
<ul>
<li>完成效果，每次当 action 被调用时候就会在控制台打印日志</li>
</ul>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">action ADD @ 15:01:59.289</span><br><span class="line">  redux-logger.js:1  prev state &#123;todoReducer: Array(3)&#125;</span><br><span class="line">  redux-logger.js:1  action     &#123;type: "ADD", index: Class&#125;</span><br><span class="line">  redux-logger.js:1  next state &#123;todoReducer: Array(3)&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>注意事项</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">logger 必须是最后一个中间件，否则它将记录 thunk 和 promise，而不是实际操作。</span><br></pre></td></tr></table></figure>
<h3 id="redux-thunk"><a href="#redux-thunk" class="headerlink" title="redux-thunk"></a>redux-thunk</h3><p>自己去写异步的流是根本无法完成的，但是有了 thunk 它允许异步操作了，redux-thunk，允许 redux 发出一个异步的 action ，当异步的请求得到结果，那么才执行回调函数中的 dispatch 方法。</p>
<ul>
<li>安装</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install --save redux-thunk</span><br><span class="line">import thunk from <span class="string">"redux-thunk"</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>调用 thunk 中间件</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> store = createStore(reducer, applyMiddleware(createLogger(), thunk));</span><br></pre></td></tr></table></figure>
<ul>
<li>使用 redux-thunk</li>
</ul>
<p>有了 thunk 中间件，那么组件中的  connect() 函数中就不能接收第二个参数了，redux-thunk 让所有组件的 props 中存在了 dispatch 方法，我们可以在任意一个组件中直接使用 dispatch 一个 action 了。</p>
<p>在绑定事件的时候，只需要用 dispatch 将当前上下文传递到 actions 中就可以了。</p>
<ul>
<li>actions.js 异步操作写在这里面</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> jquery <span class="keyword">from</span> <span class="string">'jquery'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 异步使用两次 dispatch</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> add = <span class="function">(<span class="params">dispatch</span>) =&gt;</span> &#123;</span><br><span class="line">    jquery.get(<span class="string">"file.txt"</span>, (data) =&gt; &#123;</span><br><span class="line">        <span class="keyword">let</span> number = <span class="built_in">Number</span>(data);</span><br><span class="line">        dispatch(&#123; <span class="string">"type"</span>: <span class="string">"ADD"</span>, <span class="string">"number"</span>: number &#125;)</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 同步操作只需要一次 dispatch</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> minus = &#123; <span class="string">"type"</span>: <span class="string">"MINUS"</span> &#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li>App.js 组件，现在调整 chrome 的网速为 3G slow ，再次加载网页，由于 ADD 操作是异步的所以能明显感到慢。</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">"react-redux"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; add, minus &#125; <span class="keyword">from</span> <span class="string">"./actions.js"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(&#123; a, dispatch &#125;) &#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;h1&gt;&#123;<span class="keyword">this</span>.props.state&#125;&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">                &lt;input type="button" value="点击我加数" onClick=&#123;this.props.dispatch.bind(this, add)&#125; /</span>&gt;</span><br><span class="line">                &lt;input type=<span class="string">"button"</span> value=<span class="string">"点击我减一"</span> onClick=&#123;<span class="keyword">this</span>.props.dispatch.bind(<span class="keyword">this</span>, minus)&#125; /&gt;</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        )</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default connect(</span></span><br><span class="line"><span class="regexp">    (state) =&gt; (</span></span><br><span class="line"><span class="regexp">        &#123;</span></span><br><span class="line"><span class="regexp">            state: state</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">)(App);</span></span><br></pre></td></tr></table></figure>
<h2 id="fatch"><a href="#fatch" class="headerlink" title="fatch"></a>fatch</h2><p>fatch 是 ajax 基于 promise 的实现，有 redux-thunk 就可以在 action 中使用 异步的 fatch 了。 </p>
<h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">fetch(input[, init])</span><br></pre></td></tr></table></figure>
<h3 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h3><ul>
<li>input，定义要获取的资源，可以是下面任意一个：</li>
</ul>
<table>
<thead>
<tr>
<th>资源</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>String</td>
<td>一个 USVString 字符串，包含要获取资源的 URL。一些浏览器会接受 blob: 和 data: 作为 schemes.</td>
</tr>
<tr>
<td>Object</td>
<td>一个 Request 对象。</td>
</tr>
</tbody>
</table>
<ul>
<li>init，一个配置项对象，包括所有对请求的设置。可选的参数有：</li>
</ul>
<table>
<thead>
<tr>
<th>init</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>method</td>
<td>请求使用的方法，如 GET、POST。</td>
</tr>
<tr>
<td>headers</td>
<td>请求的头信息，形式为 Headers 的对象或包含 ByteString 值的对象字面量。</td>
</tr>
<tr>
<td>body</td>
<td>请求的 body 信息：可能是一个 Blob、BufferSource、FormData、URLSearchParams 或者 USVString 对象。注意 GET 或 HEAD 方法的请求不能包含 body 信息。</td>
</tr>
<tr>
<td>mode</td>
<td>请求的模式，如 cors、 no-cors 或者 same-origin。</td>
</tr>
<tr>
<td>credentials</td>
<td>请求的 credentials，如 omit、same-origin 或者 include。为了在当前域名内自动发送 cookie ， 必须提供这个选项， 从 Chrome 50 开始， 这个属性也可以接受 FederatedCredential 实例或是一个 PasswordCredential 实例。</td>
</tr>
<tr>
<td>cache</td>
<td>请求的 cache 模式: default 、 no-store 、 reload 、 no-cache 、 force-cache 或者 only-if-cached 。</td>
</tr>
<tr>
<td>redirect</td>
<td>可用的 redirect 模式: follow (自动重定向), error (如果产生重定向将自动终止并且抛出一个错误), 或者 manual (手动处理重定向). 在Chrome中，Chrome 47之前的默认值是 follow，从 Chrome 47开始是 manual。</td>
</tr>
<tr>
<td>referrer</td>
<td>一个 USVString 可以是 no-referrer、client或一个 URL。默认是 client。</td>
</tr>
<tr>
<td>referrerPolicy</td>
<td>Specifies the value of the referer HTTP header. May be one of no-referrer、 no-referrer-when-downgrade、 origin、 origin-when-cross-origin、 unsafe-url 。</td>
</tr>
<tr>
<td>integrity</td>
<td>包括请求的  subresource integrity 值 （ 例如： sha256-BpfBw7ivV8q2jLiT13fxDYAe2tJllusRSZ273h2nFSE=）。</td>
</tr>
</tbody>
</table>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><ul>
<li>发送一个 Ajax 请求，如果请求成功则转换为 json 如果失败则打印错误原因</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">fetch(</span><br><span class="line">    <span class="string">'http://localhost:9000/student'</span></span><br><span class="line">).then(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (response.ok) &#123;</span><br><span class="line">        <span class="keyword">return</span> response.json();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Network response was not ok.'</span>);</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params">myJson</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(myJson);</span><br><span class="line">&#125;).catch(<span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'There has been a problem with your fetch operation: '</span>, error.message);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>上传 Json 数据</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> url = <span class="string">'https://example.com/profile'</span>;</span><br><span class="line"><span class="keyword">var</span> data = &#123;<span class="attr">username</span>: <span class="string">'example'</span>&#125;;</span><br><span class="line"></span><br><span class="line">fetch(url, &#123;</span><br><span class="line">  method: <span class="string">'POST'</span>,</span><br><span class="line">  body: <span class="built_in">JSON</span>.stringify(data),</span><br><span class="line">  headers: <span class="keyword">new</span> Headers(&#123;</span><br><span class="line">    <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> res.json())</span><br><span class="line">.catch(<span class="function"><span class="params">error</span> =&gt;</span> <span class="built_in">console</span>.error(<span class="string">'Error:'</span>, error))</span><br><span class="line">.then(<span class="function"><span class="params">response</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'Success:'</span>, response));</span><br></pre></td></tr></table></figure>
<ul>
<li>创建请求对象</li>
</ul>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">var myHeaders = new Headers();</span><br><span class="line"></span><br><span class="line">var myInit = &#123; method: 'GET', headers: myHeaders, mode: 'cors', cache: 'default' &#125;;</span><br><span class="line"></span><br><span class="line">var myRequest = new Request('flowers.jpg', myInit);</span><br><span class="line"></span><br><span class="line">fetch(myRequest).then(function(response) &#123;</span><br><span class="line">  return response.blob();</span><br><span class="line">&#125;).then(function(myBlob) &#123;</span><br><span class="line">  var objectURL = URL.createObjectURL(myBlob);</span><br><span class="line">  myImage.src = objectURL;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>定义 headers 请求头信息</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> content = <span class="string">"Hello World"</span>;</span><br><span class="line"><span class="keyword">var</span> myHeaders = <span class="keyword">new</span> Headers();</span><br><span class="line">myHeaders.append(<span class="string">"Content-Type"</span>, <span class="string">"text/plain"</span>);</span><br><span class="line">myHeaders.append(<span class="string">"Content-Length"</span>, content.length.toString());</span><br><span class="line">myHeaders.append(<span class="string">"X-Custom-Header"</span>, <span class="string">"ProcessThisImmediately"</span>);</span><br><span class="line"></span><br><span class="line">或者</span><br><span class="line"></span><br><span class="line">myHeaders = <span class="keyword">new</span> Headers(&#123;</span><br><span class="line">  <span class="string">"Content-Type"</span>: <span class="string">"text/plain"</span>,</span><br><span class="line">  <span class="string">"Content-Length"</span>: content.length.toString(),</span><br><span class="line">  <span class="string">"X-Custom-Header"</span>: <span class="string">"ProcessThisImmediately"</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h1 id="Less-语法"><a href="#Less-语法" class="headerlink" title="Less 语法"></a>Less 语法</h1><h2 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h2><ul>
<li>less</li>
</ul>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@a</span> : <span class="number">200px</span>;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: @a;</span><br><span class="line">    <span class="attribute">height</span>: @a * <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>编译后</li>
</ul>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="混入"><a href="#混入" class="headerlink" title="混入"></a>混入</h2><ul>
<li>less</li>
</ul>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.fll</span> &#123;</span><br><span class="line">    <span class="attribute">float</span>: left;</span><br><span class="line">    <span class="attribute">margin-right</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.logo</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="selector-class">.fll</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>编译后</li>
</ul>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.fll</span> &#123;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">  <span class="attribute">margin-right</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.logo</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">  <span class="attribute">margin-right</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="嵌套"><a href="#嵌套" class="headerlink" title="嵌套"></a>嵌套</h2><ul>
<li>less</li>
</ul>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">header</span>&#123;</span><br><span class="line">    <span class="selector-class">.logo</span> &#123;</span><br><span class="line">        <span class="attribute">float</span>: left;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>编译后</li>
</ul>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">header</span> <span class="selector-class">.logo</span> &#123;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="计算"><a href="#计算" class="headerlink" title="计算"></a>计算</h2><ul>
<li>less</li>
</ul>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="variable">@height :</span> <span class="number">20px</span>;</span><br><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="variable">@height</span> * <span class="number">5</span>;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>编译后</li>
</ul>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="简写自己"><a href="#简写自己" class="headerlink" title="简写自己"></a>简写自己</h2><ul>
<li>less，&amp; 表示自己</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">.btn &#123;</span><br><span class="line">    color: red;</span><br><span class="line">    &amp;:hover&#123;</span><br><span class="line">        color: blue;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>编译后</li>
</ul>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.btn</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.btn</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: blue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="导入样式表"><a href="#导入样式表" class="headerlink" title="导入样式表"></a>导入样式表</h2><ul>
<li>导入 LESS</li>
</ul>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@import</span> <span class="string">"foo.less"</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>导入 CSS</li>
</ul>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@import</span> (css) <span class="string">"foo.less"</span>;</span><br></pre></td></tr></table></figure>
<h1 id="json-server"><a href="#json-server" class="headerlink" title="json-server"></a>json-server</h1><p>这是一个虚拟的数据库服务器，可以轻松制作一套假的 RESTful API，此时就暂时不需要数据库了，但这是前端测试使用的。</p>
<h2 id="安装运行"><a href="#安装运行" class="headerlink" title="安装运行"></a>安装运行</h2><ul>
<li>github地址</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https://github.com/typicode/json-server</span><br></pre></td></tr></table></figure>
<ul>
<li>安装</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install -g json-server</span><br></pre></td></tr></table></figure>
<ul>
<li>准备 JSON 数据文件 database.json</li>
</ul>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"student"</span>: [</span><br><span class="line">        &#123; <span class="attr">"id"</span>: <span class="number">10001</span>, <span class="attr">"name"</span>: <span class="string">"王三炮"</span>, <span class="attr">"gender"</span>: <span class="string">"男"</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">"id"</span>: <span class="number">10002</span>, <span class="attr">"name"</span>: <span class="string">"李钢蛋"</span>, <span class="attr">"gender"</span>: <span class="string">"女"</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">"id"</span>: <span class="number">10003</span>, <span class="attr">"name"</span>: <span class="string">"张婊子"</span>, <span class="attr">"gender"</span>: <span class="string">"男"</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">"id"</span>: <span class="number">10003</span>, <span class="attr">"name"</span>: <span class="string">"王绿茶"</span>, <span class="attr">"gender"</span>: <span class="string">"女"</span> &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>运行 JSON-server </li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">json-server --watch database.json --port 9000</span><br></pre></td></tr></table></figure>
<ul>
<li>查询数据</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http://localhost:3000/student/            # 得到全部数据</span><br><span class="line">http://localhost:3000/student/10001       # 得到某个数据</span><br></pre></td></tr></table></figure>
<h2 id="常用配置"><a href="#常用配置" class="headerlink" title="常用配置"></a>常用配置</h2><ul>
<li>替换主页</li>
</ul>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">在站点目录下准备 public\index.html 文件可以达到替换主页的目的</span><br></pre></td></tr></table></figure>
<ul>
<li>设置与 webpack 同时启动，在 package.json 启动命令中增加 json-server 的启动命令</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;start&quot;: &quot;start /min json-server --watch json-server/database.json --port 9000 &amp; webpack-dev-server --hot --mode development&quot;</span><br></pre></td></tr></table></figure>
<ul>
<li>在 webpack 中增加一个代理，这样实现 AJAX 请求发出的地址为 <code>/api/</code> 即可，json-server 无视跨域问题</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">devServer: &#123;</span><br><span class="line">    contentBase: <span class="string">'./dist'</span>,</span><br><span class="line">    host: <span class="string">"127.0.0.1"</span>,</span><br><span class="line">    port: <span class="number">80</span>,</span><br><span class="line">    open: <span class="literal">true</span>,</span><br><span class="line">    proxy: &#123;</span><br><span class="line">      <span class="string">'/api/*'</span>: &#123;</span><br><span class="line">        target: <span class="string">'http://127.0.0.1:27017'</span>,</span><br><span class="line">        secure: <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="增删改查"><a href="#增删改查" class="headerlink" title="增删改查"></a>增删改查</h2><ul>
<li>AJAX函数</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Ajax</span>(<span class="params">method, url, data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">    xhr.open(method, url, <span class="literal">true</span>);</span><br><span class="line">    xhr.setRequestHeader(<span class="string">'Content-Type'</span>, <span class="string">'application/x-www-form-urlencoded'</span>);</span><br><span class="line">    xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (xhr.readyState == <span class="number">4</span>) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(xhr.responseText)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    xhr.send(data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>增加数据</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">Ajax(<span class="string">'POST'</span>,<span class="string">'/student'</span>,<span class="string">"id=10004&amp;name=赵二狗&amp;gender=男"</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>删除数据</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">Ajax(<span class="string">'DELETE'</span>,<span class="string">'/student/10004'</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>修改数据</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">Ajax(<span class="string">'PATCH'</span>,<span class="string">'/student/10003'</span>,<span class="string">"gender=女"</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>查询数据</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">Ajax(<span class="string">'GET'</span>,<span class="string">'/student?id=10003'</span>);</span><br><span class="line">Ajax(<span class="string">'GET'</span>,<span class="string">'/student?id=10003&amp;id=10002'</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>排序，_sort 指定排序字段，_order 指定正序（asc）倒序（desc），都字段排序用逗号分隔</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">Ajax(<span class="string">'GET'</span>,<span class="string">'/student?_sort=id&amp;_order=desc'</span>);</span><br><span class="line">Ajax(<span class="string">'GET'</span>,<span class="string">'/student?_sort=id,gender&amp;_order=desc,asc'</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>切片</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">Ajax(<span class="string">'GET'</span>,<span class="string">'/student?_start=1&amp;_end=2'</span>);</span><br><span class="line">Ajax(<span class="string">'GET'</span>,<span class="string">'/student?_start=1&amp;_limit=2'</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>条件 _gte 大于等于，_lte 小于等于，_ne不等于，_like 正则匹配</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">Ajax(<span class="string">'GET'</span>,<span class="string">'/student?id_gte=10003'</span>);</span><br><span class="line">Ajax(<span class="string">'GET'</span>,<span class="string">'/student?id_gte=10002&amp;id_lte=10003'</span>);</span><br><span class="line">Ajax(<span class="string">'GET'</span>,<span class="string">'/student?id_ne=10003'</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>全文检索</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">Ajax(<span class="string">'GET'</span>,<span class="string">'/student?q=张婊子'</span>);</span><br></pre></td></tr></table></figure>
<h1 id="Ant-Design"><a href="#Ant-Design" class="headerlink" title="Ant-Design"></a>Ant-Design</h1><ul>
<li>安装 Antd</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">npm install --save antd</span><br></pre></td></tr></table></figure>
<ul>
<li>在主要的 css 文件例如： index.css 中引入 antd 的样式</li>
</ul>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@charset</span> <span class="string">"UTF-8"</span>;</span><br><span class="line"><span class="keyword">@import</span> <span class="string">"~antd/dist/antd.css"</span>;</span><br><span class="line"><span class="keyword">@import</span> <span class="string">"./cssreset.css"</span>;</span><br></pre></td></tr></table></figure>
<h2 id="按需加载CSS"><a href="#按需加载CSS" class="headerlink" title="按需加载CSS"></a>按需加载CSS</h2><ul>
<li>安装 babel-plugin-import</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">npm install --save-dev babel-plugin-<span class="keyword">import</span></span><br></pre></td></tr></table></figure>
<ul>
<li>修改 .babelrc</li>
</ul>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">"plugins": [</span><br><span class="line">  "react-hot-loader/babel",</span><br><span class="line">  [</span><br><span class="line">    <span class="string">"import"</span>,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"libraryName"</span>: <span class="string">"antd"</span>,</span><br><span class="line">      <span class="attr">"style"</span>: <span class="string">"css"</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<ul>
<li>引入组件，无需引入样式即可</li>
</ul>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">import Form from 'antd/lib/form';</span><br><span class="line">import Icon from 'antd/lib/icon';</span><br><span class="line">import Input from 'antd/lib/input';</span><br></pre></td></tr></table></figure>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/01/18/python/Ascii码表/" rel="next" title>
                <i class="fa fa-chevron-left"></i> 
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/01/25/personal/进制转换/" rel="prev" title="教初学者如何进制转换">
                教初学者如何进制转换 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="Jin Heng">
            
              <p class="site-author-name" itemprop="name">Jin Heng</p>
              <p class="site-description motion-element" itemprop="description">越努力越幸运</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">86</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">6</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/yangjinheng" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:jinhengyang@foxmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          
        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#webpack"><span class="nav-number">1.</span> <span class="nav-text">webpack</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#手动搭建"><span class="nav-number">1.1.</span> <span class="nav-text">手动搭建</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#webpack-dev-server"><span class="nav-number">1.2.</span> <span class="nav-text">webpack-dev-server</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#css-loader"><span class="nav-number">1.3.</span> <span class="nav-text">css-loader</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#style-loader"><span class="nav-number">1.4.</span> <span class="nav-text">style-loader</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#react-hot-loader"><span class="nav-number">1.5.</span> <span class="nav-text">react-hot-loader</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#预备知识"><span class="nav-number">2.</span> <span class="nav-text">预备知识</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#名词简介"><span class="nav-number">2.1.</span> <span class="nav-text">名词简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#npm命令"><span class="nav-number">2.2.</span> <span class="nav-text">npm命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#JS模块化"><span class="nav-number">2.3.</span> <span class="nav-text">JS模块化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#export"><span class="nav-number">2.3.1.</span> <span class="nav-text">export</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#export-default"><span class="nav-number">2.3.2.</span> <span class="nav-text">export default</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#import"><span class="nav-number">2.3.3.</span> <span class="nav-text">import</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#import-from"><span class="nav-number">2.3.4.</span> <span class="nav-text">import from</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#React-基础语法"><span class="nav-number">3.</span> <span class="nav-text">React 基础语法</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#JSX语法"><span class="nav-number">3.1.</span> <span class="nav-text">JSX语法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#React-组件"><span class="nav-number">3.2.</span> <span class="nav-text">React 组件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#类组件"><span class="nav-number">3.3.</span> <span class="nav-text">类组件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#组件语法"><span class="nav-number">3.4.</span> <span class="nav-text">组件语法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#组件属性"><span class="nav-number">3.5.</span> <span class="nav-text">组件属性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#组件方法"><span class="nav-number">3.6.</span> <span class="nav-text">组件方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hello-World"><span class="nav-number">3.7.</span> <span class="nav-text">Hello World</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#React-数据传递"><span class="nav-number">4.</span> <span class="nav-text">React 数据传递</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#state"><span class="nav-number">4.1.</span> <span class="nav-text">state</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#使用方法"><span class="nav-number">4.1.1.</span> <span class="nav-text">使用方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用示例"><span class="nav-number">4.1.2.</span> <span class="nav-text">使用示例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#props"><span class="nav-number">4.2.</span> <span class="nav-text">props</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#使用方法-1"><span class="nav-number">4.2.1.</span> <span class="nav-text">使用方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用示例-1"><span class="nav-number">4.2.2.</span> <span class="nav-text">使用示例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#属性验证"><span class="nav-number">4.2.3.</span> <span class="nav-text">属性验证</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#子操作父组件"><span class="nav-number">4.2.4.</span> <span class="nav-text">子操作父组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#从-props-中枚举"><span class="nav-number">4.2.5.</span> <span class="nav-text">从 props 中枚举</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#context"><span class="nav-number">4.3.</span> <span class="nav-text">context</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#使用方法-2"><span class="nav-number">4.3.1.</span> <span class="nav-text">使用方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用示例-2"><span class="nav-number">4.3.2.</span> <span class="nav-text">使用示例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#子操作祖先组件"><span class="nav-number">4.3.3.</span> <span class="nav-text">子操作祖先组件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#三兄弟总结"><span class="nav-number">4.4.</span> <span class="nav-text">三兄弟总结</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#模拟双向绑定"><span class="nav-number">4.5.</span> <span class="nav-text">模拟双向绑定</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Refs-DOM-钩子"><span class="nav-number">4.6.</span> <span class="nav-text">Refs DOM 钩子</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#生命周期TODO"><span class="nav-number">5.</span> <span class="nav-text">生命周期TODO</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#组件生命周期"><span class="nav-number">5.1.</span> <span class="nav-text">组件生命周期</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#组件下树之前"><span class="nav-number">5.2.</span> <span class="nav-text">组件下树之前</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#props更新前后的函数"><span class="nav-number">5.3.</span> <span class="nav-text">props更新前后的函数</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#React-router"><span class="nav-number">6.</span> <span class="nav-text">React-router</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#组件路由"><span class="nav-number">6.1.</span> <span class="nav-text">组件路由</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#动态路由传参"><span class="nav-number">6.2.</span> <span class="nav-text">动态路由传参</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#路由查询字符串"><span class="nav-number">6.3.</span> <span class="nav-text">路由查询字符串</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#JS调用路由跳转"><span class="nav-number">6.4.</span> <span class="nav-text">JS调用路由跳转</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#嵌套路由"><span class="nav-number">6.5.</span> <span class="nav-text">嵌套路由</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#路由模块化"><span class="nav-number">6.6.</span> <span class="nav-text">路由模块化</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Redux"><span class="nav-number">7.</span> <span class="nav-text">Redux</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#基础知识"><span class="nav-number">7.1.</span> <span class="nav-text">基础知识</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Action"><span class="nav-number">7.1.1.</span> <span class="nav-text">Action</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Reducer"><span class="nav-number">7.1.2.</span> <span class="nav-text">Reducer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Store"><span class="nav-number">7.1.3.</span> <span class="nav-text">Store</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#combineReducers"><span class="nav-number">7.1.4.</span> <span class="nav-text">combineReducers</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配合-react"><span class="nav-number">7.2.</span> <span class="nav-text">配合 react</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Provider"><span class="nav-number">7.2.1.</span> <span class="nav-text">Provider</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#connect"><span class="nav-number">7.2.2.</span> <span class="nav-text">connect</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#案例"><span class="nav-number">7.3.</span> <span class="nav-text">案例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#调色板"><span class="nav-number">7.3.1.</span> <span class="nav-text">调色板</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#购物车"><span class="nav-number">7.3.2.</span> <span class="nav-text">购物车</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#注意事项"><span class="nav-number">7.4.</span> <span class="nav-text">注意事项</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#引用类型"><span class="nav-number">7.4.1.</span> <span class="nav-text">引用类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Ramda库"><span class="nav-number">7.4.2.</span> <span class="nav-text">Ramda库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#connect-1"><span class="nav-number">7.4.3.</span> <span class="nav-text">connect</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#中间件"><span class="nav-number">7.5.</span> <span class="nav-text">中间件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Logger"><span class="nav-number">7.5.1.</span> <span class="nav-text">Logger</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#redux-thunk"><span class="nav-number">7.5.2.</span> <span class="nav-text">redux-thunk</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#fatch"><span class="nav-number">7.6.</span> <span class="nav-text">fatch</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#语法"><span class="nav-number">7.6.1.</span> <span class="nav-text">语法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参数"><span class="nav-number">7.6.2.</span> <span class="nav-text">参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#示例"><span class="nav-number">7.6.3.</span> <span class="nav-text">示例</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Less-语法"><span class="nav-number">8.</span> <span class="nav-text">Less 语法</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#变量"><span class="nav-number">8.1.</span> <span class="nav-text">变量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#混入"><span class="nav-number">8.2.</span> <span class="nav-text">混入</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#嵌套"><span class="nav-number">8.3.</span> <span class="nav-text">嵌套</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#计算"><span class="nav-number">8.4.</span> <span class="nav-text">计算</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#简写自己"><span class="nav-number">8.5.</span> <span class="nav-text">简写自己</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#导入样式表"><span class="nav-number">8.6.</span> <span class="nav-text">导入样式表</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#json-server"><span class="nav-number">9.</span> <span class="nav-text">json-server</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#安装运行"><span class="nav-number">9.1.</span> <span class="nav-text">安装运行</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#常用配置"><span class="nav-number">9.2.</span> <span class="nav-text">常用配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#增删改查"><span class="nav-number">9.3.</span> <span class="nav-text">增删改查</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Ant-Design"><span class="nav-number">10.</span> <span class="nav-text">Ant-Design</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#按需加载CSS"><span class="nav-number">10.1.</span> <span class="nav-text">按需加载CSS</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2017 &mdash; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jin Heng</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  













  





  

  

  

  
  

  

  

  

</body>
</html>
