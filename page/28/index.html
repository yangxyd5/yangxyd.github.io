<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="越努力越幸运">
<meta property="og:type" content="website">
<meta property="og:title" content="默默">
<meta property="og:url" content="https://yangjinheng.github.io/page/28/index.html">
<meta property="og:site_name" content="默默">
<meta property="og:description" content="越努力越幸运">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="默默">
<meta name="twitter:description" content="越努力越幸运">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://yangjinheng.github.io/page/28/">





  <title>默默</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?be46574a10a6c2b7f67e9c32a008cbd5";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">默默</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-前端知识">
          <a href="/categories/web/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-asterisk"></i> <br>
            
            前端知识
          </a>
        </li>
      
        
        <li class="menu-item menu-item-kubernetes">
          <a href="/categories/Kubernetes/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-cog"></i> <br>
            
            Kubernetes
          </a>
        </li>
      
        
        <li class="menu-item menu-item-运维笔记">
          <a href="/categories/运维笔记/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br>
            
            运维笔记
          </a>
        </li>
      
        
        <li class="menu-item menu-item-python">
          <a href="/categories/Python/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-laptop"></i> <br>
            
            Python
          </a>
        </li>
      
        
        <li class="menu-item menu-item-golang">
          <a href="/categories/golang/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br>
            
            Golang
          </a>
        </li>
      
        
        <li class="menu-item menu-item-个人日志">
          <a href="/categories/个人日志/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-github-alt"></i> <br>
            
            个人日志
          </a>
        </li>
      
        
        <li class="menu-item menu-item-guestbook">
          <a href="/guestbook" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br>
            
            给我留言
          </a>
        </li>
      

      
    </ul>
  

  
</nav>


 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://yangjinheng.github.io/2017/10/07/python/28.urllib网络请求库/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jin Heng">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="默默">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/07/python/28.urllib网络请求库/" itemprop="url">urllib网络请求库</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-10-07T00:00:00+08:00">
                2017-10-07
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="urllib"><a href="#urllib" class="headerlink" title="urllib"></a>urllib</h2><p>urllib 是 Python3 标准库中的模块，无需额外安装，Python3 中的 urllib 综合了 Python2 中 urllib 和 urllib2 的一些功能，发生了较大变化。另外：Requests 库是一个第三方库，它基于 urllib3 编写，比 urllib 更方便，但要额外安装。</p>
<ul>
<li>组成</li>
</ul>
<table>
<thead>
<tr>
<th>库</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>urllib.request</code></td>
<td>请求模块</td>
</tr>
<tr>
<td><code>urllib.error</code></td>
<td>异常处理模块</td>
</tr>
<tr>
<td><code>urllib.parse</code></td>
<td>URL解析模块</td>
</tr>
<tr>
<td><code>urllib.robotparser</code></td>
<td>robots.txt 解析模块</td>
</tr>
</tbody>
</table>
<ul>
<li>导入需要的模块<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"><span class="keyword">import</span> urllib.error</span><br><span class="line"><span class="keyword">import</span> http.cookiejar</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="urllib-request"><a href="#urllib-request" class="headerlink" title="urllib.request"></a>urllib.request</h2><ul>
<li>请求打开URL地址，data 参数为 POST 请求时的参数，其余为CA证书相关。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">语法：urlopen(url, data=None, timeout=TIME, *, cafile=None, capath=None, cadefault=False, context=None)</span><br></pre></td></tr></table></figure>
<ul>
<li>GET请求</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">response = urllib.request.urlopen(<span class="string">'http://httpbin.org/get'</span>)</span><br><span class="line">ret = str(response.read(), encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">print(ret)</span><br></pre></td></tr></table></figure>
<ul>
<li>POST请求</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">data = &#123;<span class="string">'hello'</span>: <span class="string">'world'</span>&#125;</span><br><span class="line">body = bytes(urllib.parse.urlencode(data),encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">response = urllib.request.urlopen(<span class="string">'http://httpbin.org/post'</span>,data=body)</span><br><span class="line">ret = str(response.read(), encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">print(ret)</span><br></pre></td></tr></table></figure>
<ul>
<li>请求 HTTPS 网站，取消全局证书</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> ssl</span><br><span class="line">ssl._create_default_https_context = ssl._create_unverified_context</span><br><span class="line"></span><br><span class="line">url = <span class="string">'https://172.16.100.253:9527/jobs'</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">'Accept'</span>: <span class="string">'application/x-yaml'</span>,</span><br><span class="line">    <span class="string">'X-Auth-Token'</span>: <span class="string">'546df529e7f55afaaeb2d11ae98bd9155cceab57'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Request = urllib.request.Request(url=url, headers=headers, method=<span class="string">'GET'</span>)</span><br><span class="line">response = urllib.request.urlopen(Request)</span><br><span class="line"></span><br><span class="line">print(response.status)</span><br></pre></td></tr></table></figure>
<ul>
<li>设置请求的超时</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    response = urllib.request.urlopen(<span class="string">'http://httpbin.org/get'</span>,timeout=<span class="number">0.1</span>)</span><br><span class="line">    ret = str(response.read(), encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">    print(ret)</span><br><span class="line"><span class="keyword">except</span> urllib.error.URLError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="keyword">import</span> socket</span><br><span class="line">    <span class="keyword">if</span> isinstance(e.reason,socket.timeout):</span><br><span class="line">        print(<span class="string">'request timeout'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="response"><a href="#response" class="headerlink" title="response"></a>response</h3><ul>
<li>获得响应码，响应头信息</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">response = urllib.request.urlopen(<span class="string">'http://httpbin.org/get'</span>)</span><br><span class="line">print(response.status)</span><br><span class="line">print(response.getheaders())</span><br><span class="line">print(response.getheader(<span class="string">'Server'</span>))</span><br><span class="line">ret = str(response.read(), encoding=<span class="string">'utf-8'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="Request"><a href="#Request" class="headerlink" title="Request"></a>Request</h3><p>Request 子类，它能够构造一个请求，自定义请求头信息，和请求体的 POST 表单信息。</p>
<ul>
<li>自定义请求头，POST表单，构造请求</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">url = <span class="string">'http://httpbin.org/post'</span></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">'User-Agent'</span>:<span class="string">'Mozilla/5.0 (iPhone; U; CPU iPhone OS 4_3_3 like Mac OS X; en-us) AppleWebKit/533.17.9 (KHTML, like Gecko) Version/5.0.2 Mobile/8J2 Safari/6533.18.5'</span>,</span><br><span class="line">    <span class="string">'Host'</span>:<span class="string">'httpbin.org'</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">'hello'</span>: <span class="string">'world'</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">body = bytes(urllib.parse.urlencode(data), encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">Request = urllib.request.Request(url=url, data=body, headers=headers, method=<span class="string">'POST'</span>)</span><br><span class="line"></span><br><span class="line">response = urllib.request.urlopen(Request)</span><br><span class="line"></span><br><span class="line">print(response.status)</span><br><span class="line">print(response.getheaders())</span><br><span class="line">ret = str(response.read(), encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">print(ret)</span><br></pre></td></tr></table></figure>
<ul>
<li>Request 类的 add_header 方法，可以向构造的请求添加头信息。</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">url = <span class="string">'http://httpbin.org/post'</span></span><br><span class="line">data = &#123;<span class="string">'hello'</span>: <span class="string">'world'</span>,&#125;</span><br><span class="line">header = (<span class="string">'User-Agent'</span>,<span class="string">'Mozilla/5.0 (iPhone; U; CPU iPhone OS 4_3_3 like Mac OS X; en-us) AppleWebKit/533.17.9 (KHTML, like Gecko) Version/5.0.2 Mobile/8J2 Safari/6533.18.5'</span>)</span><br><span class="line"></span><br><span class="line">body = bytes(urllib.parse.urlencode(data), encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">Request = urllib.request.Request(url=url, data=body, method=<span class="string">'POST'</span>)</span><br><span class="line">Request.add_header(*header)</span><br><span class="line"></span><br><span class="line">response = urllib.request.urlopen(Request)</span><br><span class="line"></span><br><span class="line">print(response.status)</span><br><span class="line">print(response.getheaders())</span><br><span class="line">ret = str(response.read(), encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">print(ret)</span><br></pre></td></tr></table></figure>
<h3 id="Handler"><a href="#Handler" class="headerlink" title="Handler"></a>Handler</h3><ul>
<li>设置请求线路代理，本机需要安装代理线路程序，例如：监听在 9743。</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ips = &#123;</span><br><span class="line">    <span class="string">'http'</span>:<span class="string">'http://127.0.0.1:9743'</span>,</span><br><span class="line">    <span class="string">'https'</span>:<span class="string">'https://127.0.0.1:9743'</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">proxy_handler = urllib.request.ProxyHandler(ips)</span><br><span class="line">opener = urllib.request.build_opener(proxy_handler)</span><br><span class="line">response = opener.open(<span class="string">'http://www.baidu.com'</span>)</span><br><span class="line">ret = str(response.read(), encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">print(ret)</span><br></pre></td></tr></table></figure>
<h3 id="HTTPCookieProcessor"><a href="#HTTPCookieProcessor" class="headerlink" title="HTTPCookieProcessor"></a>HTTPCookieProcessor</h3><ul>
<li>使用 Mozilla 类型 Cookie</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># --- 在本地保存为 MozillaCookiejar</span></span><br><span class="line">filename = <span class="string">'cookie.txt'</span></span><br><span class="line">cookie = http.cookiejar.MozillaCookieJar(filename)</span><br><span class="line">handler = urllib.request.HTTPCookieProcessor(cookie)</span><br><span class="line">opener = urllib.request.build_opener(handler)</span><br><span class="line"></span><br><span class="line">response = opener.open(<span class="string">'https://baidu.com'</span>)</span><br><span class="line">cookie.save(ignore_discard=<span class="literal">True</span>,ignore_expires=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># --- 使用本地已有的 Cookie 请求</span></span><br><span class="line">cookie = http.cookiejar.MozillaCookieJar()</span><br><span class="line">cookie.load(<span class="string">'cookie.txt'</span>,ignore_discard=<span class="literal">True</span>,ignore_expires=<span class="literal">True</span>)</span><br><span class="line">handler = urllib.request.HTTPCookieProcessor(cookie)</span><br><span class="line">opener = urllib.request.build_opener(handler)</span><br><span class="line"></span><br><span class="line">response = opener.open(<span class="string">'https://baidu.com'</span>)</span><br><span class="line"></span><br><span class="line">ret = str(response.read(), encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">print(ret)</span><br></pre></td></tr></table></figure>
<ul>
<li><p>使用 LWP 类型 Cookie</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">--- Cookie 在本地保存为 LWPCookiejar</span><br><span class="line">filename = <span class="string">'cookie.txt'</span></span><br><span class="line">cookie = http.cookiejar.LWPCookieJar(filename)</span><br><span class="line">handler = urllib.request.HTTPCookieProcessor(cookie)</span><br><span class="line">opener = urllib.request.build_opener(handler)</span><br><span class="line"></span><br><span class="line">response = opener.open(<span class="string">'https://baidu.com'</span>)</span><br><span class="line">cookie.save(ignore_discard=<span class="literal">True</span>,ignore_expires=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--- Cookie 使用本地已有的 Cookie 请求</span><br><span class="line">cookie = http.cookiejar.LWPCookieJar()</span><br><span class="line">cookie.load(<span class="string">'cookie.txt'</span>,ignore_discard=<span class="literal">True</span>,ignore_expires=<span class="literal">True</span>)</span><br><span class="line">handler = urllib.request.HTTPCookieProcessor(cookie)</span><br><span class="line">opener = urllib.request.build_opener(handler)</span><br><span class="line"></span><br><span class="line">response = opener.open(<span class="string">'https://baidu.com'</span>)</span><br><span class="line"></span><br><span class="line">ret = str(response.read(), encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">print(ret)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="urllib-error"><a href="#urllib-error" class="headerlink" title="urllib.error"></a>urllib.error</h2><p>异常分为两个字类：URLError 它只有 reason，而它的子类 HTTPError 有 reason code headers 属性。</p>
<ul>
<li>URLError</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    response = urllib.request.urlopen(<span class="string">'http://httpbin.org/test.html'</span>)</span><br><span class="line">    ret = str(response.read(), encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">    print(ret)</span><br><span class="line"><span class="keyword">except</span> urllib.error.URLError <span class="keyword">as</span> e:</span><br><span class="line">    print(e.reason)</span><br></pre></td></tr></table></figure>
<ul>
<li>HTTPError</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    response = urllib.request.urlopen(<span class="string">'http://httpbin.org/test.html'</span>)</span><br><span class="line">    ret = str(response.read(), encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">    print(ret)</span><br><span class="line"><span class="keyword">except</span> urllib.error.HTTPError <span class="keyword">as</span> e:</span><br><span class="line">    print(e.reason,e.code,e.headers,sep=<span class="string">'\n'</span>)</span><br><span class="line"><span class="keyword">except</span> urllib.error.URLError <span class="keyword">as</span> e:</span><br><span class="line">    print(e.reason)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">'Requet Successfuly'</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>异常原因的判断</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    response = urllib.request.urlopen(<span class="string">'http://httpbin.org/get'</span>,timeout=<span class="number">0.1</span>)</span><br><span class="line">    ret = str(response.read(), encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">    print(ret)</span><br><span class="line"><span class="keyword">except</span> urllib.error.URLError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="keyword">import</span> socket</span><br><span class="line">    <span class="keyword">if</span> isinstance(e.reason,socket.timeout):</span><br><span class="line">        print(<span class="string">'request timeout'</span>)</span><br></pre></td></tr></table></figure>
<h2 id="urllib-parse"><a href="#urllib-parse" class="headerlink" title="urllib.parse"></a>urllib.parse</h2><p>封装了对URL地址的处理，能对URL地址进行拆分，和拼接，等操作。</p>
<h3 id="urlparse"><a href="#urlparse" class="headerlink" title="urlparse"></a>urlparse</h3><ul>
<li>urlparse 将分解 url</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ret = urllib.parse.urlparse(<span class="string">'https://www.baidu.com/index.html;user?id=5#conetnt'</span>)</span><br><span class="line">print(ret)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ParseResult(scheme=<span class="string">'https'</span>, netloc=<span class="string">'www.baidu.com'</span>, path=<span class="string">'/index.html'</span>, params=<span class="string">'user'</span>, query=<span class="string">'id=5'</span>, fragment=<span class="string">'conetnt'</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>指定URL中的协议部分，原始协议信息优先级最高，如果原始信息没有协议的信息，则使用 scheme。</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ret = urllib.parse.urlparse(<span class="string">'http://www.baidu.com/index.html;user?id=5#conetnt'</span>,scheme=<span class="string">'https'</span>)</span><br><span class="line">print(ret)</span><br><span class="line">ret = urllib.parse.urlparse(<span class="string">'www.baidu.com/index.html;user?id=5#conetnt'</span>,scheme=<span class="string">'https'</span>)</span><br><span class="line">print(ret)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ParseResult(scheme=<span class="string">'http'</span>, netloc=<span class="string">'www.baidu.com'</span>, path=<span class="string">'/index.html'</span>, params=<span class="string">'user'</span>, query=<span class="string">'id=5'</span>, fragment=<span class="string">'conetnt'</span>)</span><br><span class="line">ParseResult(scheme=<span class="string">'https'</span>, netloc=<span class="string">''</span>, path=<span class="string">'www.baidu.com/index.html'</span>, params=<span class="string">'user'</span>, query=<span class="string">'id=5'</span>, fragment=<span class="string">'conetnt'</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>指定是否解析锚点信息为锚点</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ret = urllib.parse.urlparse(<span class="string">'http://www.baidu.com/index.html;user?id=5#conetnt'</span>,allow_fragments=<span class="literal">False</span>)</span><br><span class="line">print(ret)</span><br><span class="line">ret = urllib.parse.urlparse(<span class="string">'http://www.baidu.com/index.html#conetnt'</span>,allow_fragments=<span class="literal">False</span>)</span><br><span class="line">print(ret)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ParseResult(scheme=<span class="string">'http'</span>, netloc=<span class="string">'www.baidu.com'</span>, path=<span class="string">'/index.html'</span>, params=<span class="string">'user'</span>, query=<span class="string">'id=5#conetnt'</span>, fragment=<span class="string">''</span>)</span><br><span class="line">ParseResult(scheme=<span class="string">'http'</span>, netloc=<span class="string">'www.baidu.com'</span>, path=<span class="string">'/index.html#conetnt'</span>, params=<span class="string">''</span>, query=<span class="string">''</span>, fragment=<span class="string">''</span>)</span><br></pre></td></tr></table></figure>
<h3 id="urljoin"><a href="#urljoin" class="headerlink" title="urljoin"></a>urljoin</h3><ul>
<li>组装一个 URL</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">data = [<span class="string">'http'</span>,<span class="string">'www.baidu.com'</span>,<span class="string">'index.html'</span>,<span class="string">'user'</span>,<span class="string">'a=6'</span>,<span class="string">'content'</span>]</span><br><span class="line">print(urllib.parse.urlunparse(data))</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://www.baidu.com/index.html;user?a=6#content</span><br></pre></td></tr></table></figure>
<ul>
<li>拼接一个 URL</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(urllib.parse.urljoin(<span class="string">'http://www.baidu.com'</span>,<span class="string">'FAQ.html'</span>))</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">http://www.baidu.com/FAQ.html</span><br></pre></td></tr></table></figure>
<h3 id="urlencode"><a href="#urlencode" class="headerlink" title="urlencode"></a>urlencode</h3><ul>
<li>转换字典为请求的参数</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">base_url = <span class="string">'http://www.baidu.com/index.html;user?'</span></span><br><span class="line"></span><br><span class="line">params = &#123;</span><br><span class="line">    <span class="string">'name'</span>:<span class="string">'yangjinheng'</span>,</span><br><span class="line">    <span class="string">'age'</span>:<span class="string">'18'</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">args = urllib.parse.urlencode(params)</span><br><span class="line">url = base_url + args</span><br><span class="line"></span><br><span class="line">print(url)</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://www.baidu.com/index.html;user?name=yangjinheng&amp;age=18</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://yangjinheng.github.io/2017/10/06/python/27.Django笔记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jin Heng">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="默默">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/06/python/27.Django笔记/" itemprop="url">Django</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-10-06T00:00:00+08:00">
                2017-10-06
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="安装配置"><a href="#安装配置" class="headerlink" title="安装配置"></a>安装配置</h1><ul>
<li>安装 Django</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pip install django</span><br></pre></td></tr></table></figure>
<h2 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h2><ul>
<li>创建一个 Django 项目</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">django-admin.exe startproject mysite</span><br></pre></td></tr></table></figure>
<ul>
<li>项目文件组织</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysite</span><br><span class="line">    │  db.sqlite3              # sql-lite数据库文件</span><br><span class="line">    │  manage.py               # 管理 Django 项目的命令行工具</span><br><span class="line">    │</span><br><span class="line">    └─mysite                   # 目录包含你的项目，它是一个纯 Python 包</span><br><span class="line">            settings.py        # Django 项目的配置文件</span><br><span class="line">            urls.py            # Django 项目的 URL 声明，就像你网站的“目录”，路由的入口</span><br><span class="line">            wsgi.py            # 作为你的项目的运行在 WSGI 兼容的Web服务器上的入口文件</span><br><span class="line">            __init__.py        # 一个空文件，告诉 Python 这个目录应该被认为是一个 Python 包</span><br></pre></td></tr></table></figure>
<ul>
<li>设置时区和语言</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">LANGUAGE_CODE = &apos;zh-Hans&apos;</span><br><span class="line">TIME_ZONE = &apos;Asia/Shanghai&apos;</span><br></pre></td></tr></table></figure>
<h2 id="创建应用"><a href="#创建应用" class="headerlink" title="创建应用"></a>创建应用</h2><ul>
<li>创建一个应用，在 Django 中每个应用都是一个 Python 包，并且遵循相同的约定。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">python manage.py startapp polls</span><br></pre></td></tr></table></figure>
<ul>
<li>应用文件组织</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">polls                      # APP 名称</span><br><span class="line">    │  admin.py            # 数据库如果希望被后台看到，需要在这个文件下进行注册</span><br><span class="line">    │  apps.py             # 配置当前 APP</span><br><span class="line">    │  models.py           # 创建该 APP 下可能使用到的数据库</span><br><span class="line">    │  tests.py            # 实现某些测试驱动</span><br><span class="line">    │  views.py            # 实现对应的功能函数，访问 Django 网站页面其实是访问这些视图函数</span><br><span class="line">    │  __init__.py         # 声明目录是一个包</span><br><span class="line">    │</span><br><span class="line">    └─migrations</span><br><span class="line">            __init__.py    # 声明目录是一个包</span><br></pre></td></tr></table></figure>
<h2 id="启动项目"><a href="#启动项目" class="headerlink" title="启动项目"></a>启动项目</h2><ul>
<li>启动项目</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd mysite</span><br><span class="line">python manage.py runserver 0:80        # 0 是 0.0.0.0 的简写</span><br></pre></td></tr></table></figure>
<h2 id="配置总结"><a href="#配置总结" class="headerlink" title="配置总结"></a>配置总结</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">django-admin.exe startproject &lt;project_name&gt;</span><br><span class="line"></span><br><span class="line">python manage.py startapp &lt;app_name&gt;</span><br><span class="line"></span><br><span class="line">寻找静态的目录</span><br><span class="line">    INSTALLED_APPS 加入（注意修改app名字）： &apos;&lt;app_name&gt;.apps.&lt;app_name首字目大写&gt;Config&apos;,</span><br><span class="line"></span><br><span class="line">跨域请求</span><br><span class="line">    注掉： # &apos;django.middleware.csrf.CsrfViewMiddleware&apos;,</span><br><span class="line"></span><br><span class="line">模板目录</span><br><span class="line">    在 TEMPLATES 修改 DIRS 的值：&apos;DIRS&apos;: [os.path.join(BASE_DIR, &apos;templates&apos;)],</span><br></pre></td></tr></table></figure>
<h1 id="视图配置"><a href="#视图配置" class="headerlink" title="视图配置"></a>视图配置</h1><p>DJango 接收用户请求以后，可以使用一个函数来构建响应，这种模式叫 ：FBV，也可以使用类来构建响应，这种模式叫 CBV 模式。</p>
<h2 id="视图函数的用法"><a href="#视图函数的用法" class="headerlink" title="视图函数的用法"></a>视图函数的用法</h2><ul>
<li>编辑应用目录下的 <code>views.py</code> 文件，这是就是一个简单的视图。</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"Hello, world. You're at the polls index."</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>配置 URL 路由信息，它将用户访问的 URL 地址映射到一个函数，由函数处理。</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path,include</span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> views                 <span class="comment"># 在此处引入视图 views 模块</span></span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'admin/'</span>, admin.site.urls),</span><br><span class="line">    path(<span class="string">'index/'</span>, views.index),        <span class="comment"># 一个参数即从网站根开始匹配的 URL 地址，第二个是转交给的视图函数</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h2 id="视图类的用法"><a href="#视图类的用法" class="headerlink" title="视图类的用法"></a>视图类的用法</h2><p>请求到达类，会首先执行 <code>dispatch</code> 方法，它会根据用户HTTP请求方法来分配给不同的类方法，可用方法有：<code>[&#39;get&#39;, &#39;post&#39;, &#39;put&#39;, &#39;patch&#39;, &#39;delete&#39;, &#39;head&#39;, &#39;options&#39;, &#39;trace&#39;]</code>，如果我们需要当然可以重写 <code>dispatch</code> 方法，并且可以在请求分配之前和之后做一些事情。</p>
<ul>
<li>编写视图类，必须继承 View 类，在类的方法中写不同请求方法的处理流程。</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.views <span class="keyword">import</span> View</span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">index</span><span class="params">(View)</span>:</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dispatch</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        print(<span class="string">'before'</span>)</span><br><span class="line">        result = super().dispatch(request,*args,**kwargs)</span><br><span class="line">        print(<span class="string">'after'</span>)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self,request)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> render(request,<span class="string">'home.html'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self,request)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> render(request,<span class="string">'home.html'</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>增加视图类的路由，编辑 <code>urls.py</code> ，添加 <code>URL</code> 和 视图类，但注意视图类格式必须是： <code>views.类名.as_view()</code>。</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'admin/'</span>, admin.site.urls),</span><br><span class="line">    path(<span class="string">'index/'</span>,views.index),</span><br><span class="line">    path(<span class="string">'login/'</span>,views.index.as_view()),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h2 id="返回JSON数据"><a href="#返回JSON数据" class="headerlink" title="返回JSON数据"></a>返回JSON数据</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> JsonResponse</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_imgs</span><span class="params">(request)</span>:</span></span><br><span class="line">    ret = &#123;<span class="string">'status'</span>:<span class="literal">True</span>,<span class="string">'data'</span>:img_list&#125;</span><br><span class="line">    list1 = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line">    <span class="keyword">return</span> JsonResponse(ret)                     <span class="comment"># 默认可以直接处理JSON数据</span></span><br><span class="line">    <span class="keyword">return</span> JsonResponse(list1,safe=<span class="literal">False</span>)        <span class="comment"># 返回列表的时候需要使用safe参数</span></span><br></pre></td></tr></table></figure>
<h2 id="为响应增加头部"><a href="#为响应增加头部" class="headerlink" title="为响应增加头部"></a>为响应增加头部</h2><ul>
<li>为响应报文的头部增加信息</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line">    </span><br><span class="line">    res = HttpResponse(<span class="string">"Hello, world. You're at the polls index."</span>)</span><br><span class="line">    res[<span class="string">'key'</span>] = <span class="string">'values'</span></span><br><span class="line">    <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure>
<h2 id="允许跨域"><a href="#允许跨域" class="headerlink" title="允许跨域"></a>允许跨域</h2><ul>
<li>安装跨域中间件</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pip install django-cors-headers</span><br></pre></td></tr></table></figure>
<ul>
<li>添加到已经安装的应用中</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">INSTALLED_APPS  =  （</span><br><span class="line">    ... </span><br><span class="line">    &apos;&apos;corsheaders&apos; ，</span><br><span class="line">    ... </span><br><span class="line">）</span><br></pre></td></tr></table></figure>
<ul>
<li>添加到中间件 MIDDLEWARE 中，# 在 Django 版本小于 1.10 时候叫 MIDDLEWARE_CLASSES</li>
</ul>
<p>CorsMiddleware 应该放在能产生响应报文的中间件之前，如果使用了 CORS_REPLACE_HTTPS_REFERER 应该放在 CsrfViewMiddleware 之前。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">MIDDLEWARE = [</span><br><span class="line">    ...</span><br><span class="line">    &apos;corsheaders.middleware.CorsMiddleware&apos;,</span><br><span class="line">    &apos;django.middleware.common.CommonMiddleware&apos;,</span><br><span class="line">    ...</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<ul>
<li>设置允许的列表，下面的选项填写一种就行</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">- 允许全部的主机</span><br><span class="line"></span><br><span class="line">CORS_ORIGIN_ALLOW_ALL = True</span><br><span class="line"></span><br><span class="line">- 设置一个白名单，null 可以出现在这个列表中，它匹配请求报文中的 Origin: null ，例如客户端从文件运行时就为[]</span><br><span class="line">CORS_ORIGIN_WHITELIST = (</span><br><span class="line">    &apos;google.com&apos;,</span><br><span class="line">    &apos;hostname.example.com&apos;,</span><br><span class="line">    &apos;localhost:8000&apos;,</span><br><span class="line">    &apos;127.0.0.1:9000&apos;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ul>
<li>设置允许的请求方法</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">CORS_ALLOW_METHODS = (</span><br><span class="line">    &apos;DELETE&apos;,</span><br><span class="line">    &apos;GET&apos;,</span><br><span class="line">    &apos;OPTIONS&apos;,</span><br><span class="line">    &apos;PATCH&apos;,</span><br><span class="line">    &apos;POST&apos;,</span><br><span class="line">    &apos;PUT&apos;,</span><br><span class="line">    &apos;VIEW&apos;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ul>
<li>可以使用的非标准的请求头</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">CORS_ALLOW_HEADERS = (</span><br><span class="line">    &apos;XMLHttpRequest&apos;,</span><br><span class="line">    &apos;X_FILENAME&apos;,</span><br><span class="line">    &apos;accept&apos;,</span><br><span class="line">    &apos;accept-encoding&apos;,</span><br><span class="line">    &apos;authorization&apos;,</span><br><span class="line">    &apos;content-type&apos;,</span><br><span class="line">    &apos;dnt&apos;,</span><br><span class="line">    &apos;origin&apos;,</span><br><span class="line">    &apos;user-agent&apos;,</span><br><span class="line">    &apos;x-csrftoken&apos;,</span><br><span class="line">    &apos;x-requested-with&apos;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h2 id="视图中使用模板"><a href="#视图中使用模板" class="headerlink" title="视图中使用模板"></a>视图中使用模板</h2><p>一般我们需要用 HTML 页面文件响应用户请求，在 Django 中 HTML 文件称作模板文件，放在项目根目录下的 <code>templates</code> 目录里，所以需要修改项目的 <code>setting.py</code> 文件，让 <code>django</code> 能够从这个目录下寻找 HTML 文件。</p>
<ul>
<li>在项目根目录新建目录 <code>templates</code> 目录，编辑 <code>setting.py</code> 文件，在 <code>DIRS</code> 加入模板目录位置。</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">TEMPLATES = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">'BACKEND'</span>: <span class="string">'django.template.backends.django.DjangoTemplates'</span>,</span><br><span class="line">        <span class="string">'DIRS'</span>: [os.path.join(BASE_DIR,<span class="string">'templates'</span>)],           <span class="comment"># 在这里配置上 HTML 文件的目录路径</span></span><br><span class="line">        <span class="string">'APP_DIRS'</span>: <span class="literal">True</span>,</span><br><span class="line">        <span class="string">'OPTIONS'</span>: &#123;</span><br><span class="line">            <span class="string">'context_processors'</span>: [</span><br><span class="line">                <span class="string">'django.template.context_processors.debug'</span>,</span><br><span class="line">                <span class="string">'django.template.context_processors.request'</span>,</span><br><span class="line">                <span class="string">'django.contrib.auth.context_processors.auth'</span>,</span><br><span class="line">                <span class="string">'django.contrib.messages.context_processors.messages'</span>,</span><br><span class="line">            ],</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<ul>
<li>在视图函数中使用<code>render(request,&#39;file.html&#39;)</code>函数 <code>django</code> 会从 <code>templates</code> 目录里找到 HTML 文件并返回给客户端。</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> HttpResponse</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">'login.html'</span>)</span><br></pre></td></tr></table></figure>
<h2 id="静态文件配置"><a href="#静态文件配置" class="headerlink" title="静态文件配置"></a>静态文件配置</h2><p>在 HTML 文件里一定有大量的 <code>CSS、JS</code> 文件，这些文件作为 HTML 的一部分，客户端也需要下载到本地才能渲染 HTML 文件，所以需要配置静态文件的访问。</p>
<ul>
<li>在项目根目录新建 <code>static</code> 目录，在 <code>setting</code> 文件中配置静态目录的路径</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">STATIC_URL = <span class="string">'/static/'</span></span><br><span class="line"></span><br><span class="line">STATICFILES_DIRS = (</span><br><span class="line">    os.path.join(BASE_DIR,<span class="string">'static'</span>),</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ul>
<li>在 HTML 文件中引用静态文件，这样客户端在访问页面的时候就会自动下载这些需要的静态文件来渲染页面了</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"/static/commons.css"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/static/jquery-1.12.4.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="媒体文件配置"><a href="#媒体文件配置" class="headerlink" title="媒体文件配置"></a>媒体文件配置</h2><ul>
<li>在项目根目录新建 <code>upload</code> 目录，在 <code>setting</code> 文件中配置静态目录的路径</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">MEDIA_ROOT = os.path.join(BASE_DIR, <span class="string">'uploads'</span>)</span><br><span class="line">MEDIA_URL = <span class="string">'/uploads/'</span></span><br></pre></td></tr></table></figure>
<ul>
<li>在 urls.py 中使用 urlpatterns + 媒体文件配置</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'admin/'</span>, admin.site.urls),</span><br><span class="line">] + static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)</span><br></pre></td></tr></table></figure>
<ul>
<li>使用方式</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">在HTML文件中使用：/uploads/<span class="number">2018</span><span class="number">-6</span><span class="number">-25.j</span>pg 这样的方式来引用文件</span><br></pre></td></tr></table></figure>
<h2 id="获取客户端表单"><a href="#获取客户端表单" class="headerlink" title="获取客户端表单"></a>获取客户端表单</h2><ul>
<li>用户浏览到网页后，在网页上输入表单，服务器如何接收？下面是响应给用户的 HTML 的内容，内部包含了两个表单。</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"/static/commons.css"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/static/jquery-1.12.4.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">        lable&#123;</span><br><span class="line">            width: 80;</span><br><span class="line">            text-align: right;</span><br><span class="line">            display: inline-block;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">style</span>=<span class="string">"background-color: bisque"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"/login/"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span>                            <span class="comment">&lt;!--将表单又发回了这个URL--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"username"</span> &gt;</span>用户名：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"username"</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">type</span>=<span class="string">"text"</span>/&gt;</span>           <span class="comment">&lt;!--表单1--&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"password"</span>&gt;</span>密码：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"pwd"</span> <span class="attr">type</span>=<span class="string">"text"</span>/&gt;</span>            <span class="comment">&lt;!--表单2--&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">            篮球：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">name</span>=<span class="string">"favor"</span> <span class="attr">value</span>=<span class="string">"1"</span>/&gt;</span></span><br><span class="line">            足球：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">name</span>=<span class="string">"favor"</span> <span class="attr">value</span>=<span class="string">"2"</span>/&gt;</span></span><br><span class="line">            排球：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">name</span>=<span class="string">"favor"</span> <span class="attr">value</span>=<span class="string">"3"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"提交"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>配置项目配置文件 <code>setting</code> ，暂时禁用 跨站请求过滤的中间件</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">MIDDLEWARE = [</span><br><span class="line">    <span class="string">'django.middleware.security.SecurityMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.contrib.sessions.middleware.SessionMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.middleware.common.CommonMiddleware'</span>,</span><br><span class="line">    <span class="comment">#'django.middleware.csrf.CsrfViewMiddleware',</span></span><br><span class="line">    <span class="string">'django.contrib.auth.middleware.AuthenticationMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.contrib.messages.middleware.MessageMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.middleware.clickjacking.XFrameOptionsMiddleware'</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<ul>
<li>在服务器端的 views 函数内，request 包含了这次请求的所有信息，包括用户提交的表单</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> HttpResponse</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(request)</span>:</span></span><br><span class="line">    print(request.POST.get(<span class="string">'user'</span>,none))         <span class="comment"># 取得表单1</span></span><br><span class="line">    print(request.POST.get(<span class="string">'pwd'</span>,none))          <span class="comment"># 取得表单2 </span></span><br><span class="line">    print(request.POST.getlist(<span class="string">'favor'</span>,none))    <span class="comment"># 取得多选框的多有值</span></span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">'login.html'</span>)</span><br></pre></td></tr></table></figure>
<h2 id="请求地址重定向"><a href="#请求地址重定向" class="headerlink" title="请求地址重定向"></a>请求地址重定向</h2><p>如果需要将用户的请求重定向到新的链接，需要使用 <code>redirect()</code> 函数</p>
<ul>
<li>如果用户名密码正确则跳转</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> redirect</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line">	<span class="keyword">return</span> redirect(<span class="string">'http://www.baidu.com'</span>)</span><br></pre></td></tr></table></figure>
<h2 id="接收上传的文件"><a href="#接收上传的文件" class="headerlink" title="接收上传的文件"></a>接收上传的文件</h2><ul>
<li>HTML 文件中使用 <code>form</code>  表单来获取用户上传的文件时，必须设置一个属性：<code>enctype=&quot;multipart/form-data&quot;</code>。</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"/upload/"</span> <span class="attr">method</span>=<span class="string">"POST"</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"file"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"提交"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>在项目根目录新建 <code>upload</code> 目录，用来接收用户上传的文件</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mkdir -p upload</span><br></pre></td></tr></table></figure>
<ul>
<li>在视图函数中接收用户上传的文件到 <code>upload</code> 目录中</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render,HttpResponse,redirect</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'GET'</span>:</span><br><span class="line">        <span class="keyword">return</span> render(request,<span class="string">'upload.html'</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        user_file = request.FILES.get(<span class="string">'file'</span>)</span><br><span class="line">        <span class="keyword">with</span> open(<span class="string">'upload/'</span> + user_file.name,<span class="string">'wb'</span>) <span class="keyword">as</span> local_file:</span><br><span class="line">            <span class="keyword">for</span> chunk <span class="keyword">in</span> user_file.chunks():</span><br><span class="line">                local_file.write(chunk)</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">'ok'</span>)</span><br></pre></td></tr></table></figure>
<h2 id="文章分页的原理"><a href="#文章分页的原理" class="headerlink" title="文章分页的原理"></a>文章分页的原理</h2><ul>
<li>分页原理</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">USER_LIST = []                                    <span class="comment"># 模拟文章数据</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">999</span>):                            <span class="comment"># 模拟文章数据</span></span><br><span class="line">    temp = &#123;<span class="string">'name'</span>:<span class="string">'root'</span>+str(i),<span class="string">'age'</span>:i&#125;</span><br><span class="line">    USER_LIST.append(temp)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line">    per_page_count = <span class="number">10</span>                           <span class="comment"># 每页的文章数</span></span><br><span class="line">    current_page = int(request.GET.get(<span class="string">'p'</span>,<span class="number">1</span>)）   <span class="comment"># 通过 GET 请求指定页面</span></span><br><span class="line"></span><br><span class="line">    start = (current_page - <span class="number">1</span>) * per_page_count   <span class="comment"># 设置页面起始位置</span></span><br><span class="line">    end = current_page * per_page_count           <span class="comment"># 设置页面结束位置</span></span><br><span class="line"></span><br><span class="line">    data = USER_LIST[start:end]                   <span class="comment"># 对数据进行切片</span></span><br><span class="line"></span><br><span class="line">    prev_pager = current_page - <span class="number">1</span>                 <span class="comment"># 网页上的上一页功能</span></span><br><span class="line">    next_pager = current_page + <span class="number">1</span>                 <span class="comment"># 网页的下一个功能</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">'index.html'</span>,&#123;<span class="string">'user_list'</span>:data,<span class="string">'prev_pager'</span>:prev_pager,<span class="string">'next_pager'</span>:next_pager&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>模板文件</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        &#123;% for row in user_list %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123; row.name &#125;&#125; &#123;&#123; row.age &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        &#123;% endfor %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/?p=&#123;&#123; prev_pager &#125;&#125;"</span>&gt;</span>上一页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/?p=&#123;&#123; next_pager &#125;&#125;"</span>&gt;</span>下一页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="Django分页模块"><a href="#Django分页模块" class="headerlink" title="Django分页模块"></a>Django分页模块</h2><ul>
<li>页面视图</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index1</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">from</span> django.core.paginator <span class="keyword">import</span> PageNotAnInteger, EmptyPage, Paginator</span><br><span class="line"></span><br><span class="line">    current_page = request.GET.get(<span class="string">'p'</span>)                          <span class="comment"># 通过 GET 请求指定页面</span></span><br><span class="line"></span><br><span class="line">    paginator = Paginator(USER_LIST,<span class="number">10</span>)                          <span class="comment"># 生成分页对象</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        posts = paginator.page(current_page)                     <span class="comment"># 指定页码</span></span><br><span class="line">    <span class="keyword">except</span> PageNotAnInteger:                                     <span class="comment"># 如果指定的页码不存在</span></span><br><span class="line">        posts = paginator.page(<span class="number">1</span>)                                <span class="comment"># 将页面重置到第一页</span></span><br><span class="line">    <span class="keyword">except</span> EmptyPage:                                            <span class="comment"># 如果请求的超出页码范围</span></span><br><span class="line">        posts = paginator.page(paginator.num_pages)              <span class="comment"># 将页面重置到最后一页</span></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'index1.html'</span>,&#123;<span class="string">'posts'</span>: posts&#125;)       <span class="comment"># 将页码切片数据传给模板</span></span><br></pre></td></tr></table></figure>
<ul>
<li>模板文件</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        &#123;% for row in posts.object_list %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123; row.name &#125;&#125; &#123;&#123; row.age &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        &#123;% endfor %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    &#123;% if posts.has_previous %&#125;           <span class="comment">&lt;!--如果存在上一页--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/index1?p=&#123;&#123; posts.previous_page_number &#125;&#125;"</span>&gt;</span>上一页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    &#123;% else %&#125;                            <span class="comment">&lt;!--如果不存在下一页--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>上一页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line">    </span><br><span class="line">    &#123;% if posts.has_next %&#125;               <span class="comment">&lt;!--如果存在下一页--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/index1?p=&#123;&#123; posts.next_page_number &#125;&#125;"</span>&gt;</span>下一页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    &#123;% else %&#125;                            <span class="comment">&lt;!--如果不存在下一页--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>下一页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span></span><br><span class="line">        &#123;&#123; posts.number &#125;&#125; / &#123;&#123; posts.paginator.num_pages &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Paginator 对象</li>
</ul>
<table>
<thead>
<tr>
<th>属性</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>per_page</code></td>
<td>每页显示的条目数量</td>
</tr>
<tr>
<td><code>count</code></td>
<td>数据总个数</td>
</tr>
<tr>
<td><code>num_pages</code></td>
<td>总页数</td>
</tr>
<tr>
<td><code>page_range</code></td>
<td>总页数的索引范围</td>
</tr>
<tr>
<td><code>page</code></td>
<td><code>page</code> 对象</td>
</tr>
</tbody>
</table>
<ul>
<li>Page 对象</li>
</ul>
<table>
<thead>
<tr>
<th>属性</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>has_next</code></td>
<td>是否有下一页</td>
</tr>
<tr>
<td><code>next_page_number</code></td>
<td>下一页页码</td>
</tr>
<tr>
<td><code>has_previous</code></td>
<td>是否有上一页</td>
</tr>
<tr>
<td><code>previous_page_number</code></td>
<td>上一页页码</td>
</tr>
<tr>
<td><code>object_list</code></td>
<td>分页之后的数据列表，已经切片好的数据</td>
</tr>
<tr>
<td><code>number</code></td>
<td>当前页</td>
</tr>
<tr>
<td><code>paginator</code></td>
<td><code>Paginator</code>对象</td>
</tr>
</tbody>
</table>
<h3 id="扩展Django分页"><a href="#扩展Django分页" class="headerlink" title="扩展Django分页"></a>扩展Django分页</h3><ul>
<li>继承 Paginator 新增功能pager_num_range，在上一页与下一页的中间显示页页码序列</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.core.paginator <span class="keyword">import</span> PageNotAnInteger, EmptyPage, Paginator</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CustomPaginator</span><span class="params">(Paginator)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, current_page, per_page_num, *args, **kwargs)</span>:</span></span><br><span class="line">        self.current_page = int(current_page)</span><br><span class="line">        self.per_page_num = int(per_page_num)</span><br><span class="line">        super().__init__(*args, **kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pager_num_range</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.num_pages &lt; self.per_page_num:                                        <span class="comment"># 如果总页数小于页码序列数</span></span><br><span class="line">            <span class="keyword">return</span> range(<span class="number">1</span>, self.num_pages + <span class="number">1</span>)                                       <span class="comment"># 返回1到总页数</span></span><br><span class="line">        part = int(self.per_page_num / <span class="number">2</span>)                                             <span class="comment"># 页码序列数的一半的数字</span></span><br><span class="line">        <span class="keyword">if</span> self.current_page &lt;= part:                                                 <span class="comment"># 如果当前页码小于号码页的一半</span></span><br><span class="line">            <span class="keyword">return</span> range(<span class="number">1</span>, self.per_page_num + <span class="number">1</span>)                                    <span class="comment"># 返回1到页码序列数</span></span><br><span class="line">        <span class="keyword">if</span> (self.current_page + part) &gt; self.num_pages:                               <span class="comment"># 如果当前页面加页码序列数的一半大于总页数</span></span><br><span class="line">            <span class="keyword">return</span> range(self.num_pages - self.per_page_num + <span class="number">1</span>, self.num_pages + <span class="number">1</span>)  <span class="comment"># 返回总页数减去页码序列数+1 到 总页数+1</span></span><br><span class="line">        <span class="keyword">return</span> range(self.current_page - part, self.current_page + part + <span class="number">1</span>)          <span class="comment"># 返回当前页码减页码序列数的一半，当前页码+页码序列数+1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index1</span><span class="params">(request)</span>:</span></span><br><span class="line">    current_page = request.GET.get(<span class="string">'p'</span>,<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    paginator = CustomPaginator(current_page, <span class="number">11</span>, USER_LIST, <span class="number">10</span>)                      <span class="comment"># 传入当前页码，和页码序列数，数据，和分页大小</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        posts = paginator.page(current_page)</span><br><span class="line">    <span class="keyword">except</span> PageNotAnInteger:</span><br><span class="line">        posts = paginator.page(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">except</span> EmptyPage:</span><br><span class="line">        posts = paginator.page(paginator.num_pages)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'index1.html'</span>, &#123;<span class="string">'posts'</span>: posts&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>模板文件</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        &#123;% for row in posts.object_list %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123; row.name &#125;&#125; &#123;&#123; row.age &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        &#123;% endfor %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    &#123;% if posts.has_previous %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/index1?p=&#123;&#123; posts.previous_page_number &#125;&#125;"</span>&gt;</span>上一页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    &#123;% else %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>上一页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line">    </span><br><span class="line">    &#123;% for i in posts.paginator.pager_num_range %&#125;</span><br><span class="line">        &#123;% if i == posts.number %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/index1?p=&#123;&#123; i &#125;&#125;"</span> <span class="attr">style</span>=<span class="string">"font-size: 25px;"</span>&gt;</span>&#123;&#123; i &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        &#123;% else %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/index1?p=&#123;&#123; i &#125;&#125;"</span>&gt;</span>&#123;&#123; i &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        &#123;% endif %&#125;</span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">    </span><br><span class="line">    &#123;% if posts.has_next %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/index1?p=&#123;&#123; posts.next_page_number &#125;&#125;"</span>&gt;</span>下一页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    &#123;% else %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>下一页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span></span><br><span class="line">        &#123;&#123; posts.number &#125;&#125; / &#123;&#123; posts.paginator.num_pages &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>效果：<a href="http://127.0.0.1:8000/index1?p=12" target="_blank" rel="noopener">http://127.0.0.1:8000/index1?p=12</a></li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">* root111 111</span><br><span class="line">* root112 112</span><br><span class="line">* root113 113</span><br><span class="line">* root114 114</span><br><span class="line">* root115 115</span><br><span class="line">* root116 116</span><br><span class="line">* root117 117</span><br><span class="line">* root118 118</span><br><span class="line">* root119 119</span><br><span class="line">* root120 120</span><br><span class="line">上一页 7 8 9 10 11 12 13 14 15 16 17 下一页 12 / 100</span><br></pre></td></tr></table></figure>
<h1 id="模板使用"><a href="#模板使用" class="headerlink" title="模板使用"></a>模板使用</h1><ul>
<li>相关配置</li>
</ul>
<p>项目的 <code>settings.py</code> 文件的 <code>TEMPLATES</code> 配置段有一个名字为 <code>APP_DIRS</code> 配置，当它为为 True 时候，Django会在每个 <code>INSTALLED_APPS</code> 文件夹中寻找 <code>templates</code> 子目录，接下来在 APP的目录新建一个 <code>templates</code> 就可以把HTML文件放在里面了。</p>
<h2 id="render函数"><a href="#render函数" class="headerlink" title="render函数"></a>render函数</h2><p><code>render()</code> 函数可以接收第三个参数，它是一个字典的参数，它将传递给模板，由模板从这个字典中取得数据</p>
<h2 id="模板语言"><a href="#模板语言" class="headerlink" title="模板语言"></a>模板语言</h2><h3 id="for循环"><a href="#for循环" class="headerlink" title="for循环"></a>for循环</h3><ul>
<li>列表的遍历</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">USERLIST = [</span><br><span class="line">    &#123;'name':'yangjinheng','age':29,'gender':'M'&#125;,</span><br><span class="line">    &#123;'name':'zhengpengli','age':29,'gender':'F'&#125;,</span><br><span class="line">    &#123;'name':'yangzhongxiao','age':27,'gender':'M'&#125;,</span><br><span class="line">    &#123;'name':'liying','age':25,'gender':'F'&#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">render(request, 'home.html', &#123;'userlist': USERDICT&#125;)</span><br><span class="line"></span><br><span class="line">&#123;% for dict in userlist %&#125;        # 遍历列表</span><br><span class="line">    &#123;&#123; dict.name &#125;&#125;               # 访问字典</span><br><span class="line">    &#123;&#123; dict.agr &#125;&#125;                # 访问字典</span><br><span class="line">    &#123;&#123; dict.gender &#125;&#125;             # 访问字典</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>字典的遍历</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">USERDICT = &#123;</span><br><span class="line">    'k1':'V1',</span><br><span class="line">    'k2':'V2',</span><br><span class="line">    'k3':'V3',</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render(request, 'home.html', &#123;'userlist': USERDICT&#125;)</span><br><span class="line"></span><br><span class="line">&#123;&#123;% userlist.k1 %&#125;&#125;                 # 直接访问字典的值</span><br><span class="line"></span><br><span class="line">&#123;% for keys in userlist.keys %&#125;</span><br><span class="line">    &#123;&#123; keys &#125;&#125;                      # 遍历字典的键</span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% for values in userlist.values %&#125;</span><br><span class="line">    &#123;&#123; values &#125;&#125;                    # 遍历字典的值</span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% for items in userlist.items %&#125;</span><br><span class="line">    &#123;&#123; items &#125;&#125;                     # 字典的键值</span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% for k,v in userlist.items %&#125;</span><br><span class="line">    &#123;&#123; k &#125;&#125; &#123;&#123; v &#125;&#125;                 # 字典的键值分离</span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% for k,v in userlist.items %&#125;</span><br><span class="line">    &#123;&#123; k &#125;&#125; &#123;&#123; v &#125;&#125;                 # 字典的键值分离</span><br><span class="line">	&#123;&#123; forloop.counter &#125;&#125;          # 当前循环的次数</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>
<h3 id="if-语句"><a href="#if-语句" class="headerlink" title="if 语句"></a>if 语句</h3><ul>
<li>模板中的 if 语句的使用，它可以嵌套在其他语句中，或者自身嵌套</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&#123;% if age %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span>&gt;</span>有年龄<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    &#123;% if age &gt;16 %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span>&gt;</span>老男人<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    &#123;% else %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span>&gt;</span>小鲜肉<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line">&#123;% else %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span>&gt;</span>数据<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure>
<h2 id="模板的引用"><a href="#模板的引用" class="headerlink" title="模板的引用"></a>模板的引用</h2><p>在项目的 templates 目录内新建一个 include 目录，在这个目录内放入 模板的代码片段，方便引用和重用。</p>
<ul>
<li>例如：templates/include/page.html</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&#123;% if posts.has_previous %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/index1?p=&#123;&#123; posts.previous_page_number &#125;&#125;"</span>&gt;</span>上一页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">&#123;% else %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>上一页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% if posts.has_next %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/index1?p=&#123;&#123; posts.next_page_number &#125;&#125;"</span>&gt;</span>下一页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">&#123;% else %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>下一页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span>&gt;</span></span><br><span class="line">    &#123;&#123; posts.number &#125;&#125; / &#123;&#123; posts.paginator.num_pages &#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>使用 include 引入外部的模板文件</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        &#123;% for row in posts.object_list %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123; row.name &#125;&#125; &#123;&#123; row.age &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        &#123;% endfor %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    &#123;% include 'include/page.html'%&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="模板示例"><a href="#模板示例" class="headerlink" title="模板示例"></a>模板示例</h2><h3 id="模板示例1"><a href="#模板示例1" class="headerlink" title="模板示例1"></a>模板示例1</h3><p>实现一个用户名密码错误的时候在旁边显示一行提示信息。</p>
<ul>
<li>HTML 文件内容</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">style</span>=<span class="string">"background-color: bisque"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"/login/"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"username"</span> &gt;</span>用户名：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"username"</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">type</span>=<span class="string">"text"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"password"</span>&gt;</span>密码：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"pwd"</span> <span class="attr">type</span>=<span class="string">"text"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"提交"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">"color: aqua"</span>&gt;</span>&#123;&#123; error_message &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span>    <span class="comment">&lt;!--在HTML文件中为模板预留好位置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>在 <code>view</code> 函数中<code>render()</code> 函数中传递字典，字典的 <code>key</code> 与 HTML 文件中的预留位置匹配，将被替换为字典的 <code>value</code></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render,HttpResponse,redirect</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(request)</span>:</span></span><br><span class="line">    error_message = <span class="string">''</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">        user = request.POST.get(<span class="string">'user'</span>,<span class="literal">None</span>)</span><br><span class="line">        pwd = request.POST.get(<span class="string">'pwd'</span>,<span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">if</span> user == <span class="string">'root'</span> <span class="keyword">and</span> pwd == <span class="string">'123'</span>:</span><br><span class="line">            <span class="keyword">return</span> redirect(<span class="string">'http://www.baidu.com'</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            error_message = <span class="string">'用户名密码错误'</span></span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">'login.html'</span>,&#123;<span class="string">'error_message'</span>:error_message&#125;)    <span class="comment"># 在视图函数中为HTML文件中为模板预留好位置 填充数据</span></span><br></pre></td></tr></table></figure>
<h3 id="模板示例2"><a href="#模板示例2" class="headerlink" title="模板示例2"></a>模板示例2</h3><p>实现一个由用户提交数据到后台，后台存储并将新的数据返回给用户展示</p>
<ul>
<li>HTML 文件中内定义模板语言</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"/home"</span> <span class="attr">method</span>=<span class="string">"POST"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"email"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"gender"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"添加"</span>/&gt;</span>    <span class="comment">&lt;!--将表单提交给POST方法到自身的页面--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line">        &#123;% for row in userlist %&#125;             <span class="comment">&lt;!--在模板中循环，reder 传递的字典 userlist--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; row.username &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span>    <span class="comment">&lt;!--将字典中的小字典的用户名填充在这个表格--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; row.gender &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; row.email &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        &#123;% endfor %&#125;                          <span class="comment">&lt;!--结束循环--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>使用 <code>render</code> 函数向模板传递字典（可以是多个值），由模板的进行页面的渲染</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">USERLIST = [</span><br><span class="line">    &#123;<span class="string">'id'</span>: <span class="string">'134432'</span>, <span class="string">'username'</span>: <span class="string">'alex'</span>, <span class="string">'email'</span>: <span class="string">'4234@qq.com'</span>, <span class="string">'gender'</span>: <span class="string">'男'</span>&#125;,</span><br><span class="line">    &#123;<span class="string">'id'</span>: <span class="string">'134423'</span>, <span class="string">'username'</span>: <span class="string">'yangjinheng'</span>, <span class="string">'email'</span>: <span class="string">'42222@qq.com'</span>, <span class="string">'gender'</span>: <span class="string">'男'</span>&#125;,</span><br><span class="line">    &#123;<span class="string">'id'</span>: <span class="string">'333311'</span>, <span class="string">'username'</span>: <span class="string">'yangxiaoxiao'</span>, <span class="string">'email'</span>: <span class="string">'424232@qq.com'</span>, <span class="string">'gender'</span>: <span class="string">'男'</span>&#125;,</span><br><span class="line">]    <span class="comment"># 如果此处是数据库，那么就实现了与从从数据库中取得数据渲染到前端的页面上了</span></span><br><span class="line"></span><br><span class="line">demo = &#123;</span><br><span class="line">    <span class="string">'id'</span>:<span class="number">1024</span></span><br><span class="line">    <span class="string">'name'</span>:<span class="string">'yangjinheng'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">home</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:    <span class="comment"># 收到POST请求，向列表内追加新的元素，POST最后也会返回给用户新数据</span></span><br><span class="line">        user = request.POST.get(<span class="string">'username'</span>)</span><br><span class="line">        email = request.POST.get(<span class="string">'email'</span>)</span><br><span class="line">        gender = request.POST.get(<span class="string">'gender'</span>)</span><br><span class="line">        temp = &#123;<span class="string">'username'</span>:user,<span class="string">'email'</span>:email,<span class="string">'gender'</span>:gender&#125;</span><br><span class="line">        USERLIST.append(temp)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'home.html'</span>, &#123;<span class="string">'userlist'</span>: USERLIST,<span class="string">'demo'</span>:demo&#125;)<span class="comment"># 向模板传递多个值的字典</span></span><br></pre></td></tr></table></figure>
<h1 id="路由配置"><a href="#路由配置" class="headerlink" title="路由配置"></a>路由配置</h1><h2 id="path-函数"><a href="#path-函数" class="headerlink" title="path()函数"></a>path()函数</h2><ul>
<li>它有四个参数，两个必须参数：<code>route</code> 和 <code>view</code>，两个可选参数：<code>kwargs</code> 和 <code>name</code>。</li>
</ul>
<table>
<thead>
<tr>
<th>参数</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>route</code></td>
<td>是一个 URL 的匹配模式，请求到达时 Django 会遍历 <code>urlpatterns</code> 使用这个模式进行匹配，但它不处理域名和 URL 中 GET 或者 POST 的参数。</td>
</tr>
<tr>
<td><code>view</code></td>
<td>是一个当 URL 通过匹配模式后调用的一个视图函数，它必须接收 <code>HttpRequest</code> 对象作为第一参数，另外，模式匹配中的分组匹配到的信息也将以关键字参数的形式传入这个视图函数。</td>
</tr>
<tr>
<td><code>kwargs</code></td>
<td>任意数量的关键字参数，将作为一个字典传递给目标视图函数。</td>
</tr>
<tr>
<td><code>name</code></td>
<td>为匹配到的 URL 命名，可以在 <code>Django</code> 的任意地方引用它，尤其是在模板中使用，可避免 URL 变动而需要修改很多地方的情况。</td>
</tr>
</tbody>
</table>
<h2 id="路由匹配"><a href="#路由匹配" class="headerlink" title="路由匹配"></a>路由匹配</h2><h3 id="内置分组转换"><a href="#内置分组转换" class="headerlink" title="内置分组转换"></a>内置分组转换</h3><p>Django 内置的分组转换器，能够将匹配到的数据转换为匹配模式本身所表达的数据类型，并且以关键字的形式传递给视图函数。</p>
<ul>
<li>内置分组转换</li>
</ul>
<table>
<thead>
<tr>
<th>模式</th>
<th>匹配</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>str</code></td>
<td>匹配任何非空字符串，不包括路径分隔符<code>&#39;/&#39;</code>。如果转换器不包含在表达式中，这是默认值。</td>
</tr>
<tr>
<td><code>int</code></td>
<td>匹配零或任何正整数。返回一个 <code>int</code>。</td>
</tr>
<tr>
<td><code>slug</code></td>
<td>匹配由ASCII字母或数字组成的连结型字符串，以及连字符和下划线字符。例如， <code>building-your-1st-django-site</code>。</td>
</tr>
<tr>
<td><code>uuid</code></td>
<td>匹配格式化的 <code>uuid</code>。若要防止多个 <code>url</code> 映射到同一页，必须包含破折号，并且字母必须为小写。例如, 075194d3-6885-417e-a8a8-6c931e272f00。返回一个 UUID 实例。</td>
</tr>
<tr>
<td><code>path</code></td>
<td>匹配任何非空字符串, 包括路径分隔符 “/“。这使您能够匹配完整的 <code>url</code> 路径, 而不只是与 <code>str</code> 相同的 <code>url</code> 路径段。</td>
</tr>
</tbody>
</table>
<ul>
<li>在路由的模式匹配中使用分组匹配，并且为分组命名，它将被当作参数发送到视图函数中</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'int:question_id/'</span>, views.detail),            <span class="comment"># /5/</span></span><br><span class="line">    path(<span class="string">'int:question_id/results/'</span>, views.results),   <span class="comment"># /5/results/</span></span><br><span class="line">    path(<span class="string">'int:question_id/vote/'</span>, views.vote),         <span class="comment"># /5/vote/</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<ul>
<li>在视图函数中接收来自 URL 模式匹配到的参数，并且处理，这里的匹配到的分组名为：<code>question_id</code></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">detail</span><span class="params">(request, question_id)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"You're looking at question %s."</span> % question_id)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">results</span><span class="params">(request, question_id)</span>:</span></span><br><span class="line">    response = <span class="string">"You're looking at the results of question %s."</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(response % question_id)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">vote</span><span class="params">(request, question_id)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"You're voting on question %s."</span> % question_id)</span><br></pre></td></tr></table></figure>
<ul>
<li>另外的示例</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'articles/2003/'</span>, views.special_case_2003),</span><br><span class="line">    path(<span class="string">'articles/&lt;int:year&gt;/'</span>, views.year_archive),</span><br><span class="line">    path(<span class="string">'articles/&lt;int:year&gt;/&lt;int:month&gt;/'</span>, views.month_archive),</span><br><span class="line">    path(<span class="string">'articles/&lt;int:year&gt;/&lt;int:month&gt;/&lt;slug:slug&gt;/'</span>, views.article_detail),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h3 id="自定义分组转换"><a href="#自定义分组转换" class="headerlink" title="自定义分组转换"></a>自定义分组转换</h3><ul>
<li>样例性配置</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FourDigitYearConverter</span>:</span></span><br><span class="line">    regex = <span class="string">'[0-9]&#123;4&#125;'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">to_python</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> int(value)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">to_url</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'%04d'</span> % value</span><br></pre></td></tr></table></figure>
<ul>
<li>自定义转换器是一个类，它包含如下内容：</li>
</ul>
<table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>regex</code></td>
<td>属性，它是一个字符串形式的正则表达式</td>
</tr>
<tr>
<td><code>to_python(self, value)</code></td>
<td>方法，它将匹配的字符串转换为应传递给视图函数的数据类型。如果它不能转换给定的值, 它应该引发 ValueError。</td>
</tr>
<tr>
<td><code>to_url(self, value)</code></td>
<td>方法, 它处理将 Python 类型转换为要在 URL 中使用的字符串。</td>
</tr>
</tbody>
</table>
<ul>
<li>使用方法</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path, register_converter</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> converters, views</span><br><span class="line">register_converter(converters.FourDigitYearConverter, <span class="string">'yyyy'</span>)</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'articles/2003/'</span>, views.special_case_2003),</span><br><span class="line">    path(<span class="string">'articles/&lt;yyyy:year&gt;/'</span>, views.year_archive),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h3 id="正则表达式匹配"><a href="#正则表达式匹配" class="headerlink" title="正则表达式匹配"></a>正则表达式匹配</h3><p>正则表达式的匹配函数为 <code>re_path</code>，在Python中，命名分组的语法是<code>(?P&lt;name&gt;pattern)</code>，<code>name</code>是组名称，<code>pattern</code>是匹配模式，匹配到的参数，会使用分组的命名，作为关键字参数传递给视图，但注意：无论正则表达式匹配什么类型，每个捕获的参数都以字符串的形式发送到视图函数。</p>
<ul>
<li>示例性配置</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path, re_path</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'articles/2003/'</span>, views.special_case_2003),</span><br><span class="line">    re_path(<span class="string">r'^articles/(?P&lt;year&gt;[0-9]&#123;4&#125;)/$'</span>, views.year_archive),</span><br><span class="line">    re_path(<span class="string">r'^articles/(?P&lt;year&gt;[0-9]&#123;4&#125;)/(?P&lt;month&gt;[0-9]&#123;2&#125;)/$'</span>, views.month_archive),</span><br><span class="line">    re_path(<span class="string">r'^articles/(?P&lt;year&gt;[0-9]&#123;4&#125;)/(?P&lt;month&gt;[0-9]&#123;2&#125;)/(?P&lt;slug&gt;[\w-]+)/$'</span>, views.article_detail),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h3 id="无分组正则匹配"><a href="#无分组正则匹配" class="headerlink" title="无分组正则匹配"></a>无分组正则匹配</h3><p>除了正则表达式分组，您也可以使用较短的未命名组，例如<code>([0-9]{4})</code>，这种用法不是特别推荐的，因为更容易匹配到错误的信息，传递给视图的参数也可能出错，无论哪种情况，建议在给定的正则表达式中只使用一种样式，当两种样式混合使用时，所有未命名的组都会被忽略，只有命名组被当作参数传递给视图函。</p>
<h2 id="目标视图"><a href="#目标视图" class="headerlink" title="目标视图"></a>目标视图</h2><p><code>path()</code> 函数可以将匹配此模式的URL交给：视图函数、include 函数，include 函数可以对 URL 地址进行再次匹配。</p>
<h3 id="view函数"><a href="#view函数" class="headerlink" title="view函数"></a>view函数</h3><ul>
<li>被模式匹配的 URL 请求会被分配给指定的视图函数</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'blog/&lt;int:year&gt;/'</span>, views.year_archive),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h3 id="include函数"><a href="#include函数" class="headerlink" title="include函数"></a>include函数</h3><p><code>include()</code> 函数可以实现路由的分类，访问一类页面的请求分配一类 APP 路由处理，<code>include()</code> 函数就是实现多级路由的方式。</p>
<h4 id="分类路由"><a href="#分类路由" class="headerlink" title="分类路由"></a>分类路由</h4><p>使用 <code>include()</code> 可以将路由分为两个部分：项目路由、APP 路由。</p>
<ul>
<li>配置项目路由，使用 <code>include</code> 函数，将请求交给 APP 路由处理。</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path,include</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'admin/'</span>, admin.site.urls),</span><br><span class="line">    path(<span class="string">'polls/'</span>, include(<span class="string">'polls.urls'</span>)),   <span class="comment"># polls 包下的 urls 模块</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">当有请求与 polls 匹配，Django 会截断匹配到的部分，把后续的 URL 交给 include 函数指定的 URLconf 来处理，也就是说访问：http://127.0.0.1/polls/，首先经过 项目路由，然后剩余的 URL 部分为空，被 APP 路由处理。</span><br></pre></td></tr></table></figure>
<ul>
<li>配置 APP 路由，需要在 APP 目录下创建 <code>urls.py</code> 文件，接收项目路由的发来的请求</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views                          <span class="comment"># 从当前包导入 views 视图子包，一定要进行此步骤，否则无法找到最后的视图函数</span></span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">''</span>, views.index, name=<span class="string">'index'</span>),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h4 id="额外匹配"><a href="#额外匹配" class="headerlink" title="额外匹配"></a>额外匹配</h4><p>这种模式在 include 函数内包含了另外一个匹配模式。</p>
<ul>
<li>额外匹配，例如：下面使用了一个扩展的列表来实现额外匹配。</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> include, path</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> apps.main <span class="keyword">import</span> views <span class="keyword">as</span> main_views</span><br><span class="line"><span class="keyword">from</span> credit <span class="keyword">import</span> views <span class="keyword">as</span> credit_views</span><br><span class="line"></span><br><span class="line">extra_patterns = [</span><br><span class="line">    path(<span class="string">'reports/'</span>, credit_views.report),</span><br><span class="line">    path(<span class="string">'reports/&lt;int:id&gt;/'</span>, credit_views.report),</span><br><span class="line">    path(<span class="string">'charge/'</span>, credit_views.charge),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">''</span>, main_views.homepage),</span><br><span class="line">    path(<span class="string">'help/'</span>, include(<span class="string">'apps.help.urls'</span>)),</span><br><span class="line">    path(<span class="string">'credit/'</span>, include(extra_patterns)),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<ul>
<li>额外匹配，例如：共同前戳的匹配，<code>slug</code> 模式匹配 <code>连字符</code> 的字符串。</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> include, path</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'&lt;page_slug&gt;-&lt;page_id&gt;/'</span>, include([</span><br><span class="line">        path(<span class="string">'history/'</span>, views.history),</span><br><span class="line">        path(<span class="string">'edit/'</span>, views.edit),</span><br><span class="line">        path(<span class="string">'discuss/'</span>, views.discuss),</span><br><span class="line">        path(<span class="string">'permissions/'</span>, views.permissions),</span><br><span class="line">    ])),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h2 id="视图参数"><a href="#视图参数" class="headerlink" title="视图参数"></a>视图参数</h2><ul>
<li><code>path()</code> 还可以接受一个可变关键字参数，它会被传递给视图函数，<code>include()</code> 会传递该参数，直到最终到达视图函数。</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'blog/&lt;int:year&gt;/'</span>, views.year_archive, &#123;<span class="string">'foo'</span>: <span class="string">'bar'</span>&#125;),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<blockquote>
<p>  上面的示例，会让视图得到模式匹配的参数：year、和关键字参数：foo，最终形式：<code>views.year_archive(request, year=2005, foo=&#39;bar&#39;)</code></p>
</blockquote>
<h2 id="命名路由"><a href="#命名路由" class="headerlink" title="命名路由"></a>命名路由</h2><p>为匹配到的 URL 命名，可以在 <code>Django</code> 的任意地方引用它，尤其是在模板中使用，可避免 URL 变动而需要修改很多地方的情况。</p>
<h3 id="在模板中引用"><a href="#在模板中引用" class="headerlink" title="在模板中引用"></a>在模板中引用</h3><ul>
<li>对 URL 进行命名，<code>urls.py</code>。</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'index_hemo_info/'</span>,views.index,name=<span class="string">'index'</span>),    <span class="comment"># </span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<ul>
<li>在模板中应用URL，<code>index.html</code>。</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"&#123;% url 'index' %&#125;"</span> <span class="attr">method</span>=<span class="string">"POST"</span>&gt;</span>                       <span class="comment">&lt;!--在模板中引用命名的 URL--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">placeholder</span>=<span class="string">"用户名"</span>/&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"email"</span> <span class="attr">placeholder</span>=<span class="string">"邮箱"</span>/&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"提交"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>简化理解</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">path(<span class="string">'index_hemo_info/'</span>,views.index,name=<span class="string">'index'</span>)</span><br><span class="line"></span><br><span class="line">&#123;% url <span class="string">'index'</span> %&#125;                <span class="comment"># 结果为：/index_hemo_info</span></span><br><span class="line">&#123;% url <span class="string">'index'</span> <span class="number">2</span> %&#125;              <span class="comment"># 结果为：/index_hemo_info/2</span></span><br><span class="line">&#123;% url <span class="string">'index'</span> <span class="number">2</span> <span class="number">6</span> %&#125;            <span class="comment"># 结果为：/index_hemo_info/2/6</span></span><br><span class="line">&#123;% url <span class="string">'index'</span> uid=<span class="number">2</span> pid=<span class="number">6</span> %&#125;    <span class="comment"># 结果为：/index_hemo_info/2/6</span></span><br></pre></td></tr></table></figure>
<h3 id="在视图中引用"><a href="#在视图中引用" class="headerlink" title="在视图中引用"></a>在视图中引用</h3><p>命名的 URL 可以在视图函数中，使用 <code>reverse()</code> 函数调用，它还可以实现拼接。 </p>
<ul>
<li>对 URL 进行命名，<code>urls.py</code>。</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'index/'</span>,views.index,name=<span class="string">'index'</span>),                      <span class="comment"># /index_hemo_info</span></span><br><span class="line">    path(<span class="string">'home/(\d+)'</span>,views.home,name=<span class="string">'home'</span>),                    <span class="comment"># /index_hemo_info/2</span></span><br><span class="line">    path(<span class="string">'blog/(\d+)/(\d+)'</span>,views.blog,name=<span class="string">'blog'</span>),              <span class="comment"># /index_hemo_info/2/6</span></span><br><span class="line">    path(<span class="string">'bbs/(?P&lt;uid&gt;\d+)/(?P&lt;pid&gt;\d+)'</span>,views.bbs,name=<span class="string">'bbs'</span>),   <span class="comment"># /index_hemo_info/2/6</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<ul>
<li>在视图中引用 URL，<code>views.py</code>。</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> reverse</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(reeuest)</span>:</span></span><br><span class="line">    string = reverse(<span class="string">'index'</span>)</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(string)                             <span class="comment"># /index_hemo_info</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">home</span><span class="params">(reeuest,uid)</span>:</span></span><br><span class="line">    string = reverse(<span class="string">'home'</span>,args=(uid,))</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(string)                             <span class="comment"># /index_hemo_info/2</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">blog</span><span class="params">(reeuest,uid,pid)</span>:</span></span><br><span class="line">    string = reverse(<span class="string">'blog'</span>,args=(uid,pid))</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(string)                             <span class="comment"># /index_hemo_info/2/6</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bbs</span><span class="params">(reeuest,uid,pid)</span>:</span></span><br><span class="line">    string = reverse(<span class="string">'bbs'</span>,kwargs=&#123;<span class="string">'uid'</span>:uid,<span class="string">'pid'</span>:pid&#125;)</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(string)                             <span class="comment"># /index_hemo_info/2/6</span></span><br></pre></td></tr></table></figure>
<h2 id="路由方案"><a href="#路由方案" class="headerlink" title="路由方案"></a>路由方案</h2><p>需求：访问一个页面（管理页面），这个页面列出所有的用户名，点击用户名跳转新的网页（详细信息页），在新的网页内显示用户的详细信息。</p>
<h3 id="方案1"><a href="#方案1" class="headerlink" title="方案1"></a>方案1</h3><p>采用 URL 传递查询参数来实现页面的查找，由后端根据 URL 的查询字符串动态的生成页面。</p>
<ul>
<li>urls.py</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'admin/'</span>, admin.site.urls),</span><br><span class="line">    path(<span class="string">'index/'</span>,views.index),      <span class="comment"># 管理页面，由视图函数 index 处理。</span></span><br><span class="line">    path(<span class="string">'detail/'</span>,views.detail),    <span class="comment"># 详细信息页面，匹配例如：http://127.0.0.1/detail/?nid=2，由视图函数 detail 处理。</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<ul>
<li>views.py</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render, HttpResponse, redirect</span><br><span class="line"></span><br><span class="line">USERDICT = &#123;</span><br><span class="line">    <span class="string">'1'</span>:&#123;<span class="string">'name'</span>:<span class="string">'root1'</span>,<span class="string">'email'</span>:<span class="string">'root1@live.com'</span>&#125;,</span><br><span class="line">    <span class="string">'2'</span>:&#123;<span class="string">'name'</span>:<span class="string">'root2'</span>,<span class="string">'email'</span>:<span class="string">'root2@live.com'</span>&#125;,</span><br><span class="line">    <span class="string">'3'</span>:&#123;<span class="string">'name'</span>:<span class="string">'root3'</span>,<span class="string">'email'</span>:<span class="string">'root3@live.com'</span>&#125;,</span><br><span class="line">    <span class="string">'4'</span>:&#123;<span class="string">'name'</span>:<span class="string">'root4'</span>,<span class="string">'email'</span>:<span class="string">'root4@live.com'</span>&#125;,</span><br><span class="line">    <span class="string">'5'</span>:&#123;<span class="string">'name'</span>:<span class="string">'root5'</span>,<span class="string">'email'</span>:<span class="string">'root5@live.com'</span>&#125;,</span><br><span class="line">    <span class="string">'6'</span>:&#123;<span class="string">'name'</span>:<span class="string">'root6'</span>,<span class="string">'email'</span>:<span class="string">'root6@live.com'</span>&#125;,</span><br><span class="line">    <span class="string">'7'</span>:&#123;<span class="string">'name'</span>:<span class="string">'root7'</span>,<span class="string">'email'</span>:<span class="string">'root7@live.com'</span>&#125;,</span><br><span class="line">&#125;    <span class="comment"># 这些信息可以来自数据库</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'index.html'</span>, &#123;<span class="string">'userdict'</span>:USERDICT&#125;)      <span class="comment"># 将 USERDICT 传递给模板渲染，返回 index.html 页面</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">detail</span><span class="params">(request)</span>:</span>                <span class="comment"># 匹配到来自 index.html &lt;a&gt; 标签的请求。</span></span><br><span class="line">    nid = request.GET.get(<span class="string">'nid'</span>)    <span class="comment"># 从 GET 方法中获得 URL 地址的字符串查询部分</span></span><br><span class="line">    detail_info = USERDICT[nid]     <span class="comment"># 以 nid 为 key 获得用户的详细信息字典</span></span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">'detail.html'</span>,&#123;<span class="string">'userinfo'</span>:detail_info&#125;)    <span class="comment"># 将包含用户详细信息的字典 渲染到 detail.html 文件中，返回给用户</span></span><br></pre></td></tr></table></figure>
<ul>
<li>index.html</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">&#123;% for k,v in userdict.items %&#125;                                             <span class="comment">&lt;!--遍历 USERDICT 字典--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">target</span>=<span class="string">"_blank"</span> <span class="attr">href</span>=<span class="string">"/detail/?nid=&#123;&#123; k &#125;&#125;"</span>&gt;</span> &#123;&#123; v.name &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span>    <span class="comment">&lt;!--用字典的 key 为 &lt;a&gt; 标签拼接查询参数，&lt;a&gt; 标签内容为字典值--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>dateil.html</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>详细信息<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h6</span>&gt;</span>用户名：&#123;&#123; userinfo.name &#125;&#125;<span class="tag">&lt;/<span class="name">h6</span>&gt;</span>    # 从 视图函数 detail 传递过来的字典中取得 name 渲染到 <span class="tag">&lt;<span class="name">h6</span>&gt;</span> 标签</span><br><span class="line">    <span class="tag">&lt;<span class="name">h6</span>&gt;</span>邮箱：&#123;&#123; userinfo.email &#125;&#125;<span class="tag">&lt;/<span class="name">h6</span>&gt;</span>     # 从 视图函数 detail 传递过来的字典中取得 email 渲染到 <span class="tag">&lt;<span class="name">h6</span>&gt;</span> 标签</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="方案2"><a href="#方案2" class="headerlink" title="方案2"></a>方案2</h3><p>这个方案可以优化搜索引擎的收录效果，因为URL地址没有查询部分<code>?</code>，访问的 URL 地址变为：<code>http://127.0.0.1:8000/detail-1.html</code> 这样类似的格式。</p>
<ul>
<li>urls.py</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'admin/'</span>, admin.site.urls),</span><br><span class="line">    path(<span class="string">'index/'</span>,views.index),                      <span class="comment"># 管理页面，由视图函数 index 处理。</span></span><br><span class="line">    path(<span class="string">'detail-&lt;int:nid&gt;.html'</span>,views.detail),      <span class="comment"># 详细信息页面，匹配例如：detail-1.html、detail-2.html，由视图函数 detail 处理。</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<ul>
<li>views.py</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render, HttpResponse, redirect</span><br><span class="line"></span><br><span class="line">USERDICT = &#123;</span><br><span class="line">    <span class="string">'1'</span>:&#123;<span class="string">'name'</span>:<span class="string">'root1'</span>,<span class="string">'email'</span>:<span class="string">'root1@live.com'</span>&#125;,</span><br><span class="line">    <span class="string">'2'</span>:&#123;<span class="string">'name'</span>:<span class="string">'root2'</span>,<span class="string">'email'</span>:<span class="string">'root2@live.com'</span>&#125;,</span><br><span class="line">    <span class="string">'3'</span>:&#123;<span class="string">'name'</span>:<span class="string">'root3'</span>,<span class="string">'email'</span>:<span class="string">'root3@live.com'</span>&#125;,</span><br><span class="line">    <span class="string">'4'</span>:&#123;<span class="string">'name'</span>:<span class="string">'root4'</span>,<span class="string">'email'</span>:<span class="string">'root4@live.com'</span>&#125;,</span><br><span class="line">    <span class="string">'5'</span>:&#123;<span class="string">'name'</span>:<span class="string">'root5'</span>,<span class="string">'email'</span>:<span class="string">'root5@live.com'</span>&#125;,</span><br><span class="line">    <span class="string">'6'</span>:&#123;<span class="string">'name'</span>:<span class="string">'root6'</span>,<span class="string">'email'</span>:<span class="string">'root6@live.com'</span>&#125;,</span><br><span class="line">    <span class="string">'7'</span>:&#123;<span class="string">'name'</span>:<span class="string">'root7'</span>,<span class="string">'email'</span>:<span class="string">'root7@live.com'</span>&#125;,</span><br><span class="line">&#125;    <span class="comment"># 这些信息可以来自数据库</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'index.html'</span>, &#123;<span class="string">'userdict'</span>:USERDICT&#125;)    <span class="comment"># 将 USERDICT 传递给模板渲染，返回 index.html 页面</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">detail</span><span class="params">(request,nid)</span>:</span>                                           <span class="comment"># 匹配到来自 index.html &lt;a&gt; 标签的请求，得到了链接中的值，也就是字典的 key</span></span><br><span class="line">    detail_info = USERDICT[str(nid)]                               <span class="comment"># 从字典取出 key 的值，也就是详细信息</span></span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">'detail.html'</span>,&#123;<span class="string">'userinfo'</span>:detail_info&#125;)  <span class="comment"># 返回时候由这个字典渲染详细信息页面 detail.html，从而返回详细信息。</span></span><br></pre></td></tr></table></figure>
<ul>
<li>index.html</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">&#123;% for k,v in userdict.items %&#125;    <span class="comment">&lt;!--遍历 USERDICT 字典--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">target</span>=<span class="string">"_blank"</span> <span class="attr">href</span>=<span class="string">"/detail-&#123;&#123; k &#125;&#125;.html"</span>&gt;</span> &#123;&#123; v.name &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span>    <span class="comment">&lt;!--用字典的 key 为 &lt;a&gt; 标签拼接链接地址，&lt;a&gt; 标签内容为字典值--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>detail.html</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>详细信息<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h6</span>&gt;</span>用户名：&#123;&#123; userinfo.name &#125;&#125;<span class="tag">&lt;/<span class="name">h6</span>&gt;</span>    # 从 视图函数 detail 传递过来的字典中取得 name 渲染到 <span class="tag">&lt;<span class="name">h6</span>&gt;</span> 标签</span><br><span class="line">    <span class="tag">&lt;<span class="name">h6</span>&gt;</span>邮箱：&#123;&#123; userinfo.email &#125;&#125;<span class="tag">&lt;/<span class="name">h6</span>&gt;</span>    # 从 视图函数 detail 传递过来的字典中取得 email 渲染到 <span class="tag">&lt;<span class="name">h6</span>&gt;</span> 标签</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="模型管理"><a href="#模型管理" class="headerlink" title="模型管理"></a>模型管理</h1><p>ORM 即 关系对象映射 ( Object Relational Mapping)，把面向对象中的类和数据库表一一对应，通过操作类和对象，对数据表实现数据操作，不需要写SQL语句，由ORM框架生成。</p>
<h2 id="数据库配置"><a href="#数据库配置" class="headerlink" title="数据库配置"></a>数据库配置</h2><h3 id="连接My-SQL"><a href="#连接My-SQL" class="headerlink" title="连接My-SQL"></a>连接My-SQL</h3><ul>
<li>编辑项目目录下的 <code>settings.py</code> 文件，修改数据库的配置</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="string">'default'</span>: &#123;</span><br><span class="line">        <span class="string">'ENGINE'</span>: <span class="string">'django.db.backends.mysql'</span>,</span><br><span class="line">        <span class="string">'NAME'</span>: <span class="string">'dbname'</span>,</span><br><span class="line">        <span class="string">'USER'</span>: <span class="string">'root'</span>,</span><br><span class="line">        <span class="string">'PASSWORD'</span>: <span class="string">'root'</span>,</span><br><span class="line">        <span class="string">'HOST'</span>: <span class="string">'127.0.0.1'</span>,</span><br><span class="line">        <span class="string">'PORT'</span>: <span class="string">'3306'</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="更换驱动"><a href="#更换驱动" class="headerlink" title="更换驱动"></a>更换驱动</h3><ul>
<li>更换数据库驱动，在项目目录下修改 <code>__init__.py</code> 增加下面代码。</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line">pymysql.install_as_MySQLdb()</span><br></pre></td></tr></table></figure>
<h3 id="日志配置"><a href="#日志配置" class="headerlink" title="日志配置"></a>日志配置</h3><ul>
<li>可以输出 Django 最后生成的 SQL 语句，方便调试，编辑项目目录下的 <code>settings.py</code> 文件，增加如下配置。</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">LOGGING = &#123;</span><br><span class="line">    <span class="string">'version'</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">'disable_existing_loggers'</span>: <span class="literal">False</span>,</span><br><span class="line">    <span class="string">'handlers'</span>: &#123;</span><br><span class="line">        <span class="string">'console'</span>: &#123;</span><br><span class="line">            <span class="string">'level'</span>: <span class="string">'DEBUG'</span>,</span><br><span class="line">            <span class="string">'class'</span>: <span class="string">'logging.StreamHandler'</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">'loggers'</span>: &#123;</span><br><span class="line">        <span class="string">'django.db.backends'</span>:&#123;</span><br><span class="line">            <span class="string">'handlers'</span>: [<span class="string">'console'</span>],</span><br><span class="line">            <span class="string">'propagate'</span>: <span class="literal">True</span>,</span><br><span class="line">            <span class="string">'level'</span>: <span class="string">'DEBUG'</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="添加应用配置"><a href="#添加应用配置" class="headerlink" title="添加应用配置"></a>添加应用配置</h3><p>让工程 <code>manage.py</code> 管理应用，生成 SQL 语句，需要添加应用的相关配置信息到工程配置文件中，应用的配置类在应用目录下的 <code>apps.py</code> 中，所以它的引用方式就是：<code>应用名称.apps.配置信息类</code> 例如：<code>app1.apps.App1Config</code>。</p>
<ul>
<li>编辑工程的配置文件 <code>settings.py</code> 中的 <code>INSTALLED_APPS</code> 配置段，在尾部将应用的配置信息，像下面一样。</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">'django.contrib.admin'</span>,</span><br><span class="line">    <span class="string">'django.contrib.auth'</span>,</span><br><span class="line">    <span class="string">'django.contrib.contenttypes'</span>,</span><br><span class="line">    <span class="string">'django.contrib.sessions'</span>,</span><br><span class="line">    <span class="string">'django.contrib.messages'</span>,</span><br><span class="line">    <span class="string">'django.contrib.staticfiles'</span>,</span><br><span class="line">    <span class="string">'app01.apps.App01Config'</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h2 id="定义模型"><a href="#定义模型" class="headerlink" title="定义模型"></a>定义模型</h2><p>在 ORM 中，一个类表示代表一个表（必须继承自 <code>models.Model</code>），类的属性即表的字段，表的字段由模型类（<code>Field</code> ）来定义，每个 <code>Field</code> 类可能需要一些参数来定义其字段数据特性，具体见下面：数据类型的介绍。</p>
<p>默认情况下，Django 会自动创建一个自增ID字段作为主键使用，所以下面虽然没有声明ID字段，但是数据库却又有这个字段。</p>
<h3 id="表类定义"><a href="#表类定义" class="headerlink" title="表类定义"></a>表类定义</h3><ul>
<li>编辑 <code>polls/models.py</code> 文件。</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">20</span>)</span><br><span class="line">    age = models.IntegerField()</span><br><span class="line">    gender = models.CharField(max_length=<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    mark = models.CharField(max_length=<span class="number">20</span>)</span><br><span class="line">    price = models.IntegerField()</span><br><span class="line">    owner = models.ForeignKey(<span class="string">"Person"</span>, on_delete=models.CASCADE)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; desc app01_person;</span><br><span class="line">+--------+-------------+------+-----+---------+----------------+</span><br><span class="line">| Field  | Type        | Null | Key | Default | Extra          |</span><br><span class="line">+--------+-------------+------+-----+---------+----------------+</span><br><span class="line">| id     | int(11)     | NO   | PRI | NULL    | auto_increment |</span><br><span class="line">| name   | varchar(20) | NO   |     | NULL    |                |</span><br><span class="line">| age    | int(11)     | NO   |     | NULL    |                |</span><br><span class="line">| gender | varchar(3)  | NO   |     | NULL    |                |</span><br><span class="line">+--------+-------------+------+-----+---------+----------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; desc app01_car;</span><br><span class="line">+----------+-------------+------+-----+---------+----------------+</span><br><span class="line">| Field    | Type        | Null | Key | Default | Extra          |</span><br><span class="line">+----------+-------------+------+-----+---------+----------------+</span><br><span class="line">| id       | int(11)     | NO   | PRI | NULL    | auto_increment |</span><br><span class="line">| mark     | varchar(20) | NO   |     | NULL    |                |</span><br><span class="line">| price    | int(11)     | NO   |     | NULL    |                |</span><br><span class="line">| owner_id | int(11)     | NO   | MUL | NULL    |                |</span><br><span class="line">+----------+-------------+------+-----+---------+----------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h3 id="数据生成"><a href="#数据生成" class="headerlink" title="数据生成"></a>数据生成</h3><ul>
<li>迁徙前检查</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">python manage.py makemigrations         <span class="comment"># 执行检查数据库差异，生成中间文件，到 migrations\ 中</span></span><br></pre></td></tr></table></figure>
<ul>
<li>写入数据库</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">python manage.py migrate                <span class="comment"># 检查 INSTALLED_APPS 设置，为其中的每个应用创建需要的数据表</span></span><br><span class="line">python manage.py migrate app01 --fake   <span class="comment"># 有时候可能出现错误不能写入数据库</span></span><br></pre></td></tr></table></figure>
<ul>
<li>查看SQL语句</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">python manage.py sqlmigrate polls <span class="number">0001</span>    <span class="comment"># 查看生成的 SQL 语句文件内容</span></span><br></pre></td></tr></table></figure>
<ul>
<li>在修改模型后，数据库的数据与模型不一致时候，此时进行迁徙检查会提示如下，因为新增的字段没有默认值，需要手动填入，或者在模型定义默认值。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">(Project) C:\Users\LENOVO\Desktop\我的项目\ORM&gt;python manage.py makemigrations</span><br><span class="line">You are trying to add a non-nullable field <span class="string">'author'</span> to book without a default; we can<span class="string">'t do that (the database needs something to populate existing rows).</span></span><br><span class="line"><span class="string">Please select a fix:</span></span><br><span class="line"><span class="string"> 1) Provide a one-off default now (will be set on all existing rows with a null value for this column)</span></span><br><span class="line"><span class="string"> 2) Quit, and let me add a default in models.py</span></span><br><span class="line"><span class="string">Select an option: 1</span></span><br></pre></td></tr></table></figure>
<h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><p><code>Django</code> 对数据类型在程序层面进行了封装，它的字段类型关联了 Django 一些处理逻辑，虽然不可能超出数据库本身的存储类型范围，但是 Django 在处理这些类型的时候，可能会根据不同类型，进行不同的约束，例如：同样是存字符串，但是类型为 Email 的字段会在输入的时候进行一些验证。</p>
<h3 id="数值型"><a href="#数值型" class="headerlink" title="数值型"></a>数值型</h3><table>
<thead>
<tr>
<th>类型</th>
<th>SQL</th>
<th>有符号</th>
<th>无符号</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>BooleanField</code></td>
<td><code>tinyint(1)</code></td>
<td>不支持</td>
<td><code>0 ~ 1</code></td>
</tr>
<tr>
<td><code>NullBooleanField</code></td>
<td><code>tinyint(1)</code></td>
<td>不支持</td>
<td><code>0 ~ 1</code></td>
</tr>
<tr>
<td><code>SmallIntegerField</code></td>
<td><code>smallint(6)</code>  即原生 <code>SMALLINT</code></td>
<td><code>-32768 ~ 32767</code></td>
<td><code>0 ~ 65535</code></td>
</tr>
<tr>
<td><code>IntegerField</code></td>
<td><code>int(11)</code> 即原生  <code>INT</code></td>
<td><code>-2147483648 ~ 2147483647</code></td>
<td><code>0 ~ 4294967295</code></td>
</tr>
<tr>
<td><code>BigIntegerField</code></td>
<td><code>bigint(20)</code>  即原生 <code>BIGINT</code></td>
<td><code>-9223372036854775808 ~ 9223372036854775807</code></td>
<td><code>0 ~ 18446744073709551645</code></td>
</tr>
<tr>
<td><code>PositiveIntegerField</code></td>
<td><code>int(10) unsigned</code></td>
<td>不支持</td>
<td><code>0 ~ 2147483647</code></td>
</tr>
<tr>
<td><code>PositiveSmallIntegerField</code></td>
<td><code>smallint(5) unsigned</code></td>
<td>不支持</td>
<td><code>0 ~ 32767</code></td>
</tr>
<tr>
<td><code>FloatField</code></td>
<td><code>double</code>  即原生 <code>double</code></td>
<td><code>-1.7976931348623157E+308 ~ -2.2250738585072014E-308</code> <code>0</code> <code>2.2250738585072014E-308 ~ 1.7976931348623157E+308</code></td>
<td><code>0</code> <code>2.2250738585072014E-308 ~ 1.7976931348623157E+308</code></td>
</tr>
<tr>
<td><code>DecimalField</code></td>
<td><code>decimal(20,10)</code></td>
<td>依赖M和D的值</td>
<td>依赖M和D的值</td>
</tr>
<tr>
<td><code>AutoField</code></td>
<td><code>int(11)</code></td>
<td>不支持</td>
<td><code>1 ~ 4294967295</code></td>
</tr>
<tr>
<td><code>BigAutoField</code></td>
<td><code>BIGINT</code></td>
<td>不支持</td>
<td><code>1 ~ 9223372036854775807</code></td>
</tr>
</tbody>
</table>
<ul>
<li>科学计数法直观体现是多少？</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; print(&apos;&#123;:.5f&#125;&apos;.format(-1.7976931348623157E+308))</span><br><span class="line">-179769313486231570814527423731704356798070567525844996598917476803157260780028538760589558632766878171540458953514382464234321326889464182768467546703537516986049910576551282076245490090389328944075868508455133942304583236903222948165808559332123348274797826204144723168738177180919299881250404026184124858368.00000</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; print(&apos;&#123;:.5f&#125;&apos;.format(-2.2250738585072014E-308))</span><br><span class="line">-0.00000</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; print(&apos;&#123;:.5f&#125;&apos;.format(2.2250738585072014E-308))</span><br><span class="line">0.00000</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; print(&apos;&#123;:.5f&#125;&apos;.format(1.7976931348623157E+308))</span><br><span class="line">179769313486231570814527423731704356798070567525844996598917476803157260780028538760589558632766878171540458953514382464234321326889464182768467546703537516986049910576551282076245490090389328944075868508455133942304583236903222948165808559332123348274797826204144723168738177180919299881250404026184124858368.00000</span><br></pre></td></tr></table></figure>
<ul>
<li>到数据库究竟是多少？</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Float_test</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    BooleanField = models.BooleanField()</span><br><span class="line">    NullBooleanField = models.NullBooleanField()</span><br><span class="line">    IntegerField = models.IntegerField()</span><br><span class="line">    BigIntegerField = models.BigIntegerField()</span><br><span class="line">    SmallIntegerField = models.SmallIntegerField()</span><br><span class="line">    PositiveIntegerField = models.PositiveIntegerField()</span><br><span class="line">    PositiveSmallIntegerField = models.PositiveSmallIntegerField()</span><br><span class="line">    FloatField = models.FloatField()</span><br><span class="line">    DecimalField = models.DecimalField(max_digits=<span class="number">20</span>, decimal_places=<span class="number">10</span>)</span><br><span class="line">    <span class="comment"># AutoField = models.AutoField()</span></span><br><span class="line">    <span class="comment"># BigAutoField = models.BigAutoField()</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; desc app1_float_test;</span><br><span class="line">+---------------------------+----------------------+------+-----+---------+----------------+</span><br><span class="line">| Field                     | Type                 | Null | Key | Default | Extra          |</span><br><span class="line">+---------------------------+----------------------+------+-----+---------+----------------+</span><br><span class="line">| id                        | int(11)              | NO   | PRI | NULL    | auto_increment |</span><br><span class="line">| BooleanField              | tinyint(1)           | NO   |     | NULL    |                |</span><br><span class="line">| NullBooleanField          | tinyint(1)           | YES  |     | NULL    |                |</span><br><span class="line">| IntegerField              | int(11)              | NO   |     | NULL    |                |</span><br><span class="line">| BigIntegerField           | bigint(20)           | NO   |     | NULL    |                |</span><br><span class="line">| SmallIntegerField         | smallint(6)          | NO   |     | NULL    |                |</span><br><span class="line">| PositiveIntegerField      | int(10) unsigned     | NO   |     | NULL    |                |</span><br><span class="line">| PositiveSmallIntegerField | smallint(5) unsigned | NO   |     | NULL    |                |</span><br><span class="line">| FloatField                | double               | NO   |     | NULL    |                |</span><br><span class="line">| DecimalField              | decimal(20,10)       | NO   |     | NULL    |                |</span><br><span class="line">+---------------------------+----------------------+------+-----+---------+----------------+</span><br></pre></td></tr></table></figure>
<h3 id="字符串类型"><a href="#字符串类型" class="headerlink" title="字符串类型"></a>字符串类型</h3><table>
<thead>
<tr>
<th>类型</th>
<th>SQL</th>
<th>范围</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>CharField</code></td>
<td><code>varchar(&lt;length&gt;)</code></td>
<td>由 <code>length</code> 决定</td>
</tr>
<tr>
<td><code>TextField</code></td>
<td><code>longtext</code></td>
<td><code>0~4294967295字节</code></td>
</tr>
<tr>
<td><code>URLField</code></td>
<td><code>varchar(200)</code></td>
<td></td>
</tr>
<tr>
<td><code>UUIDField</code></td>
<td><code>char(32)</code></td>
<td></td>
</tr>
<tr>
<td><code>SlugField</code></td>
<td><code>varchar(50) MUL</code></td>
<td></td>
</tr>
<tr>
<td><code>BinaryField</code></td>
<td><code>longblob</code></td>
<td><code>0~4294967295字节</code></td>
</tr>
</tbody>
</table>
<ul>
<li>到数据库究竟是多少？</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Char_test</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    CharField = models.CharField(max_length=<span class="number">20</span>)</span><br><span class="line">    TextField = models.TextField()</span><br><span class="line">    URLField = models.URLField()</span><br><span class="line">    UUIDField = models.UUIDField()</span><br><span class="line">    SlugField = models.SlugField()</span><br><span class="line">    FilePathField = models.FilePathField()</span><br><span class="line">    EmailField = models.EmailField()</span><br><span class="line">    GenericIPAddressField = models.GenericIPAddressField()</span><br><span class="line">    FileField = models.FileField()</span><br><span class="line">    ImageField = models.ImageField()</span><br><span class="line">    BinaryField = models.BinaryField()</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; desc app1_char_test;</span><br><span class="line">+-----------------------+--------------+------+-----+---------+----------------+</span><br><span class="line">| Field                 | Type         | Null | Key | Default | Extra          |</span><br><span class="line">+-----------------------+--------------+------+-----+---------+----------------+</span><br><span class="line">| id                    | int(11)      | NO   | PRI | NULL    | auto_increment |</span><br><span class="line">| CharField             | varchar(20)  | NO   |     | NULL    |                |</span><br><span class="line">| TextField             | longtext     | NO   |     | NULL    |                |</span><br><span class="line">| URLField              | varchar(200) | NO   |     | NULL    |                |</span><br><span class="line">| UUIDField             | char(32)     | NO   |     | NULL    |                |</span><br><span class="line">| SlugField             | varchar(50)  | NO   | MUL | NULL    |                |</span><br><span class="line">| FilePathField         | varchar(100) | NO   |     | NULL    |                |</span><br><span class="line">| EmailField            | varchar(254) | NO   |     | NULL    |                |</span><br><span class="line">| GenericIPAddressField | char(39)     | NO   |     | NULL    |                |</span><br><span class="line">| FileField             | varchar(100) | NO   |     | NULL    |                |</span><br><span class="line">| ImageField            | varchar(100) | NO   |     | NULL    |                |</span><br><span class="line">| BinaryField           | longblob     | NO   |     | NULL    |                |</span><br><span class="line">+-----------------------+--------------+------+-----+---------+----------------+</span><br></pre></td></tr></table></figure>
<h3 id="时间日期型"><a href="#时间日期型" class="headerlink" title="时间日期型"></a>时间日期型</h3><table>
<thead>
<tr>
<th>类型</th>
<th>SQL</th>
<th>范围</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>DateField</code></td>
<td><code>date</code> 即原生<code>date</code></td>
<td><code>YY-MM-DD</code></td>
</tr>
<tr>
<td><code>TimeField</code></td>
<td><code>time(6)</code></td>
<td><code>HH:MM:SS</code></td>
</tr>
<tr>
<td><code>DateTimeField</code></td>
<td><code>datetime(6)</code></td>
<td><code>YYYY-MM-DD HH:MM:SS</code></td>
</tr>
</tbody>
</table>
<ul>
<li>到数据库究竟是什么样？</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; desc app1_data_test;</span><br><span class="line">+---------------+-------------+------+-----+---------+----------------+</span><br><span class="line">| Field         | Type        | Null | Key | Default | Extra          |</span><br><span class="line">+---------------+-------------+------+-----+---------+----------------+</span><br><span class="line">| id            | int(11)     | NO   | PRI | NULL    | auto_increment |</span><br><span class="line">| DateField     | date        | NO   |     | NULL    |                |</span><br><span class="line">| TimeField     | time(6)     | NO   |     | NULL    |                |</span><br><span class="line">| DateTimeField | datetime(6) | NO   |     | NULL    |                |</span><br><span class="line">+---------------+-------------+------+-----+---------+----------------+</span><br></pre></td></tr></table></figure>
<h3 id="字段约束"><a href="#字段约束" class="headerlink" title="字段约束"></a>字段约束</h3><table>
<thead>
<tr>
<th>约束</th>
<th>SQL</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>null=True</code></td>
<td>空约束</td>
<td>为 <code>True</code> 时，Django 将在数据库中将空值存储为 NULL，默认为 <code>False</code>。</td>
</tr>
<tr>
<td><code>db_column</code></td>
<td>字段名称</td>
<td>这个字段在数据库中的名字。如果没有设置这个参数，那么将会使用模型中属性的名字。</td>
</tr>
<tr>
<td><code>db_index</code></td>
<td>索引</td>
<td>标识这个字段是否为索引字段。</td>
</tr>
<tr>
<td><code>primary_key</code></td>
<td>主键</td>
<td>是否为主键，与AutoField/BigAutoField连用，默认是False。</td>
</tr>
<tr>
<td><code>unique</code></td>
<td>唯一键</td>
<td>在表中这个字段的值是否唯一，在数据库中就是唯一约束，一般是设置手机号码/邮箱等。</td>
</tr>
<tr>
<td><code>default</code></td>
<td>默认值</td>
<td>默认值，可以为一个值，或者是一个函数（函数名不加括号），但不支持lambda表达式。</td>
</tr>
<tr>
<td><code>max_length</code></td>
<td>长度</td>
<td>最大的长度，单位：字符，表示能存多少个字。</td>
</tr>
</tbody>
</table>
<h3 id="关系映射"><a href="#关系映射" class="headerlink" title="关系映射"></a>关系映射</h3><table>
<thead>
<tr>
<th>名称</th>
<th>作用</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ForeignKey</code></td>
<td>外键，与另外一张表的主键字段建立关系</td>
<td></td>
</tr>
<tr>
<td><code>ManyToManyField</code></td>
<td>多对多</td>
<td></td>
</tr>
<tr>
<td><code>OneToOneField</code></td>
<td>一对一</td>
</tr>
</tbody>
</table>
<ul>
<li>一对多映射</li>
</ul>
<p>一对多的外键应该建立外键记录多的一方，例如：一个人可以拥有多辆汽车，一个汽车的登记只能属于一个人，所以因该在汽车表中新建外键指向人员表的ID。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">20</span>)</span><br><span class="line">    age = models.IntegerField()</span><br><span class="line">    gender = models.CharField(max_length=<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    mark = models.CharField(max_length=<span class="number">20</span>)</span><br><span class="line">    price = models.IntegerField()</span><br><span class="line">    owner = models.ForeignKey(<span class="string">"Person"</span>, on_delete=models.CASCADE)</span><br></pre></td></tr></table></figure>
<ul>
<li><code>models.ForeignKey(&quot;Person&quot;, on_delete=models.CASCADE)</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">其中 &quot;Person&quot; 可以不加引号，表示外键到 Person 类的主键，但是如果不加引号，就必须将 Person类 的定义放在前面声明</span><br></pre></td></tr></table></figure>
<h2 id="数据操作"><a href="#数据操作" class="headerlink" title="数据操作"></a>数据操作</h2><h3 id="导入模型"><a href="#导入模型" class="headerlink" title="导入模型"></a>导入模型</h3><p>在视图函数内使用模型进行数据库操作，需要首先导入模型，语句格式为：<code>应用.models</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> app1.models <span class="keyword">import</span> *</span><br></pre></td></tr></table></figure>
<h3 id="添加记录"><a href="#添加记录" class="headerlink" title="添加记录"></a>添加记录</h3><ul>
<li>方式1，调用模型初始化实例，调用实例的 <code>save</code> 方法，提交到数据库</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">b = Book(name=<span class="string">"Python基础"</span>,price=<span class="number">99</span>,author=<span class="string">'alex'</span>,pub_date=<span class="string">"2017-12-12"</span>)</span><br><span class="line">b.save()</span><br></pre></td></tr></table></figure>
<ul>
<li>方式2，调用模型的方法，直接在数据库创建记录</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Book.objects.create(name=<span class="string">"Shell编程指南"</span>,price=<span class="number">70</span>,author=<span class="string">'oldboy'</span>,pub_date=<span class="string">"2018-12-12"</span>)</span><br></pre></td></tr></table></figure>
<h3 id="修改记录"><a href="#修改记录" class="headerlink" title="修改记录"></a>修改记录</h3><ul>
<li>方式1</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Book.objects.filter(author=<span class="string">"oldboy"</span>).update(price=<span class="number">999</span>)    <span class="comment"># filter 返回一个 query set 集合对象</span></span><br></pre></td></tr></table></figure>
<ul>
<li>方式2</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">b = Book.objects.get(author=<span class="string">"oldboy"</span>)    <span class="comment"># # get仅取得一条结果</span></span><br><span class="line">b.price=<span class="number">120</span></span><br><span class="line">b.save()</span><br></pre></td></tr></table></figure>
<h3 id="删除记录"><a href="#删除记录" class="headerlink" title="删除记录"></a>删除记录</h3><ul>
<li>方式一</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Book.objects.filter(author=<span class="string">'alex'</span>).delete()</span><br></pre></td></tr></table></figure>
<h2 id="查询API"><a href="#查询API" class="headerlink" title="查询API"></a>查询API</h2><table>
<thead>
<tr>
<th>方法</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>filter(**kwargs)</code></td>
<td>使用关键字，条件，进行过滤查询，返回 <code>QuerySET</code> 集合，集合由查询的每个记录对象组成。</td>
</tr>
<tr>
<td><code>all()</code></td>
<td>取得全部结果的集合，返回 <code>QuerySET</code> 集合。</td>
</tr>
<tr>
<td><code>get(**kwargs)</code></td>
<td>使用关键字，条件，进行过滤查询，但条件的结果只能是一个，返回一条记录的对象。</td>
</tr>
<tr>
<td><code>values(&quot;字段1&quot;,&quot;字段2&quot;,&quot;字段3&quot;)</code></td>
<td>返回一个列表，这个列表中每个元素是一个记录由：所查询的字段的键和值组成的字典。</td>
</tr>
<tr>
<td><code>values_list(&quot;字段1&quot;,&quot;字段2&quot;,&quot;字段3&quot;)</code></td>
<td>返回一个列表，这个列表中每个元素是一个记录由：所查询的字段的值组成的元素。</td>
</tr>
<tr>
<td><code>exclude(**kwargs)</code></td>
<td>排除符合条件的查询</td>
</tr>
<tr>
<td><code>order_by(*field)</code></td>
<td>对查询结果进行排序</td>
</tr>
<tr>
<td><code>reverse()</code></td>
<td>对查询结果进行反向排序</td>
</tr>
<tr>
<td><code>distinct()</code></td>
<td>对查询结果进行去重，不支持按字段</td>
</tr>
<tr>
<td><code>count()</code></td>
<td>统计查询结果对象的数量</td>
</tr>
<tr>
<td><code>first()</code></td>
<td>返回第一条记录对象</td>
</tr>
<tr>
<td><code>last()</code></td>
<td>返回最后一个记录对象</td>
</tr>
<tr>
<td><code>exists()</code></td>
<td>如果 QuerySet 包含数据，就返回True，否则返回False。</td>
</tr>
</tbody>
</table>
<h3 id="结果迭代器"><a href="#结果迭代器" class="headerlink" title="结果迭代器"></a>结果迭代器</h3><p>当 <code>QuerySET</code> 查询结果非常巨大时候， <code>cache</code> 会给内存造成很大压力，<code>QuerySET</code> 还可能锁住系统进程，让程序面临崩溃，要在使用 <code>QuerySET</code> 但不加入缓存的时候，可以使用迭代器的模式，对 <code>QuerySET</code>  使用 <code>iterator()</code> 方法，可以在使用数据才获取数据，处理完数据就丢弃，不再加入缓存。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">objs = Book.object.all().iterator()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> objs:</span><br><span class="line">    print(i)</span><br></pre></td></tr></table></figure>
<p><code>iterator()</code> 方法防止 <code>Django</code> 对查询结果进行缓存，这意味着多是使用同一个 <code>QuerySET</code> 就会造成多次的查询，因为迭代器的原因，所以它只能遍历一次，再次遍历的时候，就会抛出异常。</p>
<h2 id="单表查询"><a href="#单表查询" class="headerlink" title="单表查询"></a>单表查询</h2><ul>
<li>测试模型</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">20</span>)</span><br><span class="line">    price = models.IntegerField()</span><br><span class="line">    pub_date = models.DateField()</span><br><span class="line">    publish = models.ForeignKey(<span class="string">"Publish"</span>,on_delete=models.CASCADE)</span><br><span class="line">    author = models.ManyToManyField(<span class="string">"Author"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Publish</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">     name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">     city = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Author</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    age = models.IntegerField(default=<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<h3 id="filter过滤"><a href="#filter过滤" class="headerlink" title="filter过滤"></a>filter过滤</h3><p><code>filter</code>过滤的条件可以是多个，它的返回结果是一个 Query Set 对象，支持索引，切片。</p>
<ul>
<li>数字比较</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">__gt       <span class="comment"># 大于</span></span><br><span class="line">__gte      <span class="comment"># 大于等于</span></span><br><span class="line">__lt       <span class="comment"># 小于</span></span><br><span class="line">__lte      <span class="comment"># 小于等于</span></span><br><span class="line">__in       <span class="comment"># 在指定的集合内</span></span><br><span class="line">__isnull   <span class="comment"># 为空</span></span><br><span class="line">__range    <span class="comment"># 在范围内</span></span><br></pre></td></tr></table></figure>
<ul>
<li>字符串比较</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">__contains      <span class="comment"># 字段包含指定字符的记录，底层是 LIKE , %关键字%</span></span><br><span class="line">__icontains     <span class="comment"># 不区分大小写的查找包含指定字符的记录</span></span><br><span class="line">__startswith    <span class="comment"># 以指定字符开头的记录</span></span><br><span class="line">__istartswith   <span class="comment"># 不区分大小写的以指定字符开头</span></span><br><span class="line">__endswith      <span class="comment"># 以指定字符结尾的记录</span></span><br><span class="line">__iendswith     <span class="comment"># 不区分大小写以指定字符结尾的记录</span></span><br><span class="line">__exact         <span class="comment"># </span></span><br><span class="line">__iexact        <span class="comment">#</span></span><br><span class="line">__regex         <span class="comment">#</span></span><br><span class="line">__iregex        <span class="comment">#</span></span><br><span class="line">__in            <span class="comment"># 在指定的集合内</span></span><br><span class="line">__isnull        <span class="comment"># 为空</span></span><br><span class="line">__search        <span class="comment">#</span></span><br></pre></td></tr></table></figure>
<h3 id="返回字典"><a href="#返回字典" class="headerlink" title="返回字典"></a>返回字典</h3><p>values 返回一个列表，这个列表中每个元素是一个记录由：所查询的字段的键和值组成的字典。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ret = Book.objects.filter().values(<span class="string">'name'</span>,<span class="string">'price'</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;QuerySet [&#123;<span class="string">'name'</span>: <span class="string">'Python'</span>, <span class="string">'price'</span>: <span class="number">200</span>&#125;, &#123;<span class="string">'name'</span>: <span class="string">'Linux运维'</span>, <span class="string">'price'</span>: <span class="number">77</span>&#125;, &#123;<span class="string">'name'</span>: <span class="string">'Go语言'</span>, <span class="string">'price'</span>: <span class="number">223</span>&#125;, &#123;<span class="string">'name'</span>: <span class="string">'javascript'</span>, <span class="string">'price'</span>: <span class="number">66</span>&#125;]&gt;</span><br></pre></td></tr></table></figure>
<h3 id="仅返回值"><a href="#仅返回值" class="headerlink" title="仅返回值"></a>仅返回值</h3><p>values_list 返回一个列表，这个列表中每个元素是一个记录由：所查询的字段的值组成的元素。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ret = Book.objects.filter().values_list(<span class="string">'name'</span>,<span class="string">'price'</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;QuerySet [(<span class="string">'Python'</span>, <span class="number">200</span>), (<span class="string">'Linux运维'</span>, <span class="number">77</span>), (<span class="string">'Go语言'</span>, <span class="number">223</span>), (<span class="string">'javascript'</span>, <span class="number">66</span>)]&gt;</span><br></pre></td></tr></table></figure>
<h3 id="排除查询"><a href="#排除查询" class="headerlink" title="排除查询"></a>排除查询</h3><p><code>exclude</code> 过滤符合条件的查询。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ret = Book.objects.exclude(name=<span class="string">"Python"</span>).values(<span class="string">'name'</span>,<span class="string">'price'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="结果去重"><a href="#结果去重" class="headerlink" title="结果去重"></a>结果去重</h3><p>只能适用于结果由重复的时候，所以适用于 values。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ret = Book.object.all().values().dictinct()</span><br></pre></td></tr></table></figure>
<h3 id="结果计数"><a href="#结果计数" class="headerlink" title="结果计数"></a>结果计数</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ret = Book.objects.filter().count()</span><br></pre></td></tr></table></figure>
<h3 id="指定对象列"><a href="#指定对象列" class="headerlink" title="指定对象列"></a>指定对象列</h3><p>大部分时候，我们可能只需要读取表中某些字段，那么可以用only，它返回一个 QuerySet集合。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Book.objects.filter().only(&apos;name&apos;,&apos;age&apos;)</span><br></pre></td></tr></table></figure>
<h3 id="指定查询数据库"><a href="#指定查询数据库" class="headerlink" title="指定查询数据库"></a>指定查询数据库</h3><ul>
<li>数据库的连接可以是多个</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="string">'default'</span>: &#123;</span><br><span class="line">        <span class="string">'ENGINE'</span>: <span class="string">'django.db.backends.mysql'</span>,</span><br><span class="line">        <span class="string">'NAME'</span>: <span class="string">'demo'</span>,</span><br><span class="line">        <span class="string">'USER'</span>: <span class="string">'root'</span>,</span><br><span class="line">        <span class="string">'PASSWORD'</span>: <span class="string">'123456'</span>,</span><br><span class="line">        <span class="string">'HOST'</span>: <span class="string">'127.0.0.1'</span>,</span><br><span class="line">        <span class="string">'PORT'</span>: <span class="string">'3306'</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="string">'database2'</span>: &#123;</span><br><span class="line">        <span class="string">'ENGINE'</span>: <span class="string">'django.db.backends.mysql'</span>,</span><br><span class="line">        <span class="string">'NAME'</span>: <span class="string">'demo'</span>,</span><br><span class="line">        <span class="string">'USER'</span>: <span class="string">'root'</span>,</span><br><span class="line">        <span class="string">'PASSWORD'</span>: <span class="string">'123456'</span>,</span><br><span class="line">        <span class="string">'HOST'</span>: <span class="string">'127.0.0.1'</span>,</span><br><span class="line">        <span class="string">'PORT'</span>: <span class="string">'3306'</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>查询时，也可以指定数据库连接</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Book.objects.filter().using(<span class="string">'database2'</span>)</span><br></pre></td></tr></table></figure>
<h2 id="一对多关系"><a href="#一对多关系" class="headerlink" title="一对多关系"></a>一对多关系</h2><ul>
<li>测试模型</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">20</span>)</span><br><span class="line">    price = models.IntegerField()</span><br><span class="line">    pub_date = models.DateField()</span><br><span class="line">    publish = models.ForeignKey(<span class="string">"Publish"</span>,on_delete=models.CASCADE)</span><br><span class="line">    author = models.ManyToManyField(<span class="string">"Author"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Publish</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">     name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">     city = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Author</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    age = models.IntegerField(default=<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>   默认情况 Django 会在外键字段的后面增加 <code>id</code> 字样，所以 Book 的 publish 外键字段实际是 publish_id</p>
</blockquote>
<h3 id="一对多创建"><a href="#一对多创建" class="headerlink" title="一对多创建"></a>一对多创建</h3><p>一对多的外键应该建立外键记录多的一方，例如：一个人可以拥有多辆汽车，一个汽车的登记只能属于一个人，所以因该在汽车表中新建外键指向人员表的ID。</p>
<ul>
<li><code>publish</code> 是外键字段，Django 最终创建到数据库的名字是 <code>publish_id</code> ，所以自己为外键命名的时候无需添加 <code>_id</code> 字样了 </li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">publish = models.ForeignKey(<span class="string">"Publish"</span>,on_delete=models.CASCADE)</span><br></pre></td></tr></table></figure>
<p>其中的 <code>&quot;Publish&quot;</code> 可以不加引号，表示外键到 <code>Person</code> 类的主键，但是如果不加引号，就必须将 Person类 的定义放在前面声明。</p>
<h3 id="外键的插入"><a href="#外键的插入" class="headerlink" title="外键的插入"></a>外键的插入</h3><ul>
<li>方法1，直接指明外键字段的值，此处为：<code>publish_id</code>。</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Book.objects.create(name=<span class="string">"Linux运维"</span>,price=<span class="number">77</span>,pub_date=<span class="string">'2017-01-01'</span>,publish_id=<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>方法2，首先找到外键对象，然后将书的外键指向外键对象</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">publish_obj = Publish.objects.filter(name=<span class="string">"北京大学出版社"</span>)[<span class="number">0</span>]</span><br><span class="line">Book.objects.create(name=<span class="string">"Go语言"</span>, price=<span class="number">223</span>, pub_date=<span class="string">'2015-03-11'</span>, publish=publish_obj)</span><br></pre></td></tr></table></figure>
<h3 id="关系查询"><a href="#关系查询" class="headerlink" title="关系查询"></a>关系查询</h3><ul>
<li>首先找到记录对象，再根据外键找到外键表对象，使用外键对象的来获得外键对象的值</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">book_obj = Book.objects.get(name=<span class="string">'Python'</span>)    <span class="comment"># 首先找到该该记录的对象</span></span><br><span class="line">publish_obj = book_obj.publish                <span class="comment"># 然后找到它的外键对象</span></span><br><span class="line">print(publish_obj.name)                       <span class="comment"># 打印出外键对象的名字</span></span><br></pre></td></tr></table></figure>
<ul>
<li>方法1，通过外键对象，找到使用这个外键的记录对象</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">publish_obj = Publish.objects.get(name=<span class="string">'人民出版社'</span>)    <span class="comment"># 首先找到出版社对象</span></span><br><span class="line">books = Book.objects.filter(publish=publish_obj)       <span class="comment"># 然后过滤书中外键属于该出版社的书</span></span><br><span class="line">print(books.all())                                     <span class="comment"># 显示全部的 Book 实例</span></span><br><span class="line">print(books.values())                                  <span class="comment"># 显示全部的 Book 实例的值</span></span><br></pre></td></tr></table></figure>
<ul>
<li>方法2，首先找到外键对象，使用外键对象的 <code>_set</code> 属性找到所有使用这个外键的记录对象</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">publish_obj = Publish.objects.get(name=<span class="string">'人民出版社'</span>)    <span class="comment"># 首先找出出版社对象</span></span><br><span class="line">books = publish_obj.book_set                           <span class="comment"># 使用出版社的方法，找出它所有的 Book 对象</span></span><br><span class="line">print(books.all())                                     <span class="comment"># 显示全部的 Book 实例</span></span><br><span class="line">print(books.values())                                  <span class="comment"># 显示全部的 Book 实例的值</span></span><br></pre></td></tr></table></figure>
<ul>
<li>方法3，使用记录对象的 <code>filter</code> 过滤出记录外键对象名称符合条件的记录对象</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">books = Book.objects.filter(publish__name=<span class="string">"人民出版社"</span>)    <span class="comment"># 在书类中过滤 外键对象名字为 人民出版社的书</span></span><br><span class="line">print(books.all())                                        <span class="comment"># 显示全部的 Book 实例</span></span><br><span class="line">print(books.values())                                     <span class="comment"># 显示全部的 Book 实例的值</span></span><br></pre></td></tr></table></figure>
<ul>
<li>方法4，使用外键表对象的 <code>filter</code> 过滤出与这个外键相关联的表中指定字段的值</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">publish_obj = Publish.objects.filter(book__name=<span class="string">"Python"</span>)    <span class="comment"># 在出版社类中过滤 书名字为 Python 的出版社</span></span><br><span class="line">print(publish_obj.all())</span><br><span class="line">print(publish_obj.values())</span><br></pre></td></tr></table></figure>
<ul>
<li>方法5，首先再外键表中过滤出符合条件的外键记录对象集合，然后使用记录集合的 <code>filter</code> 方法过滤出再外键集合中的记录。</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">publish_obj = Publish.objects.filter(city=<span class="string">'北京'</span>)       <span class="comment"># 首先找到所有的北京出版社 查询集合</span></span><br><span class="line">books = Book.objects.filter(publish__in=publish_obj)    <span class="comment"># 然后找书籍中所有外键字段在 出版社集合中的书籍</span></span><br><span class="line">print(books)</span><br></pre></td></tr></table></figure>
<ul>
<li>方法6，使用记录表对象的 <code>filter</code> 方法的多条件查询得到记录对象集合，然后打印记录对象的外键对象的信息。</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">books = Book.objects.filter(pub_date__lt=<span class="string">'2018-01-01'</span>,pub_date__gt=<span class="string">'2015-01-01'</span>)</span><br><span class="line">print(books.values(<span class="string">"name"</span>))</span><br><span class="line">print(books.values(<span class="string">"publish__name"</span>))</span><br></pre></td></tr></table></figure>
<h2 id="多对多关系"><a href="#多对多关系" class="headerlink" title="多对多关系"></a>多对多关系</h2><ul>
<li>测试模型</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">20</span>)</span><br><span class="line">    price = models.IntegerField()</span><br><span class="line">    pub_date = models.DateField()</span><br><span class="line">    publish = models.ForeignKey(<span class="string">"Publish"</span>,on_delete=models.CASCADE)</span><br><span class="line">    author = models.ManyToManyField(<span class="string">"Author"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Publish</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">     name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">     city = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Author</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    age = models.IntegerField(default=<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">INSERT INTO app01_publish (name,city) VALUES (&apos;北京大学出版社&apos;,&apos;北京&apos;);</span><br><span class="line">INSERT INTO app01_publish (name,city) VALUES (&apos;机械工业出版社&apos;,&apos;天津&apos;);</span><br><span class="line">INSERT INTO app01_publish (name,city) VALUES (&apos;太原理工出版社&apos;,&apos;山西&apos;);</span><br><span class="line">INSERT INTO app01_publish (name,city) VALUES (&apos;图灵社区出版社&apos;,&apos;圣塞尔&apos;);</span><br><span class="line"></span><br><span class="line">INSERT INTO app01_book (name,price,pub_date,publish_id) VALUES (&apos;Linux运维&apos;,99,&apos;2015-05-14&apos;,1);</span><br><span class="line">INSERT INTO app01_book (name,price,pub_date,publish_id) VALUES (&apos;Python程序开发&apos;,200,&apos;2016-01-12&apos;,2);</span><br><span class="line">INSERT INTO app01_book (name,price,pub_date,publish_id) VALUES (&apos;梦的解析&apos;,300,&apos;2010-05-13&apos;,4);</span><br><span class="line">INSERT INTO app01_book (name,price,pub_date,publish_id) VALUES (&apos;论自由&apos;,900,&apos;2000-01-03&apos;,3);</span><br><span class="line">INSERT INTO app01_book (name,price,pub_date,publish_id) VALUES (&apos;一个陌生女人的来信&apos;,300,&apos;2002-12-22&apos;,1);</span><br><span class="line">INSERT INTO app01_book (name,price,pub_date,publish_id) VALUES (&apos;Unix系统编程&apos;,100,&apos;2012-02-02&apos;,1);</span><br><span class="line"></span><br><span class="line">INSERT INTO app01_author (name,age) VALUES (&apos;杨金恒&apos;,29);</span><br><span class="line">INSERT INTO app01_author (name,age) VALUES (&apos;李莹&apos;,25);</span><br><span class="line">INSERT INTO app01_author (name,age) VALUES (&apos;茨威格&apos;,26);</span><br><span class="line">INSERT INTO app01_author (name,age) VALUES (&apos;弗洛伊德&apos;,50);</span><br></pre></td></tr></table></figure>
<h3 id="多对多创建"><a href="#多对多创建" class="headerlink" title="多对多创建"></a>多对多创建</h3><p>两个表的多对多的关系描述需要一个中间关系表，例如：一本书可以有多个作者，而一个作者也可以出多本书。</p>
<ul>
<li>在一个表对象模型中声明一个外键，Django 会 自动创建一个中间表，例如下面的例子会创建：<code>app01_book_author</code>，ManyToManyField 是 Django 识别多对多关系的方式，与数据库无关。</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">author = models.ManyToManyField(<span class="string">"Author"</span>)</span><br></pre></td></tr></table></figure>
<p>“Author” 是需要与之建立多对多关系的表，Django 会自动将两个表的主键作为关系的外键，从SQL语句可以看出这一点，<code>xxx</code> 是我改的便于分析。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">app01_book_author | CREATE TABLE `app01_book_author` (</span><br><span class="line">	`id` INT (11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">	`book_id` INT (11) NOT NULL,</span><br><span class="line">	`author_id` INT (11) NOT NULL,</span><br><span class="line">	PRIMARY KEY (`id`),</span><br><span class="line">	UNIQUE KEY `xxx1` (`book_id`, `author_id`),</span><br><span class="line">	KEY `xxx` (`author_id`),</span><br><span class="line">	CONSTRAINT `xxx2` FOREIGN KEY (`author_id`) REFERENCES `app01_author` (`id`),</span><br><span class="line">	CONSTRAINT `xxx3` FOREIGN KEY (`book_id`) REFERENCES `app01_book` (`id`)</span><br><span class="line">) ENGINE = INNODB AUTO_INCREMENT = 2</span><br></pre></td></tr></table></figure>
<h3 id="关系的创建"><a href="#关系的创建" class="headerlink" title="关系的创建"></a>关系的创建</h3><ul>
<li>添加一个关系，正向</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">books = Book.objects.get(name=<span class="string">"一个陌生女人的来信"</span>)    <span class="comment"># 首先找到一本书</span></span><br><span class="line">authors = Author.objects.get(name=<span class="string">"茨威格"</span>)           <span class="comment"># 然后找到一个作者</span></span><br><span class="line">books.author.add(authors)                            <span class="comment"># 使用书类的方法，为书创建一个作者</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">+----+---------+-----------+</span><br><span class="line">| id | book_id | author_id |</span><br><span class="line">+----+---------+-----------+</span><br><span class="line">|  2 |       7 |         1 |</span><br><span class="line">+----+---------+-----------+</span><br></pre></td></tr></table></figure>
<ul>
<li>添加一个关系，反向</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">authors = Author.objects.get(name=<span class="string">'茨威格'</span>)           <span class="comment"># 首先找到一个作者</span></span><br><span class="line">books = Book.objects.get(name=<span class="string">'一个陌生女人的来信'</span>)    <span class="comment"># 然后找到一本数</span></span><br><span class="line">authors.books_set.add(books)                         <span class="comment"># 调用 xxx_set 的 add 方法为作者增加一本书</span></span><br></pre></td></tr></table></figure>
<ul>
<li>添加多个关系，正向</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Q                                          <span class="comment"># 多条件查询</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line">    books = Book.objects.get(name=<span class="string">"Linux运维"</span>)                          <span class="comment"># 找到一本书</span></span><br><span class="line">    authors = Author.objects.filter(Q(name=<span class="string">"杨金恒"</span>)|Q(name=<span class="string">"李莹"</span>))     <span class="comment"># 找到两个作者 </span></span><br><span class="line">    books.author.add(*authors)                                          <span class="comment"># 为书籍添加多个作者的关系</span></span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">'index.html'</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; select * from app01_book_author;</span><br><span class="line">+----+---------+-----------+</span><br><span class="line">| id | book_id | author_id |</span><br><span class="line">+----+---------+-----------+</span><br><span class="line">|  2 |       7 |         1 |</span><br><span class="line">|  3 |       7 |         5 |</span><br><span class="line">|  1 |      11 |         6 |</span><br><span class="line">+----+---------+-----------+</span><br></pre></td></tr></table></figure>
<ul>
<li>添加多个关系，反向</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line">    authors = Author.objects.filter(name=<span class="string">"杨金恒"</span>)  <span class="comment"># 找到一个作者 </span></span><br><span class="line">    authors.books_set.set([<span class="number">1</span>,<span class="number">2</span>]])    <span class="comment"># xxx_set 的 set 方法会只保留参数内的关系，清除其余关系</span></span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">'index.html'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="关系的删除"><a href="#关系的删除" class="headerlink" title="关系的删除"></a>关系的删除</h3><ul>
<li>删除多个关系</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Q                                          <span class="comment"># 多条件查询</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line">    books = Book.objects.get(name=<span class="string">"Linux运维"</span>)                          <span class="comment"># 找到一本书</span></span><br><span class="line">    authors = Author.objects.filter(Q(name=<span class="string">"杨金恒"</span>)|Q(name=<span class="string">"李莹"</span>))     <span class="comment"># 找到两个作者 </span></span><br><span class="line">    books.author.remove(*authors)                                       <span class="comment"># 为书籍移除多个作者的关系</span></span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">'index.html'</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>按 ID 删除关系</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Q                                          <span class="comment"># 多条件查询</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line">    books = Book.objects.get(name=<span class="string">"Linux运维"</span>)                          <span class="comment"># 找到一本书</span></span><br><span class="line">    books.author.remove(<span class="number">1</span>)                                              <span class="comment"># 删除 关系表中 id 为 1 的关系删除</span></span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">'index.html'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="查询方法"><a href="#查询方法" class="headerlink" title="查询方法"></a>查询方法</h3><ul>
<li>跨表查询</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">obj = Book.objects.filter(author__name=<span class="string">"杨金恒"</span>)        <span class="comment"># 通过 Book 模型下的 author 属性可以得到关系表的信息，使用 filter 过滤后打印</span></span><br><span class="line">print(obj.values(<span class="string">"name"</span>,<span class="string">"price"</span>))</span><br></pre></td></tr></table></figure>
<ul>
<li>跨表查询，正向（类中有多对多哪个属性的）</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">obj = models.Classes.objects.filter(title=<span class="string">"全栈四班"</span>)    <span class="comment"># 首先从正向表中过滤出来一条数据</span></span><br><span class="line">ret = obj.values(<span class="string">'id'</span>,<span class="string">'title'</span>,<span class="string">'m__name'</span>)                <span class="comment"># 然后 通过 m 这个多对多关系表的 m__name 得到所有有关系的名字</span></span><br><span class="line">print(ret)</span><br></pre></td></tr></table></figure>
<ul>
<li>跨表查询，反向（类中没有多对多哪个属性的）</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">obj = models.Teachers.objects.filter(name=<span class="string">"杨金恒"</span>)     <span class="comment"># 首先从反向表中过滤出来一条数据</span></span><br><span class="line">ret = obj.values(<span class="string">'name'</span>,<span class="string">'classes__title'</span>)              <span class="comment"># 然后 通过 m 这个多对多关系表的 classes__title 得到所有有关系的名字</span></span><br><span class="line">print(ret)</span><br></pre></td></tr></table></figure>
<h3 id="自定义多对多"><a href="#自定义多对多" class="headerlink" title="自定义多对多"></a>自定义多对多</h3><ul>
<li>上面的方法是通过 ManyToManyField 实现的，其实还可以通过 自定义模型来实现，这样更方便直接对模型进行操作。</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book_Author</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    book = models.ForeignKey(<span class="string">'Book'</span>,on_delete=models.CASCADE)</span><br><span class="line">    author = models.ForeignKey(<span class="string">'Author'</span>,on_delete=models.CASCADE)</span><br></pre></td></tr></table></figure>
<ul>
<li>多对多关系添加，直接操作关系表</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Book_Author.objects.create(book_id=<span class="number">1</span>,author_id=<span class="number">1</span>)    <span class="comment"># 直接对关系表模型对象进行操作，创建表记录</span></span><br></pre></td></tr></table></figure>
<h3 id="联合唯一"><a href="#联合唯一" class="headerlink" title="联合唯一"></a>联合唯一</h3><p>一般情况，数据库要防止冗余数据的产生，例如：一本数对应一个作者的关系，它只需要描述一次，不需要多次出现，意味着书与作者的对应关系不应该出现重复的数据，所以这需要联合唯一索引，这个约束能够实现两个字段联合起来唯一性，这就不妨碍一本书有多个作者，和一个作者出版多本书籍了。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book_Author</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    book = models.ForeignKey(<span class="string">'Book'</span>,on_delete=models.CASCADE)</span><br><span class="line">    author = models.ForeignKey(<span class="string">'Author'</span>,on_delete=models.CASCADE)</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        <span class="comment"># 数据库中生成的表名称 默认 app名称 + 下划线 + 类名</span></span><br><span class="line">        db_table = <span class="string">"table_name"</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 联合索引</span></span><br><span class="line">        index_together = [</span><br><span class="line">            (<span class="string">"book"</span>, <span class="string">"author"</span>),</span><br><span class="line">        ]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 联合唯一索引</span></span><br><span class="line">        unique_together = ((<span class="string">"driver"</span>, <span class="string">"restaurant"</span>),)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># admin中显示的表名称</span></span><br><span class="line">        verbose_name</span><br><span class="line"></span><br><span class="line">        <span class="comment"># verbose_name加s</span></span><br><span class="line">        verbose_name_plural</span><br></pre></td></tr></table></figure>
<h3 id="查询方法-1"><a href="#查询方法-1" class="headerlink" title="查询方法"></a>查询方法</h3><ul>
<li><code>xxxxxx_set.all()</code> 方法可以得到与该表相关的关系表记录。</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">obj = Book.objects.get(name=<span class="string">"Python程序开发"</span>)                             <span class="comment"># 首先过滤出需要查询的书</span></span><br><span class="line">print(obj.book_author_set.all().values(<span class="string">"book__name"</span>,<span class="string">"author__name"</span>))     <span class="comment"># 在这本书的关系表中所有关系记录中打印出书的名字和作者</span></span><br></pre></td></tr></table></figure>
<ul>
<li>两张表通过一个关系表关联的时候，可以使用 <code>xxxxxx_set.all()</code> 方法得到关系的 <code>QuerySET</code> 对象。</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">obj = Author.objects.get(id=<span class="number">2</span>)</span><br><span class="line">print(obj.book_author_set.all().values(<span class="string">"book__name"</span>,<span class="string">"book__price"</span>))</span><br></pre></td></tr></table></figure>
<h2 id="多表关系相关"><a href="#多表关系相关" class="headerlink" title="多表关系相关"></a>多表关系相关</h2><h3 id="ForeignKey"><a href="#ForeignKey" class="headerlink" title="ForeignKey"></a>ForeignKey</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">models.ForeignKey(</span><br><span class="line">    to,                          <span class="comment"># 要进行关联的表名,如：to="book"</span></span><br><span class="line">    to_field=<span class="literal">None</span>,               <span class="comment"># 要关联的表中的字段名称</span></span><br><span class="line">    on_delete,                   <span class="comment"># 当删除关联表中的数据时，当前表与其关联的行的行为</span></span><br><span class="line">    related_name=<span class="literal">None</span>,           <span class="comment"># 反向操作时，使用的字段名，用于代替 &lt;表名_set&gt;</span></span><br><span class="line">    related_query_name=<span class="literal">None</span>,     <span class="comment"># 反向操作时，使用的连接前缀，用于替换原表名</span></span><br><span class="line">    limit_choices_to=<span class="literal">None</span>,       <span class="comment"># 在 Admin 或 ModelForm 中显示关联数据时，过滤显示；如：limit_choices_to=lambda : &#123;'nid__gt': 5&#125;</span></span><br><span class="line">    parent_link=<span class="literal">False</span>,           <span class="comment"># 在Admin中是否显示关联数据</span></span><br><span class="line">    db_constraint=<span class="literal">True</span>,          <span class="comment"># 是否在数据库中创建外键约束，为False时候，不再数据创建外键约束，但ORM不影响ORM关系操作</span></span><br><span class="line">    **kwargs</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ul>
<li>on_delete</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">on_delete = models.CASCADE，      <span class="comment"># 删除关联数据，与之关联也删除</span></span><br><span class="line">on_delete = models.DO_NOTHING，   <span class="comment"># 删除关联数据，引发错误 IntegrityError</span></span><br><span class="line">on_delete = models.PROTECT，      <span class="comment"># 删除关联数据，引发错误 ProtectedError</span></span><br><span class="line">on_delete = models.SET_NULL，     <span class="comment"># 删除关联数据，与之关联的值设置为null（前提FK字段需要设置为可空）</span></span><br><span class="line">on_delete = models.SET_DEFAULT，  <span class="comment"># 删除关联数据，与之关联的值设置为默认值（前提FK字段需要设置默认值）</span></span><br><span class="line">on_delete = models.SET，          <span class="comment"># 删除关联数据，并将与之关联的值设置为指定值，值可以是固定值，也可以是函数的返回值</span></span><br><span class="line"></span><br><span class="line">                                  <span class="comment">#  def func():</span></span><br><span class="line">                                  <span class="comment">#      return 10</span></span><br><span class="line">                                  <span class="comment">#</span></span><br><span class="line">                                  <span class="comment">#  class MyModel(models.Model):</span></span><br><span class="line">                                  <span class="comment">#      user = models.ForeignKey(</span></span><br><span class="line">                                  <span class="comment">#          to="User",</span></span><br><span class="line">                                  <span class="comment">#          to_field="id"</span></span><br><span class="line">                                  <span class="comment">#          on_delete=models.SET(func),)</span></span><br></pre></td></tr></table></figure>
<h3 id="ManyToManyField"><a href="#ManyToManyField" class="headerlink" title="ManyToManyField"></a>ManyToManyField</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">models.ManyToManyField(</span><br><span class="line">	to,                           # 要进行关联的表名</span><br><span class="line">	related_name=None,            # 反向操作时，使用的字段名，用于代替 &lt;表名_set&gt;</span><br><span class="line">	related_query_name=None,      # 反向操作时，使用的连接前缀，用于替换原表名</span><br><span class="line">	limit_choices_to=None,        # 在 Admin 或 ModelForm 中显示关联数据时，过滤显示；如：limit_choices_to=lambda : &#123;&apos;nid__gt&apos;: 5&#125;</span><br><span class="line">	symmetrical=None,             # 仅用于多对多自关联时，symmetrical用于指定内部是否创建反向操作的字段</span><br><span class="line">	through=None,                 # 指定关联表的名称，启用此项时候 Django 不再自动创建关系表，而使用自定义表</span><br><span class="line">	through_fields=None,          # 使用自定义表，作为关联表的时候，指定关系表中哪些字段用于做多对多关系表</span><br><span class="line">	db_constraint=True,           # 是否在数据库中创建外键约束，为False时候，不再数据创建外键约束，但ORM不影响ORM关系操作</span><br><span class="line">	db_table=None,                # 默认创建第三张表时，数据库中表的名称</span><br><span class="line">	swappable=True,               #</span><br><span class="line">	**kwargs</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h2 id="表的自关联"><a href="#表的自关联" class="headerlink" title="表的自关联"></a>表的自关联</h2><p>表的自关联，表的主键与主键的关系，例如：自己的粉丝，与自己，同样处于用户表，怎么描述这种粉丝这种关系呢？这就用到自关联，再进行自关联的时候，需要注意使用 <code>related_name</code> 来避免冲突。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    user = models.CharField(max_length=<span class="number">15</span>)</span><br><span class="line">    age = models.SmallIntegerField(<span class="number">3</span>)</span><br><span class="line">    gender = models.NullBooleanField()</span><br><span class="line">    m = models.ManyToManyField(<span class="string">'User'</span>,related_name=<span class="string">'User_Self'</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">+--------------+---------+------+-----+---------+----------------+</span><br><span class="line">| Field        | Type    | Null | Key | Default | Extra          |</span><br><span class="line">+--------------+---------+------+-----+---------+----------------+</span><br><span class="line">| id           | int(11) | NO   | PRI | NULL    | auto_increment |</span><br><span class="line">| from_user_id | int(11) | NO   | MUL | NULL    |                |</span><br><span class="line">| to_user_id   | int(11) | NO   | MUL | NULL    |                |</span><br><span class="line">+--------------+---------+------+-----+---------+----------------+</span><br></pre></td></tr></table></figure>
<h2 id="聚合分组"><a href="#聚合分组" class="headerlink" title="聚合分组"></a>聚合分组</h2><p>Django 的聚合通过 <code>aggregate()</code>  来实现，分组通过 <code>annotate()</code> 来实现。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Avg,Min,Sum,Max,Count,F,Q</span><br></pre></td></tr></table></figure>
<h3 id="聚合查询"><a href="#聚合查询" class="headerlink" title="聚合查询"></a>聚合查询</h3><ul>
<li><code>aggregate()</code> 函数调用聚合函数，<code>bookSUM=</code>是为结果的名字赋值，结果是一个字典。</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(Book.objects.all().aggregate(bookSUM=Avg(<span class="string">"price"</span>)))          <span class="comment"># 找到所有书籍，对其价格求平均值</span></span><br><span class="line">print(Book.objects.filter(author__name=<span class="string">"杨金恒"</span>).aggregate(Sum(<span class="string">"price"</span>)))    <span class="comment"># 找到指定人的书籍均价</span></span><br></pre></td></tr></table></figure>
<h3 id="分组查询"><a href="#分组查询" class="headerlink" title="分组查询"></a>分组查询</h3><ul>
<li>对书这个对象的某个字段进行分组，分组后统计它的指定字段出现了几次。</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(Book.objects.values(<span class="string">"author__name"</span>).annotate(Count(<span class="string">"name"</span>)))</span><br></pre></td></tr></table></figure>
<h2 id="多条件查询"><a href="#多条件查询" class="headerlink" title="多条件查询"></a>多条件查询</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Avg,Min,Sum,Max,Count,F,Q</span><br></pre></td></tr></table></figure>
<h3 id="F函数"><a href="#F函数" class="headerlink" title="F函数"></a>F函数</h3><ul>
<li>F函数能够在没有连接数据库的情况下，对数据库字段进行引用</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Book.objects.all().update(price=F(<span class="string">'price'</span>)+<span class="number">10</span>)    <span class="comment"># 为所有的 price 字段增加 10</span></span><br></pre></td></tr></table></figure>
<h3 id="与"><a href="#与" class="headerlink" title="与"></a>与</h3><ul>
<li>与关系的多条件查询，直接使用逗号分隔条件即可</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">data = Book.objects.get(name=<span class="string">"Python程序开发"</span>,price=<span class="number">200</span>)</span><br><span class="line">print(data.name)</span><br></pre></td></tr></table></figure>
<h3 id="或"><a href="#或" class="headerlink" title="或"></a>或</h3><ul>
<li>或关系的多条件查询，需要使用Q函数，Q查询可以和关键字查询组合使用，但Q查询必须在前</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">data = Book.objects.filter(Q(name=<span class="string">"Python程序开发"</span>)|Q(name=<span class="string">"梦的解析"</span>))</span><br><span class="line">print(data.values(<span class="string">"name"</span>))</span><br></pre></td></tr></table></figure>
<h3 id="非"><a href="#非" class="headerlink" title="非"></a>非</h3><ul>
<li>非的关系，使用 ~ 对条件进行取反</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">data = Book.objects.filter(~Q(name=<span class="string">"Python程序开发"</span>),~Q(price__lt=<span class="number">200</span>))</span><br><span class="line">print(data.values(<span class="string">"name"</span>))</span><br></pre></td></tr></table></figure>
<h1 id="管理页面"><a href="#管理页面" class="headerlink" title="管理页面"></a>管理页面</h1><p><code>Django Admin</code> 是 <code>Django</code> 专用用来管理数据库的一个工具，它可以在后台定制对数据库表的管理。</p>
<h2 id="基本配置"><a href="#基本配置" class="headerlink" title="基本配置"></a>基本配置</h2><ul>
<li>创建管理员用户，执行下面命令，创建完成，就可以登陆管理页了：<code>htpp://127.0.0.1:80/admin</code></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">python manage.py createsuperuser</span><br></pre></td></tr></table></figure>
<ul>
<li>让管理页面显示中文，编辑项目的 <code>setting.py</code> 文件，修改下面的值</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">LANGUAGE_CODE = <span class="string">'zh-Hans'</span></span><br><span class="line">TIME_ZONE = <span class="string">'Asia/Shanghai'</span></span><br></pre></td></tr></table></figure>
<ul>
<li>让<code>Django</code> 管理表，需要首先注册表，在 APP 目录下编辑 <code>admin.py</code>文件，在这里注册需要管理的表。</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line">admin.site.register(models.Author)</span><br><span class="line">admin.site.register(models.Book)</span><br><span class="line">admin.site.register(models.Publish)</span><br></pre></td></tr></table></figure>
<p>接下来就可以在 admin 的管理页面来管理这些表了。</p>
<h2 id="定制功能"><a href="#定制功能" class="headerlink" title="定制功能"></a>定制功能</h2><ul>
<li>定制一张表的管理页面，让 Django 像Excel一样显示数据库的记录，但目前不能添加多对多</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookAdmin</span><span class="params">(admin.ModelAdmin)</span>:</span>                     <span class="comment"># 定制页面的显示必须继承自 admin.ModelAdmin</span></span><br><span class="line">    list_display = (<span class="string">'id'</span>,<span class="string">'name'</span>,<span class="string">'price'</span>,<span class="string">'pub_date'</span>，<span class="string">'publish_id'</span>)    <span class="comment"># 在这里定制想要显示的字段</span></span><br><span class="line">    </span><br><span class="line">admin.site.register(models.Book,BookAdmin)             <span class="comment"># 在注册表的时候，将类作为参数传入注册函数</span></span><br></pre></td></tr></table></figure>
<ul>
<li>让表管理页面显示的字段可编辑</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookAdmin</span><span class="params">(admin.ModelAdmin)</span>:</span></span><br><span class="line">    list_editable = (<span class="string">'name'</span>,<span class="string">'price'</span>,<span class="string">'pub_date'</span>)        <span class="comment"># 在这里定制想要编辑的字段</span></span><br></pre></td></tr></table></figure>
<ul>
<li>让表管理页面的字段按规则排序</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookAdmin</span><span class="params">(admin.ModelAdmin)</span>:</span></span><br><span class="line">    ordering = (<span class="string">'price'</span>,)                    <span class="comment"># price 字段升序排序</span></span><br><span class="line">    <span class="comment">#ordering = ('-price',)                    # price 字段降序排序</span></span><br></pre></td></tr></table></figure>
<ul>
<li>让记录管理页的外键字段，增加一个更加方便的选择输入框</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookAdmin</span><span class="params">(admin.ModelAdmin)</span>:</span></span><br><span class="line">    filter_horizontal = (<span class="string">'author'</span>,)          <span class="comment"># 在这里输入外键</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>  有些时候，页面上显示的名称为 objects 这样，那就需要在 模型中重写 <code>__str__</code> 方法，这样会更直观的显示。</p>
</blockquote>
<ul>
<li>修改记录页面的最大数目</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookAdmin</span><span class="params">(admin.ModelAdmin)</span>:</span></span><br><span class="line">    list_per_page = <span class="number">20</span>                       <span class="comment"># 修改记录页面显示的最大条目，超过在下一页显示</span></span><br></pre></td></tr></table></figure>
<ul>
<li>增加记录的搜索功能</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookAdmin</span><span class="params">(admin.ModelAdmin)</span>:</span></span><br><span class="line">    search_fields = (<span class="string">'name'</span>,<span class="string">'publish__name'</span>) <span class="comment"># 可以根据元组内的字段内容来搜索表</span></span><br></pre></td></tr></table></figure>
<ul>
<li>增加一个右侧的选择过滤框</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookAdmin</span><span class="params">(admin.ModelAdmin)</span>:</span></span><br><span class="line">    list_filter = (<span class="string">'pub_date'</span>,<span class="string">'publish'</span>)     <span class="comment"># 在这里输入需要分类过滤的字段，外键字段直接写外键对象名</span></span><br></pre></td></tr></table></figure>
<ul>
<li>增加记录的时候，隐藏一些默认项目，可以显示为折叠效果，可以点开填写</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookAdmin</span><span class="params">(admin.ModelAdmin)</span>:</span></span><br><span class="line">    fieldsets = [</span><br><span class="line">        (<span class="literal">None</span>,&#123;<span class="string">'fields'</span>:[<span class="string">'name'</span>,<span class="string">'price'</span>]&#125;),                                       <span class="comment"># 默认显示的字段</span></span><br><span class="line">        (<span class="string">'查看更多'</span>,&#123;<span class="string">'fields'</span>:[<span class="string">'pub_date'</span>,<span class="string">'publish'</span>],<span class="string">'classes'</span>:[<span class="string">'collapse'</span>]&#125;),     <span class="comment"># 隐藏的字段，'classes':['collapse'] 表示样式为折叠</span></span><br><span class="line">    ]</span><br></pre></td></tr></table></figure>
<h2 id="模型参数"><a href="#模型参数" class="headerlink" title="模型参数"></a>模型参数</h2><p>以下的参数在定义模型的时候，在其字段的参数中添加。</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>verbose_name</code></td>
<td><code>django admin</code> 中显示的字段名称</td>
</tr>
<tr>
<td><code>editable</code></td>
<td><code>django admin</code> 中表示是否可编辑</td>
</tr>
<tr>
<td><code>choices</code></td>
<td>在一个范围内选择出一项， 作用：<code>django admin</code> 中显示下拉框，避免连表查询。</td>
</tr>
<tr>
<td><code>blank=True</code></td>
<td>为 <code>True</code> 时，Django 在验证数据时候将允许向数据库存储空值，默认为 <code>False</code>。</td>
</tr>
<tr>
<td><code>help_text</code></td>
<td><code>django admin</code> 中显示字段的提示信息</td>
</tr>
<tr>
<td><code>error_messages</code></td>
<td>自定义错误信息（字典类型）如：{‘null’:   “不能为空.”, ‘invalid’: ‘格式错误’,’blank’:’不能为空’}</td>
</tr>
<tr>
<td><code>db_tablespace</code></td>
<td></td>
</tr>
<tr>
<td><code>unique_for_date</code></td>
<td>日期唯一</td>
</tr>
<tr>
<td><code>unique_for_month</code></td>
<td>月份唯一</td>
</tr>
<tr>
<td><code>unique_for_year</code></td>
<td>年份唯一</td>
</tr>
<tr>
<td><code>validators</code></td>
<td>自定义错误验证（列表类型），从而定制想要的验证规则</td>
</tr>
</tbody>
</table>
<p>例如：为字段增加 <code>Django admin</code> 显示属性</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">20</span>,verbose_name=<span class="string">"名称"</span>)</span><br><span class="line">    price = models.IntegerField(verbose_name=<span class="string">"价格"</span>)</span><br><span class="line">    pub_date = models.DateField(verbose_name=<span class="string">"出版日期"</span>)</span><br><span class="line">    publish = models.ForeignKey(<span class="string">"Publish"</span>,on_delete=models.CASCADE)</span><br></pre></td></tr></table></figure>
<h1 id="会话保持"><a href="#会话保持" class="headerlink" title="会话保持"></a>会话保持</h1><p>会话跟踪是 Web 程序中常用的技术，用来跟踪用户的整个会话。常用的会话跟踪技术是 Cookie 与 Session。Cookie 通过在客户端记录信息确定用户身份，Session 通过在服务器端记录信息确定用户身份。</p>
<h2 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h2><ul>
<li>Cookie是做什么的</li>
</ul>
<p>Cookie意为“甜饼”，是由W3C组织提出，最早由Netscape社区发展的一种机制。目前Cookie已经成为标准，所有的主流浏览器如IE、Netscape、Firefox、Opera等都支持Cookie。</p>
<p>由于HTTP是一种无状态的协议，服务器单从网络连接上无从知道客户身份。怎么办呢？就给客户端们颁发一个通行证吧，每人一个，无论谁访问都必须携带自己通行证。这样服务器就能从通行证上确认客户身份了。这就是Cookie的工作原理。</p>
<ul>
<li>Cookie的工作过程</li>
</ul>
<p>当用户使用浏览器访问一个支持 Cookie 的网站的时候，用户会提供包括用户名密码等个人信息并且提交至服务器，接着，服务器向用户发送响应报文的时候，会将这些个人信息（Cookie）插入到 HTTP 报文的响应头中，然后将响应报文发送给用户，当客户端浏览器接收到来自服务器的响应之后，浏览器会将这些信息（Cookie）存放在一个统一的位置。</p>
<p>当客户端再向服务器请求页面的时候，就会把相应的 Cookie 插入到 HTTP 报文的请求头中，再次发回至服务器。有了 Cookie 技术服务器在接收到来自客户端浏览器的请求之后，就能够通过分析存放于请求头的 Cookie 得到客户端特有的信息，从而判断用户身份，根据用户身份进行不同的响应。</p>
<p>其实本质上 Cookie 就是 HTTP 的一个扩展，有两个 HTTP 头部是专门负责设置以及发送 Cookie 的,它们分别是 Set-Cookie 以及 Cookie 。</p>
<ul>
<li>内存Cookie和硬盘Cookie</li>
</ul>
<p>当服务器返回给客户端一个 HTTP 响应信息时，其中如果包含Set-Cookie这个头部时，意思就是指示客户端建立一个 Cookie ，并且在后续的 HTTP 请求中自动发送这个 Cookie 到服务器端，直到这个 Cookie 过期。如果 Cookie 的生存时间是整个会话期间的话，那么浏览器会将 Cookie 保存在内存中，浏览器关闭时就会自动清除这个 Cookie 。</p>
<p>另外一种情况就是保存在客户端的硬盘中，浏览器关闭的话，该 Cookie 也不会被清除，下次打开浏览器访问对应网站时，这个cookie就会自动再次发送到服务器端。 </p>
<h3 id="简单实现"><a href="#简单实现" class="headerlink" title="简单实现"></a>简单实现</h3><ul>
<li>登陆页面</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"/login/"</span> <span class="attr">method</span>=<span class="string">"POST"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">placeholder</span>=<span class="string">"用户名"</span>/&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">placeholder</span>=<span class="string">"密码"</span>/&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"登陆"</span>/&gt;</span><span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>后端逻辑</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render,HttpResponse,redirect</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:                         <span class="comment"># 当使用 POST 方法访访问这个页面的时候</span></span><br><span class="line">        user = request.POST.get(<span class="string">'username'</span>,<span class="literal">None</span>)         <span class="comment"># 获取表单用户名</span></span><br><span class="line">        pwd = request.POST.get(<span class="string">'password'</span>,<span class="literal">None</span>)          <span class="comment"># 获取表单的密码</span></span><br><span class="line">        <span class="keyword">if</span> user == <span class="string">'admin'</span> <span class="keyword">and</span> pwd == <span class="string">'123456'</span>:          <span class="comment"># 如果表单的用户名和密码正确，就跳转到 index 页面</span></span><br><span class="line">            ret = redirect(<span class="string">'/index/'</span>)                    <span class="comment"># 设置跳转到 index 页面的报文</span></span><br><span class="line">            ret.set_cookie(<span class="string">'user'</span>,user)                  <span class="comment"># 对跳转页面报文设置 Cookie</span></span><br><span class="line">            <span class="keyword">return</span> ret                                   <span class="comment"># 发送响应报文</span></span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">'login.html'</span>)                  <span class="comment"># 用户通过 GET 方法访问页面</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> request.COOKIES.get(<span class="string">'user'</span>,<span class="literal">None</span>):                 <span class="comment"># 如果用户的 Cookie 信息内有已经登陆的 Cookie</span></span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">'OK'</span>)                        <span class="comment"># 直接响应登陆后的页面</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">'/login'</span>)                        <span class="comment"># 否则跳转到 index 页面</span></span><br></pre></td></tr></table></figure>
<h3 id="命令帮助"><a href="#命令帮助" class="headerlink" title="命令帮助"></a>命令帮助</h3><ul>
<li>设置 Cookie，可以指定 Cookie 的过期时间</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">set_cookie(self, key, value=<span class="string">''</span>, max_age=<span class="literal">None</span>, expires=<span class="literal">None</span>, path=<span class="string">'/'</span>, domain=<span class="literal">None</span>, secure=<span class="literal">False</span>, httponly=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">expires：是个具体的时间格式的过期标志，例如：datetime.datetime 对象，某些浏览器不支持 max_age ，则会使用 expires 所设置的时间，一般与 max_age 一致</span><br></pre></td></tr></table></figure>
<ul>
<li>读取 Cookie </li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">request.COOKIES.get(<span class="string">'key'</span>,<span class="literal">None</span>)        <span class="comment"># 从客户端的请求报文中获取 Cookie 信息，如果失败则返回 None</span></span><br></pre></td></tr></table></figure>
<ul>
<li>js 操作 Cookie</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">'http://830909.blog.51cto.com/static/js/jquery.cookie.js'</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">$.cookie("list_pager_num", 30,&#123; path: '/' &#125;);</span><br></pre></td></tr></table></figure>
<h2 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h2><ul>
<li>Session是什么</li>
</ul>
<p>Cookie 解决了需要保持状态的问题，但是由于 Cookie 本身最大只有 4096 字节，以及Cookie本身保存在客户端，可能被窃取篡改，因此就需要一种新的东西，它能支持更多字节，并且它保存在服务器端，有较高的安全性，这就是Session。</p>
<p>Session 是另一种记录客户状态的机制，不同的是 Cookie 保存在客户端浏览器中，而 Session 保存在服务器上。客户端浏览器访问服务器的时候，服务器把客户端信息以某种形式记录在服务器上。这就是 Session 。客户端浏览器再次访问时只需要从该 Session 中查找该客户的状态就可以了。</p>
<p>如果说 Cookie 机制是通过检查客户身上的“通行证”来确定客户身份的话，那么 Session 机制就是通过检查服务器上的“客户明细表”来确认客户身份。Session 相当于程序在服务器上建立的一份客户档案，客户来访的时候只需要查询客户档案表就可以了。</p>
<ul>
<li>Session工作过程</li>
</ul>
<p>当用户访问到一个服务器，如果服务器启用 Session，服务器就要为该用户创建一个 SESSION ，在创建这个 SESSION 的时候，服务器首先检查这个用户发来的请求里是否包含了一个 SESSION ID ，如果包含了一个 SESSION ID 则说明之前该用户已经登陆过并为此用户创建过 SESSION ，那服务器就按照这个 SESSION ID 把这个 SESSION 在服务器的内存中查找出来（如果查找不到，就有可能为他新创建一个），如果客户端请求里不包含有 SESSION ID ，则为该客户端创建一个 SESSION 并生成一个与此 SESSION 相关的 SESSION ID 。这个 SESSION ID 是唯一的、不重复的、不容易找到规律的字符串，这个 SESSION ID 将被在本次响应中返回到客户端保存，而保存这个 SESSION ID 的正是 COOKIE ，这样在交互过程中浏览器可以自动的按照规则把这个标识发送给服务器。</p>
<ul>
<li>客户端禁止Cookie 怎么办</li>
</ul>
<p>我们知道在IE中，我们可以在工具的Internet选项中把Cookie禁止，那么会不会出现把客户端的Cookie禁止了，那么SESSIONID就无法再用了呢？找了一些资料说明，可以有其他机制在COOKIE被禁止时仍然能够把Session id传递回服务器。</p>
<p>经常被使用的一种技术叫做URL重写，就是把Session id直接附加在URL路径的后面一种是作为URL路径的附加信息,表现形式为： </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http://…./xxx;jSession=ByOK3vjFD75aPnrF7C2HmdnV6QZcEbzWoWiBYEnLerjQ99zWpBng!-145788764；</span><br></pre></td></tr></table></figure>
<p>另一种是作为查询字符串附加在URL后面，表现形式为： </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http://…../xxx?jSession=ByOK3vjFD75aPnrF7C2HmdnV6QZcEbzWoWiBYEnLerjQ99zWpBng!-145788764</span><br></pre></td></tr></table></figure>
<p>还有一种就是表单隐藏字段。就是服务器会自动修改表单，添加一个隐藏字段，以便在表单提交时能够把Session id传递回服务器。</p>
<h3 id="简单实现-1"><a href="#简单实现-1" class="headerlink" title="简单实现"></a>简单实现</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render,HttpResponse,redirect</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">        user = request.POST.get(<span class="string">'username'</span>,<span class="literal">None</span>)</span><br><span class="line">        pwd = request.POST.get(<span class="string">'password'</span>,<span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">if</span> user == <span class="string">'admin'</span> <span class="keyword">and</span> pwd == <span class="string">'123456'</span>:</span><br><span class="line">            request.session[<span class="string">'is_login'</span>] = <span class="literal">True</span></span><br><span class="line">            request.session[<span class="string">'user'</span>] = user</span><br><span class="line">            <span class="keyword">return</span> render(request,<span class="string">'/index/'</span>)</span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">'login.html'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> request.session.get(<span class="string">'is_login'</span>,<span class="literal">None</span>):</span><br><span class="line">        name = request.session.get(<span class="string">'user'</span>)</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(name)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">'/login'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="命令帮助-1"><a href="#命令帮助-1" class="headerlink" title="命令帮助"></a>命令帮助</h3><ul>
<li>给客户端一个 Cookie 信息内部包含的是 Session，同时在服务器数据库内设置 Session 的键值</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">request.session[<span class="string">'key'</span>] = values</span><br></pre></td></tr></table></figure>
<ul>
<li>从服务器读取本次请求的 Session 信息</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">request.session[<span class="string">'key'</span>]</span><br></pre></td></tr></table></figure>
<ul>
<li>删除 Session 信息</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">del</span> request.session[<span class="string">'key'</span>]</span><br></pre></td></tr></table></figure>
<ul>
<li>设置过期时间</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">request.session.set_expiry(value)</span><br><span class="line"></span><br><span class="line">value：如果是个整数，Session 会在这些秒数后失效</span><br><span class="line">value：如果是个 datatime 或者 timedelta，Session 会在这个时间失效</span><br><span class="line">value：如果是 <span class="number">0</span> ，用户关闭浏览器 Session 就会失效</span><br><span class="line">value：如果是 <span class="literal">None</span>，Session 会依赖全局 Session 失效策略，Django 默认失效策略为 <span class="number">15</span> 天</span><br></pre></td></tr></table></figure>
<h1 id="Form组件"><a href="#Form组件" class="headerlink" title="Form组件"></a>Form组件</h1><h2 id="主要功能"><a href="#主要功能" class="headerlink" title="主要功能"></a>主要功能</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">验证表单数据的有效性</span><br><span class="line">生成HTML表单</span><br><span class="line">为表单初始化默认值</span><br></pre></td></tr></table></figure>
<ul>
<li>可用类型</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&apos;Field&apos;, &apos;CharField&apos;, &apos;IntegerField&apos;,</span><br><span class="line">&apos;DateField&apos;, &apos;TimeField&apos;, &apos;DateTimeField&apos;, &apos;DurationField&apos;,</span><br><span class="line">&apos;RegexField&apos;, &apos;EmailField&apos;, &apos;FileField&apos;, &apos;ImageField&apos;, &apos;URLField&apos;,</span><br><span class="line">&apos;BooleanField&apos;, &apos;NullBooleanField&apos;, &apos;ChoiceField&apos;, &apos;MultipleChoiceField&apos;,</span><br><span class="line">&apos;ComboField&apos;, &apos;MultiValueField&apos;, &apos;FloatField&apos;, &apos;DecimalField&apos;,</span><br><span class="line">&apos;SplitDateTimeField&apos;, &apos;GenericIPAddressField&apos;, &apos;FilePathField&apos;,</span><br><span class="line">&apos;SlugField&apos;, &apos;TypedChoiceField&apos;, &apos;TypedMultipleChoiceField&apos;, &apos;UUIDField&apos;,</span><br></pre></td></tr></table></figure>
<ul>
<li>继承关系</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">                                                           Field</span><br><span class="line">                                                             |</span><br><span class="line">    +-------------+----------------+------------+------------------+-----------+------------+------------+-------------+</span><br><span class="line">    |             |                |            |                  |           |            |            |             |</span><br><span class="line">CharField   BooleanField      IntegerField  BaseTemporalField  DurationField FileField   ChoiceField  ComboField MultiValueField</span><br><span class="line">    ⬇             ⬇                ⬇            ⬇                              ⬇            ⬇                          ⬇</span><br><span class="line">EmailField  NullBooleanField  FloatField    DateField                        ImageField  FilePathField           SplitDateTimeField</span><br><span class="line">URLField                      DecimalField  TimeField                                    TypedChoiceField        TypedMultipleChoiceField</span><br><span class="line">SlugField                                   DateTimeField                                MultipleChoiceField</span><br><span class="line">UUIDField</span><br><span class="line">RegexField</span><br><span class="line">GenericIPAddressField</span><br></pre></td></tr></table></figure>
<h2 id="表单验证用法"><a href="#表单验证用法" class="headerlink" title="表单验证用法"></a>表单验证用法</h2><p>获取所有用户数据，对用户提交的每条数据进行验证，验证成功返回所有正确信息，验证失败返回所有错误的信息，本示例通过普通POST提交实现，下面有通过AJAX提交的示例。</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>forms_object.is_valid()</code></td>
<td>表单验证是否成功的布尔值</td>
</tr>
<tr>
<td><code>forms_object.cleaned_data</code></td>
<td>通过验证的字典</td>
</tr>
<tr>
<td><code>forms_object.errors</code></td>
<td>没有通过验证的错误信息</td>
</tr>
</tbody>
</table>
<ul>
<li>视图类，Form 类中的属性，最好和数据库的字段一致，这样在写数据库的时候可以使用 <code>**kwargs</code> 来进行。</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render, redirect, HttpResponse</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> forms</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestForm</span><span class="params">(forms.Form)</span>:</span></span><br><span class="line">    user = forms.CharField(label=<span class="string">'账户'</span>,min_length=<span class="number">6</span>, max_length=<span class="number">12</span>, required=<span class="literal">True</span>)</span><br><span class="line">    pwd = forms.CharField(label=<span class="string">'密码'</span>,min_length=<span class="number">6</span>, max_length=<span class="number">12</span>, required=<span class="literal">True</span>)</span><br><span class="line">    email = forms.EmailField(label=<span class="string">'邮箱'</span>,)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.views <span class="keyword">import</span> View</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">index</span><span class="params">(View)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        obj = TestForm()</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">'index.html'</span>, &#123;<span class="string">'obj'</span>: obj&#125;)        <span class="comment"># 向前端传递表单</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        obj = TestForm(request.POST,request.FILES)                <span class="comment"># 验证表单有效性</span></span><br><span class="line">        <span class="keyword">if</span> obj.is_valid():                                        <span class="comment"># 如果验证成功</span></span><br><span class="line">            print(obj.cleaned_data)                               <span class="comment"># 此处显示是验证证功的表单字典</span></span><br><span class="line">            <span class="keyword">return</span> HttpResponse(<span class="string">'POST OK'</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(obj.errors)                                     <span class="comment"># 打印验证失败的表单</span></span><br><span class="line">            <span class="keyword">return</span> render(request, <span class="string">'index.html'</span>, &#123;<span class="string">'obj'</span>: obj&#125;)    <span class="comment"># 向模板传递验证结果</span></span><br></pre></td></tr></table></figure>
<ul>
<li>模板文件</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"/index/"</span> <span class="attr">method</span>=<span class="string">"POST"</span> <span class="attr">novalidate</span>&gt;</span></span><br><span class="line">        &#123;% csrf_token %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; obj.user.label &#125;&#125; : &#123;&#123; obj.user &#125;&#125; &#123;&#123; obj.errors.user.0 &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; obj.pwd.label &#125;&#125; : &#123;&#123; obj.pwd &#125;&#125; &#123;&#123; obj.errors.pwd.0 &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; obj.email.label &#125;&#125; : &#123;&#123; obj.email &#125;&#125; &#123;&#123; obj.errors.email.0 &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"提交"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="AJAX表单验证"><a href="#AJAX表单验证" class="headerlink" title="AJAX表单验证"></a>AJAX表单验证</h2><p>提交表单的时候，上面的用法是提交表单后默认会跳转到提交的页面，由于提交的页面就是原来的页面，但是从服务器返回的数据却包含了表单验证的结果，所以才能再页面渲染。</p>
<p>但是如果是 AJAX 提交，则不能跳转到新页面，那么错误消息就不能通过 <code>render</code> 传递给模板来渲染，所以必须使用 <code>JSON</code> 来传递消息，再由 JS 渲染将 JSON 的错误消息渲染到页面。</p>
<ul>
<li>视图类</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AjaxForm</span><span class="params">(forms.Form)</span>:</span></span><br><span class="line">    price = forms.IntegerField()</span><br><span class="line">    user_id = forms.IntegerField(</span><br><span class="line">        widget=widgets.Select(choices=[(<span class="number">0</span>, <span class="string">'alix'</span>), (<span class="number">1</span>, <span class="string">'刘皓宸'</span>), (<span class="number">2</span>, <span class="string">'杨建'</span>), ])</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ajax</span><span class="params">(View)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        obj = AjaxForm()</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">'ajax.html'</span>, &#123;<span class="string">'obj'</span>: obj&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        <span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">        obj = AjaxForm(request.POST)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> obj.is_valid():</span><br><span class="line">            ret = &#123;<span class="string">'status'</span>: <span class="string">'success'</span>&#125;</span><br><span class="line">            <span class="keyword">return</span> HttpResponse(json.dumps(ret))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            ret = &#123;<span class="string">'status'</span>: <span class="string">'error'</span>&#125;</span><br><span class="line">            ret[<span class="string">'message'</span>] = obj.errors</span><br><span class="line">            <span class="keyword">return</span> HttpResponse(json.dumps(ret))</span><br></pre></td></tr></table></figure>
<ul>
<li>前端页面</li>
</ul>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">    &lt;script src="/static/jquery-3.3.1.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;form id=<span class="string">"table"</span> action=<span class="string">"/ajax/"</span> method=<span class="string">"POST"</span>&gt;</span><br><span class="line">    &#123;% csrf_token %&#125;</span><br><span class="line">    &#123;&#123; obj.as_p &#125;&#125;</span><br><span class="line">    &lt;input id=<span class="string">"commit"</span> type=<span class="string">"button"</span> value=<span class="string">"Ajax提交"</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    $(function () &#123;</span><br><span class="line">        $(<span class="string">'#commit'</span>).click(function () &#123;</span><br><span class="line">            $.ajax(&#123;</span><br><span class="line">                url: <span class="string">'/ajax/'</span>,</span><br><span class="line">                type: <span class="string">'POST'</span>,</span><br><span class="line">                data: $(<span class="string">'#table'</span>).serialize(),</span><br><span class="line">                datatype: <span class="string">'JSON'</span>,</span><br><span class="line">                success: function (args) &#123;</span><br><span class="line">                    console.log(args);</span><br><span class="line">                    <span class="keyword">if</span> (args.status === <span class="string">'success'</span>) &#123;</span><br><span class="line">                        window.location.href = <span class="string">'http://baidu.com'</span></span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        console.log(args.message)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h2 id="定制Form规则"><a href="#定制Form规则" class="headerlink" title="定制Form规则"></a>定制Form规则</h2><ul>
<li>Form 表单项定制</li>
</ul>
<p>有的时候后台在验证表单格式通过后，会再验证表单数据再数据库中的唯一性，例如：注册时候的用户名是否重复的验证，其实 forms 类已经提供了这个接口，再继承 forms.Form 时候，重写某个字段的验证方法即可，方法名字有固定的格式：<code>clean_需要验证的表单项名称</code>，这个方法验证成功则返回原数据，验证失败则抛出 ValidationError 异常即可，剩下的 forms 会接收异常并将这个表单项列为未验证成功。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AjaxForm</span><span class="params">(forms.Form)</span>:</span></span><br><span class="line">    user = forms.CharField()</span><br><span class="line">    user_id = forms.IntegerField(</span><br><span class="line">        widget=widgets.Select(choices=[(<span class="number">0</span>, <span class="string">'alix'</span>), (<span class="number">1</span>, <span class="string">'刘皓宸'</span>), (<span class="number">2</span>, <span class="string">'杨建'</span>), ])</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean_user</span><span class="params">(self)</span>:</span>                                                        <span class="comment"># 此处为 user 字段增加了数据库唯一性的验证</span></span><br><span class="line">        <span class="keyword">from</span> django.core.exceptions <span class="keyword">import</span> NON_FIELD_ERRORS, ValidationError</span><br><span class="line">        v = self.cleaned_data[<span class="string">'user'</span>]</span><br><span class="line">        <span class="keyword">if</span> models.UserInfo.objects.filter(user=v).count():</span><br><span class="line">            <span class="keyword">raise</span> ValidationError(<span class="string">'用户名已存在'</span>)                                 <span class="comment"># 数据库内存在重名</span></span><br><span class="line">        <span class="keyword">return</span> v                                                                 <span class="comment"># 认证通过</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ajax</span><span class="params">(View)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        obj = AjaxForm()</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">'ajax.html'</span>, &#123;<span class="string">'obj'</span>: obj&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        <span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">        obj = AjaxForm(request.POST)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> obj.is_valid():</span><br><span class="line">            ret = &#123;<span class="string">'status'</span>: <span class="string">'success'</span>&#125;</span><br><span class="line">            <span class="keyword">return</span> HttpResponse(json.dumps(ret))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            ret = &#123;<span class="string">'status'</span>: <span class="string">'error'</span>&#125;</span><br><span class="line">            ret[<span class="string">'message'</span>] = obj.errors</span><br><span class="line">            <span class="keyword">return</span> HttpResponse(json.dumps(ret,ensure_ascii=<span class="literal">False</span>))</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/static/jquery-3.3.1.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">"table"</span> <span class="attr">action</span>=<span class="string">"/ajax/"</span> <span class="attr">method</span>=<span class="string">"POST"</span>&gt;</span></span><br><span class="line">    &#123;% csrf_token %&#125;</span><br><span class="line">    &#123;&#123; obj.as_p &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"commit"</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"Ajax提交"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    $(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        $(<span class="string">'#commit'</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">                url: <span class="string">'/ajax/'</span>,</span></span><br><span class="line"><span class="javascript">                type: <span class="string">'POST'</span>,</span></span><br><span class="line"><span class="javascript">                data: $(<span class="string">'#table'</span>).serialize(),</span></span><br><span class="line"><span class="javascript">                dataType: <span class="string">'JSON'</span>,</span></span><br><span class="line"><span class="javascript">                success: <span class="function"><span class="keyword">function</span> (<span class="params">args</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">if</span> (args.status === <span class="string">'success'</span>) &#123;</span></span><br><span class="line"><span class="javascript">                        <span class="built_in">console</span>.log(<span class="string">'ok'</span>);</span></span><br><span class="line"><span class="javascript">                        <span class="built_in">window</span>.location.href = <span class="string">'http://www.baidu.com'</span>;     <span class="comment">// 验证通过跳转</span></span></span><br><span class="line">                    &#125;</span><br><span class="line"><span class="javascript">                    <span class="built_in">console</span>.log(args.message);                             <span class="comment">// 验证失败打印失败原因</span></span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>表单整体验证，同时验证多个表单项，验证不通过，其错误值会返回在 forms 对象的 <code>__all__</code> 属性内。</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AjaxForm</span><span class="params">(forms.Form)</span>:</span></span><br><span class="line">    user = forms.CharField()</span><br><span class="line">    user_id = forms.IntegerField(</span><br><span class="line">        widget=widgets.Select(choices=[(<span class="number">0</span>, <span class="string">'alix'</span>), (<span class="number">1</span>, <span class="string">'刘皓宸'</span>), (<span class="number">2</span>, <span class="string">'杨建'</span>), ])</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clean</span><span class="params">(self)</span>:</span></span><br><span class="line">        value_dict = self.cleaned_data</span><br><span class="line">        v1 = value_dict.get(<span class="string">'user'</span>)</span><br><span class="line">        v2 = value_dict.get(<span class="string">'user_id'</span>)</span><br><span class="line">        <span class="keyword">if</span> v1 == <span class="string">'root'</span> <span class="keyword">and</span> v2 == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValidationError(<span class="string">'多项值验证错误'</span>)</span><br><span class="line">        <span class="keyword">return</span> self.cleaned_data</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/static/jquery-3.3.1.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">"table"</span> <span class="attr">action</span>=<span class="string">"/ajax/"</span> <span class="attr">method</span>=<span class="string">"POST"</span>&gt;</span></span><br><span class="line">    &#123;% csrf_token %&#125;</span><br><span class="line">    &#123;&#123; obj.as_p &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"commit"</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"Ajax提交"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    $(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        $(<span class="string">'#commit'</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">                url: <span class="string">'/ajax/'</span>,</span></span><br><span class="line"><span class="javascript">                type: <span class="string">'POST'</span>,</span></span><br><span class="line"><span class="javascript">                data: $(<span class="string">'#table'</span>).serialize(),</span></span><br><span class="line"><span class="javascript">                dataType: <span class="string">'JSON'</span>,</span></span><br><span class="line"><span class="javascript">                success: <span class="function"><span class="keyword">function</span> (<span class="params">args</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">if</span> (args.status === <span class="string">'success'</span>) &#123;</span></span><br><span class="line"><span class="javascript">                        <span class="built_in">console</span>.log(<span class="string">'ok'</span>);</span></span><br><span class="line"><span class="javascript">                        <span class="built_in">window</span>.location.href = <span class="string">'http://www.baidu.com'</span>;</span></span><br><span class="line">                    &#125;</span><br><span class="line"><span class="javascript">                    <span class="built_in">console</span>.log(args.message.__all__[<span class="number">0</span>]);              <span class="comment">// 得到整体验证的结果</span></span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="规则定制"><a href="#规则定制" class="headerlink" title="规则定制"></a>规则定制</h2><p>Field，为所有继承它的字类提供了基本的功能定制。</p>
<ul>
<li>Field 基类</li>
</ul>
<table>
<thead>
<tr>
<th>属性</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>required=True</code></td>
<td>是否为必填项</td>
</tr>
<tr>
<td><code>widget=None</code></td>
<td>定制生成的HTML插件</td>
</tr>
<tr>
<td><code>label=None</code></td>
<td>用于生成Label标签或显示内容</td>
</tr>
<tr>
<td><code>initial=None</code></td>
<td>初始值，不常用，编辑时候一般从数据库初始化</td>
</tr>
<tr>
<td><code>help_text=&#39;&#39;</code></td>
<td>帮助信息(在标签旁边显示)</td>
</tr>
<tr>
<td><code>error_messages=None</code></td>
<td>错误信息，字典格式如： <code>{&#39;required&#39;:&#39;不能为空&#39;, &#39;invalid&#39;:&#39;格式错误&#39;</code></td>
</tr>
<tr>
<td><code>show_hidden_initial=False</code></td>
<td>是否在当前插件后面再加一个隐藏的且具有默认值的插件（可用于检验两次输入是否一致）</td>
</tr>
<tr>
<td><code>validators=[]</code></td>
<td>自定义验证规则</td>
</tr>
<tr>
<td><code>localize=False</code></td>
<td>是否支持本地化，如果数据库的时间是UTC时间，本地时间为东八区，如果设置此项，则自动转换为东八区</td>
</tr>
<tr>
<td><code>disabled=False</code></td>
<td>是否可以编辑</td>
</tr>
<tr>
<td><code>label_suffix=None</code></td>
<td>Label内容后缀</td>
</tr>
</tbody>
</table>
<hr>
<ul>
<li>CharField(Field)</li>
</ul>
<table>
<thead>
<tr>
<th>属性</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>max_length</code></td>
<td>最大长度</td>
</tr>
<tr>
<td><code>min_length</code></td>
<td>最小长度</td>
</tr>
<tr>
<td><code>strip</code></td>
<td>是否自动移除空白</td>
</tr>
<tr>
<td><code>empty_value</code></td>
<td>TODO</td>
</tr>
</tbody>
</table>
<ul>
<li>EmailField(CharField)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">满足 CharField 同时正则匹配为 Email</span><br></pre></td></tr></table></figure>
<ul>
<li>URLField(CharField)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">满足 CharField 同时正则匹配为 URL</span><br></pre></td></tr></table></figure>
<ul>
<li>SlugField(CharField)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">满足 CharField 同时正则匹配为 数字，字母，下划线，减号（连字符）</span><br></pre></td></tr></table></figure>
<ul>
<li>UUIDField(CharField)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">满足 CharField 同时正则匹配为 UUID</span><br></pre></td></tr></table></figure>
<ul>
<li>RegexField(CharField)</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">regex        <span class="comment">#自定义正则表达式</span></span><br></pre></td></tr></table></figure>
<ul>
<li>GenericIPAddressField(CharField)</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">protocol=<span class="string">'both'</span>：支持的IP格式：both,ipv4,ipv6</span><br><span class="line">unpack_ipv4=<span class="literal">False</span> ：解析ipv4地址，如果是::ffff:<span class="number">192.0</span><span class="number">.2</span><span class="number">.1</span>时候，可解析为<span class="number">192.0</span><span class="number">.2</span><span class="number">.1</span>， PS：protocol必须为both才能启用。</span><br></pre></td></tr></table></figure>
<hr>
<ul>
<li>BooleanField(Field)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">布尔值</span><br></pre></td></tr></table></figure>
<ul>
<li>NullBooleanField(BooleanField)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">允许空的布尔值</span><br></pre></td></tr></table></figure>
<hr>
<ul>
<li>IntegerField(Field)</li>
</ul>
<table>
<thead>
<tr>
<th><code>属性</code></th>
<th><code>含义</code></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>max_value</code></td>
<td>最大值</td>
</tr>
<tr>
<td><code>min_value</code></td>
<td>最小值</td>
</tr>
</tbody>
</table>
<ul>
<li>FloatField(IntegerField)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">浮点数</span><br></pre></td></tr></table></figure>
<ul>
<li>DecimalField(IntegerField)</li>
</ul>
<p>十进制浮点数</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>max_value</code></td>
<td>最大值</td>
</tr>
<tr>
<td><code>min_value</code></td>
<td>最小值</td>
</tr>
<tr>
<td><code>max_digits</code></td>
<td>总长度</td>
</tr>
<tr>
<td><code>decimal_places</code></td>
<td>小数位长度</td>
</tr>
</tbody>
</table>
<hr>
<ul>
<li>BaseTemporalField(Field)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">input_formats    #时间格式化</span><br></pre></td></tr></table></figure>
<ul>
<li>DateField(BaseTemporalField)</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">没有提供 input_formats 属性时候：默认格式为：</span><br><span class="line"></span><br><span class="line">[<span class="string">'%Y-%m-%d'</span>,      <span class="comment"># '2006-10-25'</span></span><br><span class="line"> <span class="string">'%m/%d/%Y'</span>,      <span class="comment"># '10/25/2006'</span></span><br><span class="line"> <span class="string">'%m/%d/%y'</span>]      <span class="comment"># '10/25/06'</span></span><br></pre></td></tr></table></figure>
<ul>
<li>TimeField(BaseTemporalField)</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">没有提供 input_formats 属性时候：默认格式为：</span><br><span class="line"></span><br><span class="line">[<span class="string">'%b %d %Y'</span>,      <span class="comment"># 'Oct 25 2006'</span></span><br><span class="line"> <span class="string">'%b %d, %Y'</span>,     <span class="comment"># 'Oct 25, 2006'</span></span><br><span class="line"> <span class="string">'%d %b %Y'</span>,      <span class="comment"># '25 Oct 2006'</span></span><br><span class="line"> <span class="string">'%d %b, %Y'</span>,     <span class="comment"># '25 Oct, 2006'</span></span><br><span class="line"> <span class="string">'%B %d %Y'</span>,      <span class="comment"># 'October 25 2006'</span></span><br><span class="line"> <span class="string">'%B %d, %Y'</span>,     <span class="comment"># 'October 25, 2006'</span></span><br><span class="line"> <span class="string">'%d %B %Y'</span>,      <span class="comment"># '25 October 2006'</span></span><br><span class="line"> <span class="string">'%d %B, %Y'</span>]     <span class="comment"># '25 October, 2006'</span></span><br></pre></td></tr></table></figure>
<ul>
<li>DateTimeField(BaseTemporalField)</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">没有提供 input_formats 属性时候：默认格式为：</span><br><span class="line"></span><br><span class="line">[<span class="string">'%Y-%m-%d %H:%M:%S'</span>,    <span class="comment"># '2006-10-25 14:30:59'</span></span><br><span class="line"> <span class="string">'%Y-%m-%d %H:%M'</span>,       <span class="comment"># '2006-10-25 14:30'</span></span><br><span class="line"> <span class="string">'%Y-%m-%d'</span>,             <span class="comment"># '2006-10-25'</span></span><br><span class="line"> <span class="string">'%m/%d/%Y %H:%M:%S'</span>,    <span class="comment"># '10/25/2006 14:30:59'</span></span><br><span class="line"> <span class="string">'%m/%d/%Y %H:%M'</span>,       <span class="comment"># '10/25/2006 14:30'</span></span><br><span class="line"> <span class="string">'%m/%d/%Y'</span>,             <span class="comment"># '10/25/2006'</span></span><br><span class="line"> <span class="string">'%m/%d/%y %H:%M:%S'</span>,    <span class="comment"># '10/25/06 14:30:59'</span></span><br><span class="line"> <span class="string">'%m/%d/%y %H:%M'</span>,       <span class="comment"># '10/25/06 14:30'</span></span><br><span class="line"> <span class="string">'%m/%d/%y'</span>]             <span class="comment"># '10/25/06'</span></span><br></pre></td></tr></table></figure>
<hr>
<ul>
<li>DurationField(Field)</li>
</ul>
<hr>
<ul>
<li>FileField(Field)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">allow_empty_file=False    #是否允许空文件</span><br><span class="line"></span><br><span class="line">需要注意两点：</span><br><span class="line">    - form表单中 enctype=&quot;multipart/form-data&quot;</span><br><span class="line">    - view 函数中 obj = MyForm(request.POST, request.FILES)</span><br></pre></td></tr></table></figure>
<ul>
<li>ImageField(FileField)</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">注：需要PIL模块，pip3 install Pillow</span><br><span class="line"></span><br><span class="line">需要注意两点：</span><br><span class="line">    - form表单中 enctype=<span class="string">"multipart/form-data"</span></span><br><span class="line">    - view 函数中 obj = MyForm(request.POST, request.FILES)</span><br></pre></td></tr></table></figure>
<hr>
<ul>
<li>ChoiceField(Field)</li>
</ul>
<table>
<thead>
<tr>
<th>参数</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>choices=()</code></td>
<td>选项，如：choices = ((0,’上海’),(1,’北京’),)</td>
</tr>
<tr>
<td><code>initial=None</code></td>
<td>初始化的值</td>
</tr>
</tbody>
</table>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">city = fields.ChoiceField(</span><br><span class="line">    choices=[(<span class="number">1</span>,<span class="string">'北京'</span>),(<span class="number">2</span>,<span class="string">'上海'</span>),(<span class="number">3</span>,<span class="string">'广州'</span>)],</span><br><span class="line">    initial=<span class="number">3</span>,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ul>
<li>FilePathField(ChoiceField)</li>
</ul>
<table>
<thead>
<tr>
<th>参数</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>path=None</code></td>
<td>要列出其内容的目录的绝对路径。该目录必须存在。</td>
</tr>
<tr>
<td><code>recursive=False</code></td>
<td>递归下面的文件夹</td>
</tr>
<tr>
<td><code>allow_files=True</code></td>
<td>允许文件</td>
</tr>
<tr>
<td><code>allow_folders=False</code></td>
<td>允许目录</td>
</tr>
<tr>
<td><code>match</code></td>
<td>正则表达式; 只允许名称与此表达式匹配的文件作为选项。</td>
</tr>
</tbody>
</table>
<p>在网页前端暴漏一个目录下的文件，是一个下拉的单选框</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">file = fields.FilePathField(</span><br><span class="line">    path=&apos;app01&apos;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ul>
<li>TypedChoiceField(ChoiceField)</li>
</ul>
<p>可设置自行类型转换的 ChoiceField，后台接收到的数据会用 coerce 的函数，进行一次类型转换。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">city = fields.TypedChoiceField(</span><br><span class="line">    coerce=<span class="keyword">lambda</span> x: int(x),</span><br><span class="line">    choices=[(<span class="number">1</span>,<span class="string">'北京'</span>),(<span class="number">2</span>,<span class="string">'上海'</span>),(<span class="number">3</span>,<span class="string">'广州'</span>)],</span><br><span class="line">    initial=<span class="number">3</span>,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ul>
<li>MultipleChoiceField(ChoiceField)</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">bobby = fields.MultipleChoiceField(</span><br><span class="line">    choices=[(<span class="number">1</span>,<span class="string">'篮球'</span>),(<span class="number">2</span>,<span class="string">'排球'</span>),(<span class="number">3</span>,<span class="string">'足球'</span>),(<span class="number">4</span>,<span class="string">'沙滩球'</span>)],</span><br><span class="line">    initial=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<hr>
<ul>
<li>ComboField(Field)</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">fields=[]        <span class="comment"># 使用多个验证，如下：即验证最大长度20，又验证邮箱格式</span></span><br></pre></td></tr></table></figure>
<p>多条件测试，例如：只能包含数字字母下划线，同时还满足邮箱的格式，这样的混合条件测试。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">email = fields.ComboField(</span><br><span class="line">    fields=[</span><br><span class="line">        fields.CharField(max_length=<span class="number">20</span>),</span><br><span class="line">        fields.EmailField(),</span><br><span class="line">    ]</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<hr>
<ul>
<li>MultiValueField(Field)</li>
<li>SplitDateTimeField(MultiValueField)</li>
<li>TypedMultipleChoiceField(MultipleChoiceField)</li>
</ul>
<p>可自行类型转换，后台接收到的数据会用 coerce 的函数，对每个数据进行一次类型转换。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">city = fields.TypedMultipleChoiceField(</span><br><span class="line">    coerce=<span class="keyword">lambda</span> x: int(x),</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h2 id="插件定制"><a href="#插件定制" class="headerlink" title="插件定制"></a>插件定制</h2><p><code>widget</code> 参数可以对Form的插件进行定制，其影响最终在页面的表现形式。</p>
<h3 id="常用插件"><a href="#常用插件" class="headerlink" title="常用插件"></a>常用插件</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 单 radio，值为字符串</span></span><br><span class="line">user = fields.CharField(</span><br><span class="line">    initial=<span class="number">2</span>,</span><br><span class="line">    widget=widgets.RadioSelect(choices=((<span class="number">1</span>,<span class="string">'上海'</span>),(<span class="number">2</span>,<span class="string">'北京'</span>),))</span><br><span class="line">)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 单 radio，值为字符串</span></span><br><span class="line">user = fields.ChoiceField(</span><br><span class="line">    choices=((<span class="number">1</span>, <span class="string">'上海'</span>), (<span class="number">2</span>, <span class="string">'北京'</span>),),</span><br><span class="line">    initial=<span class="number">2</span>,</span><br><span class="line">    widget=widgets.RadioSelect</span><br><span class="line">)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 单 select，值为字符串</span></span><br><span class="line">user = fields.CharField(</span><br><span class="line">    initial=<span class="number">2</span>,</span><br><span class="line">    widget=widgets.Select(choices=((<span class="number">1</span>,<span class="string">'上海'</span>),(<span class="number">2</span>,<span class="string">'北京'</span>),))</span><br><span class="line">)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 单 select，值为字符串</span></span><br><span class="line">user = fields.ChoiceField(</span><br><span class="line">    choices=((<span class="number">1</span>, <span class="string">'上海'</span>), (<span class="number">2</span>, <span class="string">'北京'</span>),),</span><br><span class="line">    initial=<span class="number">2</span>,</span><br><span class="line">    widget=widgets.Select</span><br><span class="line">)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 多选select，值为列表</span></span><br><span class="line">user = fields.MultipleChoiceField(</span><br><span class="line">    choices=((<span class="number">1</span>,<span class="string">'上海'</span>),(<span class="number">2</span>,<span class="string">'北京'</span>),),</span><br><span class="line">    initial=[<span class="number">1</span>,],</span><br><span class="line">    widget=widgets.SelectMultiple</span><br><span class="line">)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># 单 checkbox</span></span><br><span class="line">user = fields.CharField(</span><br><span class="line">    widget=widgets.CheckboxInput()</span><br><span class="line">)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># 多选checkbox,值为列表</span></span><br><span class="line">user = fields.MultipleChoiceField(</span><br><span class="line">    initial=[<span class="number">2</span>, ],</span><br><span class="line">    choices=((<span class="number">1</span>, <span class="string">'上海'</span>), (<span class="number">2</span>, <span class="string">'北京'</span>),),</span><br><span class="line">    widget=widgets.CheckboxSelectMultiple</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h3 id="为插件加属性"><a href="#为插件加属性" class="headerlink" title="为插件加属性"></a>为插件加属性</h3><ul>
<li>为生成的 HTML 增加自定义的属性</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">widget = widget.TextInput(attr=&#123;<span class="string">'class'</span>:<span class="string">'c1'</span>&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="mark-safe"><a href="#mark-safe" class="headerlink" title="mark_safe"></a>mark_safe</h3><ul>
<li>后端向前端返回字符串前端渲染为 HTML</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.utils.safestring <span class="keyword">import</span> mark_safe</span><br><span class="line"></span><br><span class="line">text = <span class="string">'&lt;input type="text"&gt;'</span></span><br><span class="line"></span><br><span class="line">html = mark_safe(text)</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> render(request,<span class="string">'index.html'</span>,&#123;<span class="string">'html'</span>:html&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>前端模板文件，无需管道加safe，可以直接引用</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&#123;&#123; html &#125;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="插件数据源"><a href="#插件数据源" class="headerlink" title="插件数据源"></a>插件数据源</h2><p>大部分的时候，插件的数据来自数据库，例如一个人员的下拉选择框，一定是来自数据库的数据，但由于 <code>forms.Form</code> 的属性都是类属性，而类属性是静态的只执行一次，就会固定下来，造成下拉选择框的数据不能在数据库更新后刷新页面就得到结果，必须重启 Django（再次重加载类属性），而下面的例子就是用来解决这个弊端的。</p>
<p>虽然 Django 有 <code>from django.forms.models import ModelChoiceField</code> 这样的类，但是不推荐使用这个类，因为需要重写类的 str 方法。</p>
<ul>
<li>模型</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    user = models.CharField(max_length=<span class="number">20</span>)</span><br><span class="line">    pwd = models.CharField(max_length=<span class="number">20</span>)</span><br><span class="line">    age = models.SmallIntegerField()</span><br><span class="line">    email = models.EmailField(max_length=<span class="number">20</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>数据库数据</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>	TEST1	<span class="number">123456</span>	<span class="number">29</span>	<span class="number">420123641</span>@qq.com</span><br><span class="line"><span class="number">2</span>	TEST2	<span class="number">123456</span>	<span class="number">29</span>	<span class="number">894856156</span>@qq.com</span><br><span class="line"><span class="number">3</span>	TEST3	<span class="number">123456</span>	<span class="number">29</span>	<span class="number">420123641</span>@qq.ocm</span><br><span class="line"><span class="number">4</span>	TEST4	<span class="number">345678</span>	<span class="number">29</span>	<span class="number">565458416</span>@qq.com</span><br><span class="line"><span class="number">5</span>	TEST5	<span class="number">876543</span>	<span class="number">29</span>	<span class="number">420123641</span>@qq.com</span><br></pre></td></tr></table></figure>
<ul>
<li>视图函数，每当请求到达 <code>obj = LoveForm()</code> 都会得到数据库的新数据传递给模板，这实现不需要重启 Django 就能得到数据库新数据</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render, redirect, HttpResponse</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> forms</span><br><span class="line"><span class="keyword">from</span> django.forms <span class="keyword">import</span> widgets</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoveForm</span><span class="params">(forms.Form)</span>:</span></span><br><span class="line">    pirce = forms.IntegerField()</span><br><span class="line">    user_id = forms.IntegerField(</span><br><span class="line">        <span class="comment"># widget=widgets.Select(choices=models.UserInfo.objects.values_list("id", "user"))</span></span><br><span class="line">        widget=widgets.Select()    <span class="comment"># 注释 choices 不影响 结果，因为在 __init__ 中对 .widget.choices 属性进行了操作</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,*args,**kwargs)</span>:</span></span><br><span class="line">        super().__init__(*args,**kwargs)</span><br><span class="line">        self.fields[<span class="string">'user_id'</span>].widget.choices = models.UserInfo.objects.values_list(<span class="string">"id"</span>, <span class="string">"user"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.views <span class="keyword">import</span> View</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">love</span><span class="params">(View)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        obj = LoveForm()</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">'love.html'</span>, &#123;<span class="string">'obj'</span>: obj&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ul>
<li>模板文件，展示一个下拉的选择框，选择框的数据来自数据库，如果数据库动态增加了数据，则需要刷新网页立即得到</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>转账系统<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>金额：&#123;&#123; obj.pirce &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>姓名：&#123;&#123; obj.user_id &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="数据序列化"><a href="#数据序列化" class="headerlink" title="数据序列化"></a>数据序列化</h1><h2 id="QuerySet对象序列化"><a href="#QuerySet对象序列化" class="headerlink" title="QuerySet对象序列化"></a>QuerySet对象序列化</h2><ul>
<li><code>serializers</code> 模块用于对模型对象集合进行序列化。</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> django.core <span class="keyword">import</span> serializers</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">get_data</span><span class="params">(View)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        ret = &#123;<span class="string">'status'</span>:<span class="literal">True</span>,<span class="string">'data'</span>:<span class="literal">None</span>&#125;</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            user_list = models.UserInfo.objects.all()               <span class="comment"># 第一层序列化，为JSON字符串</span></span><br><span class="line">            ret[<span class="string">'data'</span>] = serializers.serialize(<span class="string">'json'</span>,user_list)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            ret[<span class="string">'status'</span>] = <span class="literal">False</span></span><br><span class="line">        result = json.dumps(ret)                                    <span class="comment"># 第二层序列化为 JSON 字符串</span></span><br><span class="line">        <span class="keyword">return</span> HttpResponse(result)</span><br></pre></td></tr></table></figure>
<ul>
<li>模板文件</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/static/jquery-3.3.1.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>用户列表<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span> <span class="attr">id</span>=<span class="string">"table"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">        $(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line">            initData();</span><br><span class="line">        &#125;);</span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">initData</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">                url: <span class="string">'/get_data/'</span>,</span></span><br><span class="line"><span class="javascript">                type: <span class="string">'GET'</span>,</span></span><br><span class="line"><span class="javascript">                dataType: <span class="string">'json'</span>,                       <span class="comment">// 对接收到的JSON第一层进行了反序列化</span></span></span><br><span class="line"><span class="javascript">                success: <span class="function"><span class="keyword">function</span> (<span class="params">args</span>) </span>&#123;</span></span><br><span class="line">                    if (args.status) &#123;</span><br><span class="line"><span class="javascript">                        <span class="keyword">var</span> v = <span class="built_in">JSON</span>.parse(args.data);  <span class="comment">// 对JSON 内的字符串再反序列化，得到数据</span></span></span><br><span class="line"><span class="javascript">                        <span class="built_in">console</span>.log(v);</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>结果</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">(<span class="number">7</span>) [&#123;…&#125;, &#123;…&#125;, &#123;…&#125;, &#123;…&#125;, &#123;…&#125;, &#123;…&#125;, &#123;…&#125;]</span><br><span class="line"><span class="number">0</span>:&#123;<span class="attr">model</span>: <span class="string">"app01.userinfo"</span>, <span class="attr">pk</span>: <span class="number">1</span>, <span class="attr">fields</span>: &#123;…&#125;&#125;</span><br><span class="line"><span class="number">1</span>:&#123;<span class="attr">model</span>: <span class="string">"app01.userinfo"</span>, <span class="attr">pk</span>: <span class="number">2</span>, <span class="attr">fields</span>: &#123;…&#125;&#125;</span><br><span class="line"><span class="number">2</span>:&#123;<span class="attr">model</span>: <span class="string">"app01.userinfo"</span>, <span class="attr">pk</span>: <span class="number">3</span>, <span class="attr">fields</span>: &#123;…&#125;&#125;</span><br><span class="line"><span class="number">3</span>:&#123;<span class="attr">model</span>: <span class="string">"app01.userinfo"</span>, <span class="attr">pk</span>: <span class="number">4</span>, <span class="attr">fields</span>: &#123;…&#125;&#125;</span><br><span class="line"><span class="number">4</span>:&#123;<span class="attr">model</span>: <span class="string">"app01.userinfo"</span>, <span class="attr">pk</span>: <span class="number">5</span>, <span class="attr">fields</span>: &#123;…&#125;&#125;</span><br><span class="line"><span class="number">5</span>:&#123;<span class="attr">model</span>: <span class="string">"app01.userinfo"</span>, <span class="attr">pk</span>: <span class="number">6</span>, <span class="attr">fields</span>: &#123;…&#125;&#125;</span><br><span class="line"><span class="number">6</span>:&#123;<span class="attr">model</span>: <span class="string">"app01.userinfo"</span>, <span class="attr">pk</span>: <span class="number">7</span>, <span class="attr">fields</span>: &#123;…&#125;&#125;</span><br><span class="line">length:<span class="number">7</span></span><br><span class="line">__proto__:<span class="built_in">Array</span>(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<h2 id="Values序列化"><a href="#Values序列化" class="headerlink" title="Values序列化"></a>Values序列化</h2><ul>
<li>视图类</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">get_data</span><span class="params">(View)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        ret = &#123;<span class="string">'status'</span>:<span class="literal">True</span>,<span class="string">'data'</span>:<span class="literal">None</span>&#125;</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            user_list = models.UserInfo.objects.all().values(<span class="string">'id'</span>,<span class="string">'user'</span>)</span><br><span class="line">            ret[<span class="string">'data'</span>] = list(user_list)        <span class="comment"># 转换为基本类型的集合</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            ret[<span class="string">'status'</span>] = <span class="literal">False</span></span><br><span class="line">        result = json.dumps(ret)</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(result)</span><br></pre></td></tr></table></figure>
<ul>
<li>模板文件</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/static/jquery-3.3.1.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>用户列表<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span> <span class="attr">id</span>=<span class="string">"table"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">        $(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line">            initData();</span><br><span class="line">        &#125;);</span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">initData</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">                url: <span class="string">'/get_data/'</span>,</span></span><br><span class="line"><span class="javascript">                type: <span class="string">'GET'</span>,</span></span><br><span class="line"><span class="javascript">                dataType: <span class="string">'json'</span>,               <span class="comment">// 只需要反序列化一次即可</span></span></span><br><span class="line"><span class="javascript">                success: <span class="function"><span class="keyword">function</span> (<span class="params">args</span>) </span>&#123;</span></span><br><span class="line">                    if (args.status) &#123;</span><br><span class="line"><span class="javascript">                        <span class="built_in">console</span>.log(args.data);</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>结果</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">(<span class="number">7</span>) [&#123;…&#125;, &#123;…&#125;, &#123;…&#125;, &#123;…&#125;, &#123;…&#125;, &#123;…&#125;, &#123;…&#125;]</span><br><span class="line"><span class="number">0</span>:&#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">user</span>: <span class="string">"张铁蛋"</span>&#125;</span><br><span class="line"><span class="number">1</span>:&#123;<span class="attr">id</span>: <span class="number">2</span>, <span class="attr">user</span>: <span class="string">"吴山炮"</span>&#125;</span><br><span class="line"><span class="number">2</span>:&#123;<span class="attr">id</span>: <span class="number">3</span>, <span class="attr">user</span>: <span class="string">"杨大爷"</span>&#125;</span><br><span class="line"><span class="number">3</span>:&#123;<span class="attr">id</span>: <span class="number">4</span>, <span class="attr">user</span>: <span class="string">"宋傻逼"</span>&#125;</span><br><span class="line"><span class="number">4</span>:&#123;<span class="attr">id</span>: <span class="number">5</span>, <span class="attr">user</span>: <span class="string">"张愣子"</span>&#125;</span><br><span class="line"><span class="number">5</span>:&#123;<span class="attr">id</span>: <span class="number">6</span>, <span class="attr">user</span>: <span class="string">"二狗子"</span>&#125;</span><br><span class="line"><span class="number">6</span>:&#123;<span class="attr">id</span>: <span class="number">7</span>, <span class="attr">user</span>: <span class="string">"赵铁柱"</span>&#125;</span><br><span class="line">length:<span class="number">7</span></span><br><span class="line">__proto__:<span class="built_in">Array</span>(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/27/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/27/">27</a><span class="page-number current">28</span><a class="page-number" href="/page/29/">29</a><span class="space">&hellip;</span><a class="page-number" href="/page/43/">43</a><a class="extend next" rel="next" href="/page/29/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="Jin Heng">
            
              <p class="site-author-name" itemprop="name">Jin Heng</p>
              <p class="site-description motion-element" itemprop="description">越努力越幸运</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">86</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">6</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/yangjinheng" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:jinhengyang@foxmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          
        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2017 &mdash; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jin Heng</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  













  





  

  

  

  
  

  

  

  

</body>
</html>
